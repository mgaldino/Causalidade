<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 10 Controle Sintético e Estimação Contrafactual | Curso de Inferência Causal</title>
  <meta name="description" content="Capítulo 10 Controle Sintético e Estimação Contrafactual | Curso de Inferência Causal" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 10 Controle Sintético e Estimação Contrafactual | Curso de Inferência Causal" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 10 Controle Sintético e Estimação Contrafactual | Curso de Inferência Causal" />
  
  
  

<meta name="author" content="Manoel Galdino" />


<meta name="date" content="2026-02-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="time-series-cross-section-tscs.html"/>
<link rel="next" href="llms-e-outras.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Causalidade</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="11-Synth.html"><a href="#introdu%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>1</b> Introdução</a>
<ul>
<li class="chapter" data-level="1.1" data-path="11-Synth.html"><a href="#revis%C3%A3o-de-regress%C3%A3o"><i class="fa fa-check"></i><b>1.1</b> Revisão de Regressão</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="11-Synth.html"><a href="#teorema-da-anatomia-da-regress%C3%A3o"><i class="fa fa-check"></i><b>1.1.1</b> Teorema da Anatomia da Regressão</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="11-Synth.html"><a href="#infer%C3%AAncia"><i class="fa fa-check"></i><b>1.2</b> Inferência</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="11-Synth.html"><a href="#generaliza%C3%A7%C3%A3o-amostral-vs.-generaliza%C3%A7%C3%A3o-causal"><i class="fa fa-check"></i><b>1.2.1</b> Generalização amostral vs. generalização causal</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1.2.2</b> Incerteza com o universo dos casos</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#validade-externa"><i class="fa fa-check"></i><b>1.2.3</b> Validade externa</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="11-Synth.html"><a href="#resumo-e-pr%C3%B3ximos-passos"><i class="fa fa-check"></i><b>1.3</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="1.4" data-path="11-Synth.html"><a href="#refer%C3%AAncias"><i class="fa fa-check"></i><b>1.4</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html"><i class="fa fa-check"></i><b>2</b> Resultados Potenciais</a>
<ul>
<li class="chapter" data-level="2.1" data-path="11-Synth.html"><a href="#da-intui%C3%A7%C3%A3o-comparativa-ao-modelo-formal"><i class="fa fa-check"></i><b>2.1</b> Da intuição comparativa ao modelo formal</a></li>
<li class="chapter" data-level="2.2" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#resultados-potenciais-potential-outcomes"><i class="fa fa-check"></i><b>2.2</b> Resultados Potenciais (<em>Potential Outcomes</em>)</a></li>
<li class="chapter" data-level="2.3" data-path="11-Synth.html"><a href="#nota%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>2.3</b> Notação</a></li>
<li class="chapter" data-level="2.4" data-path="11-Synth.html"><a href="#problema-fundamental-da-infer%C3%AAncia-causal"><i class="fa fa-check"></i><b>2.4</b> Problema Fundamental da Inferência Causal</a></li>
<li class="chapter" data-level="2.5" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#estimando"><i class="fa fa-check"></i><b>2.5</b> Estimando</a></li>
<li class="chapter" data-level="2.6" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#estimandos-mais-comuns"><i class="fa fa-check"></i><b>2.6</b> Estimandos Mais Comuns</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#ate"><i class="fa fa-check"></i><b>2.6.1</b> ATE</a></li>
<li class="chapter" data-level="2.6.2" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#att"><i class="fa fa-check"></i><b>2.6.2</b> ATT</a></li>
<li class="chapter" data-level="2.6.3" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#cate"><i class="fa fa-check"></i><b>2.6.3</b> CATE</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#nota-sobre-estimandos"><i class="fa fa-check"></i><b>2.7</b> Nota sobre estimandos</a></li>
<li class="chapter" data-level="2.8" data-path="11-Synth.html"><a href="#exerc%C3%ADcio---qual-o-estimando-e-o-estimador-se-poss%C3%ADvel"><i class="fa fa-check"></i><b>2.8</b> Exercício - Qual o estimando e o estimador (se possível)?</a></li>
<li class="chapter" data-level="2.9" data-path="11-Synth.html"><a href="#identifica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>2.9</b> Identificação</a></li>
<li class="chapter" data-level="2.10" data-path="11-Synth.html"><a href="#identifica%C3%A7%C3%A3o-do-ate"><i class="fa fa-check"></i><b>2.10</b> Identificação do ATE</a></li>
<li class="chapter" data-level="2.11" data-path="11-Synth.html"><a href="#equa%C3%A7%C3%B5es-estruturais"><i class="fa fa-check"></i><b>2.11</b> Equações estruturais</a></li>
<li class="chapter" data-level="2.12" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#modelo-versus-desenho"><i class="fa fa-check"></i><b>2.12</b> Modelo versus Desenho</a></li>
<li class="chapter" data-level="2.13" data-path="11-Synth.html"><a href="#exerc%C3%ADcio-em-sala"><i class="fa fa-check"></i><b>2.13</b> Exercício em sala</a></li>
<li class="chapter" data-level="2.14" data-path="11-Synth.html"><a href="#resumo-e-pr%C3%B3ximos-passos-1"><i class="fa fa-check"></i><b>2.14</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="2.15" data-path="11-Synth.html"><a href="#refer%C3%AAncias-1"><i class="fa fa-check"></i><b>2.15</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dags.html"><a href="dags.html"><i class="fa fa-check"></i><b>3</b> DAGs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="dags.html"><a href="dags.html#causalidade"><i class="fa fa-check"></i><b>3.1</b> Causalidade</a></li>
<li class="chapter" data-level="3.2" data-path="11-Synth.html"><a href="#introdu%C3%A7%C3%A3o-1"><i class="fa fa-check"></i><b>3.2</b> Introdução</a></li>
<li class="chapter" data-level="3.3" data-path="11-Synth.html"><a href="#os-tipos-b%C3%A1sicos-de-dags"><i class="fa fa-check"></i><b>3.3</b> Os Tipos Básicos de DAGs</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="dags.html"><a href="dags.html#chains"><i class="fa fa-check"></i><b>3.3.1</b> 1. Chains</a></li>
<li class="chapter" data-level="3.3.2" data-path="dags.html"><a href="dags.html#forks"><i class="fa fa-check"></i><b>3.3.2</b> 2. Forks</a></li>
<li class="chapter" data-level="3.3.3" data-path="dags.html"><a href="dags.html#colliders"><i class="fa fa-check"></i><b>3.3.3</b> 3. Colliders</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="11-Synth.html"><a href="#simula%C3%A7%C3%A3o-no-r-ilustrando-o-collider-bias"><i class="fa fa-check"></i><b>3.4</b> Simulação no R: Ilustrando o Collider Bias</a></li>
<li class="chapter" data-level="3.5" data-path="11-Synth.html"><a href="#defini%C3%A7%C3%B5es"><i class="fa fa-check"></i><b>3.5</b> Definições</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="11-Synth.html"><a href="#rela%C3%A7%C3%B5es-entre-vari%C3%A1veis-n%C3%B3s"><i class="fa fa-check"></i><b>3.5.1</b> Relações entre Variáveis (nós):</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="dags.html"><a href="dags.html#controle-e-ajuste"><i class="fa fa-check"></i><b>3.6</b> Controle e Ajuste</a></li>
<li class="chapter" data-level="3.7" data-path="11-Synth.html"><a href="#fatoriza%C3%A7%C3%A3o-da-probabilidade-conjunta"><i class="fa fa-check"></i><b>3.7</b> Fatorização da Probabilidade Conjunta</a></li>
<li class="chapter" data-level="3.8" data-path="11-Synth.html"><a href="#fatoriza%C3%A7%C3%A3o-e-dags"><i class="fa fa-check"></i><b>3.8</b> Fatorização e DAGs</a></li>
<li class="chapter" data-level="3.9" data-path="11-Synth.html"><a href="#fatoriza%C3%A7%C3%A3o-dags-e-causalidade"><i class="fa fa-check"></i><b>3.9</b> Fatorização, DAGs e Causalidade</a></li>
<li class="chapter" data-level="3.10" data-path="11-Synth.html"><a href="#resumo-e-pr%C3%B3ximos-passos-2"><i class="fa fa-check"></i><b>3.10</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="3.11" data-path="11-Synth.html"><a href="#refer%C3%AAncias-2"><i class="fa fa-check"></i><b>3.11</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="experimentos.html"><a href="experimentos.html"><i class="fa fa-check"></i><b>4</b> Experimentos</a>
<ul>
<li class="chapter" data-level="4.1" data-path="11-Synth.html"><a href="#introdu%C3%A7%C3%A3o-2"><i class="fa fa-check"></i><b>4.1</b> Introdução</a></li>
<li class="chapter" data-level="4.2" data-path="11-Synth.html"><a href="#experimentos-aleat%C3%B3rios"><i class="fa fa-check"></i><b>4.2</b> Experimentos aleatórios</a></li>
<li class="chapter" data-level="4.3" data-path="11-Synth.html"><a href="#restri%C3%A7%C3%A3o-de-exclus%C3%A3o"><i class="fa fa-check"></i><b>4.3</b> Restrição de Exclusão</a></li>
<li class="chapter" data-level="4.4" data-path="experimentos.html"><a href="experimentos.html#tipos-de-experimentos"><i class="fa fa-check"></i><b>4.4</b> Tipos de experimentos</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="11-Synth.html"><a href="#aleatoriza%C3%A7%C3%A3o-de-bernoulli"><i class="fa fa-check"></i><b>4.4.1</b> Aleatorização de Bernoulli</a></li>
<li class="chapter" data-level="4.4.2" data-path="11-Synth.html"><a href="#aleatoriza%C3%A7%C3%A3o-completa"><i class="fa fa-check"></i><b>4.4.2</b> Aleatorização Completa</a></li>
<li class="chapter" data-level="4.4.3" data-path="11-Synth.html"><a href="#aleatoriza%C3%A7%C3%A3o-condicional-block-random-assignment"><i class="fa fa-check"></i><b>4.4.3</b> Aleatorização Condicional (Block Random Assignment)</a></li>
<li class="chapter" data-level="4.4.4" data-path="11-Synth.html"><a href="#pensando-aleatoriza%C3%A7%C3%A3o-em-bloco"><i class="fa fa-check"></i><b>4.4.4</b> Pensando aleatorização em bloco</a></li>
<li class="chapter" data-level="4.4.5" data-path="11-Synth.html"><a href="#ate-com-aleatoriza%C3%A7%C3%A3o-condicional-bloco"><i class="fa fa-check"></i><b>4.4.5</b> ATE com Aleatorização Condicional (Bloco)</a></li>
<li class="chapter" data-level="4.4.6" data-path="11-Synth.html"><a href="#aleatoriza%C3%A7%C3%A3o-em-bloco"><i class="fa fa-check"></i><b>4.4.6</b> Aleatorização em bloco</a></li>
<li class="chapter" data-level="4.4.7" data-path="11-Synth.html"><a href="#precis%C3%A3o-da-aleatoriza%C3%A7%C3%A3o-em-bloco"><i class="fa fa-check"></i><b>4.4.7</b> Precisão da aleatorização em bloco</a></li>
<li class="chapter" data-level="4.4.8" data-path="11-Synth.html"><a href="#compara%C3%A7%C3%A3o-de-ses"><i class="fa fa-check"></i><b>4.4.8</b> Comparação de SEs</a></li>
<li class="chapter" data-level="4.4.9" data-path="experimentos.html"><a href="experimentos.html#cluster-randomization"><i class="fa fa-check"></i><b>4.4.9</b> Cluster randomization</a></li>
<li class="chapter" data-level="4.4.10" data-path="experimentos.html"><a href="experimentos.html#tabelas-em-artigos"><i class="fa fa-check"></i><b>4.4.10</b> Tabelas em artigos</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="experimentos.html"><a href="experimentos.html#estimador-ate"><i class="fa fa-check"></i><b>4.5</b> Estimador ATE</a></li>
<li class="chapter" data-level="4.6" data-path="11-Synth.html"><a href="#resumo-do-cap%C3%ADtulo"><i class="fa fa-check"></i><b>4.6</b> Resumo do Capítulo</a></li>
<li class="chapter" data-level="4.7" data-path="experimentos.html"><a href="experimentos.html#declare-design"><i class="fa fa-check"></i><b>4.7</b> Declare Design</a></li>
<li class="chapter" data-level="4.8" data-path="11-Synth.html"><a href="#exerc%C3%ADcio"><i class="fa fa-check"></i><b>4.8</b> Exercício</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="11-Synth.html"><a href="#experimento-com-envio-de-cart%C3%B5es-postais-e-participa%C3%A7%C3%A3o-eleitoral"><i class="fa fa-check"></i><b>4.8.1</b> Experimento com envio de cartões-postais e participação eleitoral</a></li>
<li class="chapter" data-level="4.8.2" data-path="11-Synth.html"><a href="#experimento-com-an%C3%BAncios-de-tv-e-participa%C3%A7%C3%A3o-eleitoral"><i class="fa fa-check"></i><b>4.8.2</b> Experimento com anúncios de TV e participação eleitoral</a></li>
<li class="chapter" data-level="4.8.3" data-path="11-Synth.html"><a href="#exclus%C3%A3o-de-participantes-em-experimentos-de-survey"><i class="fa fa-check"></i><b>4.8.3</b> Exclusão de participantes em experimentos de survey</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html"><i class="fa fa-check"></i><b>5</b> Propensity Score e Matching</a>
<ul>
<li class="chapter" data-level="5.1" data-path="11-Synth.html"><a href="#introdu%C3%A7%C3%A3o-3"><i class="fa fa-check"></i><b>5.1</b> Introdução</a></li>
<li class="chapter" data-level="5.2" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#propensity-score"><i class="fa fa-check"></i><b>5.2</b> Propensity Score</a></li>
<li class="chapter" data-level="5.3" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching"><i class="fa fa-check"></i><b>5.3</b> Matching</a></li>
<li class="chapter" data-level="5.4" data-path="11-Synth.html"><a href="#suposi%C3%A7%C3%B5es-de-identifica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>5.4</b> Suposições de identificação</a></li>
<li class="chapter" data-level="5.5" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching-1"><i class="fa fa-check"></i><b>5.5</b> Matching</a></li>
<li class="chapter" data-level="5.6" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching-exato"><i class="fa fa-check"></i><b>5.6</b> Matching exato</a></li>
<li class="chapter" data-level="5.7" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching-aproximado"><i class="fa fa-check"></i><b>5.7</b> Matching aproximado</a></li>
<li class="chapter" data-level="5.8" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#estimando-1"><i class="fa fa-check"></i><b>5.8</b> Estimando</a></li>
<li class="chapter" data-level="5.9" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#declare-design-e-matching"><i class="fa fa-check"></i><b>5.9</b> Declare Design e Matching</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching-e-propensity-scores"><i class="fa fa-check"></i><b>5.9.1</b> Matching e Propensity scores</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="11-Synth.html"><a href="#recomenda%C3%A7%C3%B5es-pr%C3%A1ticas-sobre-matching"><i class="fa fa-check"></i><b>5.10</b> Recomendações Práticas sobre Matching</a></li>
<li class="chapter" data-level="5.11" data-path="11-Synth.html"><a href="#refer%C3%AAncias-3"><i class="fa fa-check"></i><b>5.11</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="11-Synth.html"><a href="#vari%C3%A1veis-instrumentais"><i class="fa fa-check"></i><b>6</b> Variáveis Instrumentais</a>
<ul>
<li class="chapter" data-level="6.1" data-path="11-Synth.html"><a href="#introdu%C3%A7%C3%A3o-4"><i class="fa fa-check"></i><b>6.1</b> Introdução</a></li>
<li class="chapter" data-level="6.2" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html"><i class="fa fa-check"></i><b>6.2</b> IV com modelo estrutural</a></li>
<li class="chapter" data-level="6.3" data-path="11-Synth.html"><a href="#mqo-em-2-est%C3%A1gios"><i class="fa fa-check"></i><b>6.3</b> MQO em 2 Estágios</a></li>
<li class="chapter" data-level="6.4" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#principais-usos-de-iv"><i class="fa fa-check"></i><b>6.4</b> Principais usos de IV</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#experimentos-1"><i class="fa fa-check"></i><b>6.4.1</b> Experimentos</a></li>
<li class="chapter" data-level="6.4.2" data-path="11-Synth.html"><a href="#regras-com-varia%C3%A7%C3%A3o-quasi-aleat%C3%B3ria"><i class="fa fa-check"></i><b>6.4.2</b> Regras com variação quasi-aleatória</a></li>
<li class="chapter" data-level="6.4.3" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#teoria"><i class="fa fa-check"></i><b>6.4.3</b> Teoria</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="11-Synth.html"><a href="#efeito-heterog%C3%AAneo"><i class="fa fa-check"></i><b>6.5</b> Efeito heterogêneo</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="11-Synth.html"><a href="#suposi%C3%A7%C3%B5es-para-estimar-o-late"><i class="fa fa-check"></i><b>6.5.1</b> Suposições para estimar o LATE</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="11-Synth.html"><a href="#restri%C3%A7%C3%A3o-de-exclus%C3%A3o-1"><i class="fa fa-check"></i><b>6.6</b> Restrição de Exclusão</a></li>
<li class="chapter" data-level="6.7" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#monotonicidade"><i class="fa fa-check"></i><b>6.7</b> Monotonicidade</a></li>
<li class="chapter" data-level="6.8" data-path="11-Synth.html"><a href="#estima%C3%A7%C3%A3o-aka-estat%C3%ADstica-f"><i class="fa fa-check"></i><b>6.8</b> Estimação (aka estatística F)</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#f-stat"><i class="fa fa-check"></i><b>6.8.1</b> F stat</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="11-Synth.html"><a href="#resumo-e-pr%C3%B3ximos-passos-3"><i class="fa fa-check"></i><b>6.9</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="6.10" data-path="11-Synth.html"><a href="#refer%C3%AAncias-4"><i class="fa fa-check"></i><b>6.10</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="11-Synth.html"><a href="#desenho-de-regress%C3%A3o-descont%C3%ADnua"><i class="fa fa-check"></i><b>7</b> Desenho de Regressão Descontínua</a>
<ul>
<li class="chapter" data-level="7.1" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html"><i class="fa fa-check"></i><b>7.1</b> Outline da aula</a></li>
<li class="chapter" data-level="7.2" data-path="11-Synth.html"><a href="#caracter%C3%ADsticas-chave-da-rdd"><i class="fa fa-check"></i><b>7.2</b> Características-chave da RDD</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="11-Synth.html"><a href="#determina%C3%A7%C3%A3o-do-tratamento"><i class="fa fa-check"></i><b>7.2.1</b> Determinação do Tratamento</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#fuzzy-rdd"><i class="fa fa-check"></i><b>7.3</b> Fuzzy RDD</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="11-Synth.html"><a href="#observa%C3%A7%C3%A3o-e-corte"><i class="fa fa-check"></i><b>7.3.1</b> Observação e Corte</a></li>
<li class="chapter" data-level="7.3.2" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#estimativa-dos-efeitos-do-tratamento"><i class="fa fa-check"></i><b>7.3.2</b> Estimativa dos Efeitos do Tratamento</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="11-Synth.html"><a href="#suposi%C3%A7%C3%A3o-de-continuidade"><i class="fa fa-check"></i><b>7.4</b> Suposição de continuidade</a></li>
<li class="chapter" data-level="7.5" data-path="11-Synth.html"><a href="#suposi%C3%A7%C3%B5es-na-rdd"><i class="fa fa-check"></i><b>7.5</b> Suposições na RDD</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="11-Synth.html"><a href="#suposi%C3%A7%C3%A3o-de-n%C3%A3o-manipula%C3%A7%C3%A3o-com-precis%C3%A3o"><i class="fa fa-check"></i><b>7.5.1</b> Suposição de Não-manipulação com Precisão</a></li>
<li class="chapter" data-level="7.5.2" data-path="11-Synth.html"><a href="#problemas-de-manipula%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.5.2</b> Problemas de Manipulação</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="11-Synth.html"><a href="#testabilidade-da-suposi%C3%A7%C3%A3o-de-n%C3%A3o-manipula%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.6</b> Testabilidade da Suposição de não-Manipulação</a></li>
<li class="chapter" data-level="7.7" data-path="11-Synth.html"><a href="#estima%C3%A7%C3%A3o-em-rdd"><i class="fa fa-check"></i><b>7.7</b> Estimação em RDD</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#problema-de-complete-overlapping"><i class="fa fa-check"></i><b>7.7.1</b> Problema de Complete Overlapping</a></li>
<li class="chapter" data-level="7.7.2" data-path="11-Synth.html"><a href="#depend%C3%AAncia-de-extrapola%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.7.2</b> Dependência de Extrapolação</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="11-Synth.html"><a href="#m%C3%A9todos-de-estima%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.8</b> Métodos de Estimação</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="11-Synth.html"><a href="#identifica%C3%A7%C3%A3o-no-limite"><i class="fa fa-check"></i><b>7.8.1</b> Identificação no Limite</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="11-Synth.html"><a href="#trade-off-de-vi%C3%A9s-vari%C3%A2ncia"><i class="fa fa-check"></i><b>7.9</b> Trade-off de Viés-Variância</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="11-Synth.html"><a href="#m%C3%A9todos-de-largura-de-banda-%C3%B3tima"><i class="fa fa-check"></i><b>7.9.1</b> Métodos de Largura de Banda Ótima</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="11-Synth.html"><a href="#regras-arbitr%C3%A1rias"><i class="fa fa-check"></i><b>7.10</b> Regras arbitrárias</a></li>
<li class="chapter" data-level="7.11" data-path="11-Synth.html"><a href="#simula%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.11</b> Simulação</a></li>
<li class="chapter" data-level="7.12" data-path="11-Synth.html"><a href="#simula%C3%A7%C3%A3o---potential-outcomes-y0"><i class="fa fa-check"></i><b>7.12</b> Simulação - Potential Outcomes Y0</a></li>
<li class="chapter" data-level="7.13" data-path="11-Synth.html"><a href="#simula%C3%A7%C3%A3o---potential-outcomes-y1"><i class="fa fa-check"></i><b>7.13</b> Simulação - Potential Outcomes Y1</a></li>
<li class="chapter" data-level="7.14" data-path="11-Synth.html"><a href="#simula%C3%A7%C3%A3o---potential-outcomes-y1-e-y0"><i class="fa fa-check"></i><b>7.14</b> Simulação - Potential Outcomes Y1 e Y0</a></li>
<li class="chapter" data-level="7.15" data-path="11-Synth.html"><a href="#simula%C3%A7%C3%A3o---y-observado"><i class="fa fa-check"></i><b>7.15</b> Simulação - Y observado</a></li>
<li class="chapter" data-level="7.16" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#quando-o-rdd-funciona"><i class="fa fa-check"></i><b>7.16</b> Quando o RDD funciona?</a></li>
<li class="chapter" data-level="7.17" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#raw-data-versus-bin"><i class="fa fa-check"></i><b>7.17</b> Raw Data versus Bin</a></li>
<li class="chapter" data-level="7.18" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#permutation-tests-balancing"><i class="fa fa-check"></i><b>7.18</b> Permutation tests (balancing)</a></li>
<li class="chapter" data-level="7.19" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#mccrary-test"><i class="fa fa-check"></i><b>7.19</b> McCrary test</a></li>
<li class="chapter" data-level="7.20" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#robustez"><i class="fa fa-check"></i><b>7.20</b> Robustez</a></li>
<li class="chapter" data-level="7.21" data-path="11-Synth.html"><a href="#densidade-descont%C3%ADnua---results"><i class="fa fa-check"></i><b>7.21</b> Densidade descontínua - results</a></li>
<li class="chapter" data-level="7.22" data-path="11-Synth.html"><a href="#regress%C3%A3o-rdd"><i class="fa fa-check"></i><b>7.22</b> Regressão RDD</a></li>
<li class="chapter" data-level="7.23" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#placebo-tests"><i class="fa fa-check"></i><b>7.23</b> Placebo Tests</a></li>
<li class="chapter" data-level="7.24" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#pcrd"><i class="fa fa-check"></i><b>7.24</b> PCRD</a></li>
<li class="chapter" data-level="7.25" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#checklist-para-um-paper-de-rdd"><i class="fa fa-check"></i><b>7.25</b> Checklist para um paper de RDD</a></li>
<li class="chapter" data-level="7.26" data-path="11-Synth.html"><a href="#refer%C3%AAncias-5"><i class="fa fa-check"></i><b>7.26</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="11-Synth.html"><a href="#diferen%C3%A7a-em-diferen%C3%A7as"><i class="fa fa-check"></i><b>8</b> Diferença em Diferenças</a>
<ul>
<li class="chapter" data-level="8.1" data-path="11-Synth.html"><a href="#motiva%C3%A7%C3%A3o-por-que-did"><i class="fa fa-check"></i><b>8.1</b> Motivação: por que DiD?</a></li>
<li class="chapter" data-level="8.2" data-path="11-Synth.html"><a href="#modelo-b%C3%A1sico-22"><i class="fa fa-check"></i><b>8.2</b> Modelo básico 2$$2</a></li>
<li class="chapter" data-level="8.3" data-path="11-Synth.html"><a href="#pressupostos-de-identifica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>8.3</b> Pressupostos de identificação</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="11-Synth.html"><a href="#tend%C3%AAncias-paralelas"><i class="fa fa-check"></i><b>8.3.1</b> Tendências paralelas</a></li>
<li class="chapter" data-level="8.3.2" data-path="11-Synth.html"><a href="#equival%C3%AAncia-entre-pt-e-twfe"><i class="fa fa-check"></i><b>8.3.2</b> Equivalência entre PT e TWFE</a></li>
<li class="chapter" data-level="8.3.3" data-path="11-Synth.html"><a href="#n%C3%A3o-antecipa%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>8.3.3</b> Não-antecipação</a></li>
<li class="chapter" data-level="8.3.4" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html"><i class="fa fa-check"></i><b>8.3.4</b> DAG para DiD</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="11-Synth.html"><a href="#estima%C3%A7%C3%A3o-por-twfe"><i class="fa fa-check"></i><b>8.4</b> Estimação por TWFE</a></li>
<li class="chapter" data-level="8.5" data-path="11-Synth.html"><a href="#aplica%C3%A7%C3%A3o-1-obra-transparente"><i class="fa fa-check"></i><b>8.5</b> Aplicação 1: Obra Transparente</a></li>
<li class="chapter" data-level="8.6" data-path="11-Synth.html"><a href="#did-din%C3%A2mico-e-event-study"><i class="fa fa-check"></i><b>8.6</b> DiD dinâmico e event study</a></li>
<li class="chapter" data-level="8.7" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#o-problema-do-twfe-com-tratamento-escalonado"><i class="fa fa-check"></i><b>8.7</b> O problema do TWFE com tratamento escalonado</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#o-que-pode-dar-errado"><i class="fa fa-check"></i><b>8.7.1</b> O que pode dar errado</a></li>
<li class="chapter" data-level="8.7.2" data-path="11-Synth.html"><a href="#decomposi%C3%A7%C3%A3o-de-goodman-bacon-simula%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>8.7.2</b> Decomposição de Goodman-Bacon — simulação</a></li>
<li class="chapter" data-level="8.7.3" data-path="11-Synth.html"><a href="#conex%C3%A3o-com-fwl-e-gardner"><i class="fa fa-check"></i><b>8.7.3</b> Conexão com FWL e Gardner</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#estimadores-modernos"><i class="fa fa-check"></i><b>8.8</b> Estimadores modernos</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#callaway-santanna-2021"><i class="fa fa-check"></i><b>8.8.1</b> Callaway &amp; Sant’Anna (2021)</a></li>
<li class="chapter" data-level="8.8.2" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#sun-abraham-2021"><i class="fa fa-check"></i><b>8.8.2</b> Sun &amp; Abraham (2021)</a></li>
<li class="chapter" data-level="8.8.3" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#gardner-2022-did2s"><i class="fa fa-check"></i><b>8.8.3</b> Gardner (2022) / did2s</a></li>
<li class="chapter" data-level="8.8.4" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#borusyak-jaravel-spiess-2024"><i class="fa fa-check"></i><b>8.8.4</b> Borusyak, Jaravel &amp; Spiess (2024)</a></li>
<li class="chapter" data-level="8.8.5" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#tabela-comparativa"><i class="fa fa-check"></i><b>8.8.5</b> Tabela comparativa</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="11-Synth.html"><a href="#testando-tend%C3%AAncias-paralelas-e-an%C3%A1lise-de-sensibilidade"><i class="fa fa-check"></i><b>8.9</b> Testando tendências paralelas e análise de sensibilidade</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#pre-trends-e-o-aviso-de-roth-2022"><i class="fa fa-check"></i><b>8.9.1</b> Pre-trends e o aviso de Roth (2022)</a></li>
<li class="chapter" data-level="8.9.2" data-path="11-Synth.html"><a href="#honestdid-an%C3%A1lise-de-sensibilidade"><i class="fa fa-check"></i><b>8.9.2</b> HonestDiD: análise de sensibilidade</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="11-Synth.html"><a href="#aplica%C3%A7%C3%A3o-2-enchente-do-elbe"><i class="fa fa-check"></i><b>8.10</b> Aplicação 2: Enchente do Elbe</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#contexto"><i class="fa fa-check"></i><b>8.10.1</b> Contexto</a></li>
<li class="chapter" data-level="8.10.2" data-path="11-Synth.html"><a href="#dados-e-did-b%C3%A1sico"><i class="fa fa-check"></i><b>8.10.2</b> Dados e DiD básico</a></li>
<li class="chapter" data-level="8.10.3" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#event-study"><i class="fa fa-check"></i><b>8.10.3</b> Event study</a></li>
<li class="chapter" data-level="8.10.4" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#robustez-1"><i class="fa fa-check"></i><b>8.10.4</b> Robustez</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="11-Synth.html"><a href="#did-condicional-e-extens%C3%B5es"><i class="fa fa-check"></i><b>8.11</b> DiD condicional e extensões</a></li>
<li class="chapter" data-level="8.12" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#resumo"><i class="fa fa-check"></i><b>8.12</b> Resumo</a></li>
<li class="chapter" data-level="8.13" data-path="11-Synth.html"><a href="#refer%C3%AAncias-6"><i class="fa fa-check"></i><b>8.13</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html"><i class="fa fa-check"></i><b>9</b> Time-Series Cross-Section (TSCS)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="11-Synth.html"><a href="#introdu%C3%A7%C3%A3o-5"><i class="fa fa-check"></i><b>9.1</b> Introdução</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#within-versus-between"><i class="fa fa-check"></i><b>9.1.1</b> Within versus Between</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#ovb"><i class="fa fa-check"></i><b>9.2</b> OVB</a></li>
<li class="chapter" data-level="9.3" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#estimandos"><i class="fa fa-check"></i><b>9.3</b> Estimandos</a></li>
<li class="chapter" data-level="9.4" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#resultados-potenciais-1"><i class="fa fa-check"></i><b>9.4</b> Resultados Potenciais</a></li>
<li class="chapter" data-level="9.5" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#modelo-ar1"><i class="fa fa-check"></i><b>9.5</b> Modelo AR(1)</a></li>
<li class="chapter" data-level="9.6" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#sequential-ignorability"><i class="fa fa-check"></i><b>9.6</b> Sequential ignorability</a></li>
<li class="chapter" data-level="9.7" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#resumo-1"><i class="fa fa-check"></i><b>9.7</b> Resumo</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#remark"><i class="fa fa-check"></i><b>9.7.1</b> Remark</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="11-Synth.html"><a href="#suposi%C3%A7%C3%B5es-para-infer%C3%AAncia"><i class="fa fa-check"></i><b>9.8</b> Suposições para Inferência</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#remark-1"><i class="fa fa-check"></i><b>9.8.1</b> Remark</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="11-Synth.html"><a href="#efeitos-aleat%C3%B3rios"><i class="fa fa-check"></i><b>9.9</b> Efeitos aleatórios</a></li>
<li class="chapter" data-level="9.10" data-path="11-Synth.html"><a href="#refer%C3%AAncias-7"><i class="fa fa-check"></i><b>9.10</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="11-Synth.html"><a href="#controle-sint%C3%A9tico-e-estima%C3%A7%C3%A3o-contrafactual"><i class="fa fa-check"></i><b>10</b> Controle Sintético e Estimação Contrafactual</a>
<ul>
<li class="chapter" data-level="10.1" data-path="11-Synth.html"><a href="#motiva%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>10.1</b> Motivação</a></li>
<li class="chapter" data-level="10.2" data-path="11-Synth.html"><a href="#controle-sint%C3%A9tico-cl%C3%A1ssico"><i class="fa fa-check"></i><b>10.2</b> Controle Sintético clássico</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="11-Synth.html"><a href="#formaliza%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>10.2.1</b> Formalização</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="11-Synth.html"><a href="#implementa%C3%A7%C3%A3o-do-scm-no-r"><i class="fa fa-check"></i><b>10.3</b> Implementação do SCM no R</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="11-Synth.html"><a href="#infer%C3%AAncia-por-placebo"><i class="fa fa-check"></i><b>10.3.1</b> Inferência por placebo</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="11-Synth.html"><a href="#framework-de-estima%C3%A7%C3%A3o-contrafactual"><i class="fa fa-check"></i><b>10.4</b> Framework de estimação contrafactual</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html"><i class="fa fa-check"></i><b>10.4.1</b> Setup</a></li>
<li class="chapter" data-level="10.4.2" data-path="11-Synth.html"><a href="#estrat%C3%A9gia-de-estima%C3%A7%C3%A3o-em-quatro-passos"><i class="fa fa-check"></i><b>10.4.2</b> Estratégia de estimação em quatro passos</a></li>
<li class="chapter" data-level="10.4.3" data-path="11-Synth.html"><a href="#suposi%C3%A7%C3%B5es-de-identifica%C3%A7%C3%A3o-1"><i class="fa fa-check"></i><b>10.4.3</b> Suposições de identificação</a></li>
<li class="chapter" data-level="10.4.4" data-path="11-Synth.html"><a href="#conex%C3%A3o-com-did"><i class="fa fa-check"></i><b>10.4.4</b> Conexão com DiD</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="11-Synth.html"><a href="#tr%C3%AAs-estimadores-contrafactuais"><i class="fa fa-check"></i><b>10.5</b> Três estimadores contrafactuais</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html#fect-efeitos-fixos"><i class="fa fa-check"></i><b>10.5.1</b> FEct: efeitos fixos</a></li>
<li class="chapter" data-level="10.5.2" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html#ifect-fatores-interativos"><i class="fa fa-check"></i><b>10.5.2</b> IFEct: fatores interativos</a></li>
<li class="chapter" data-level="10.5.3" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html#mc-matrix-completion"><i class="fa fa-check"></i><b>10.5.3</b> MC: Matrix Completion</a></li>
<li class="chapter" data-level="10.5.4" data-path="11-Synth.html"><a href="#demonstra%C3%A7%C3%A3o-com-dados-da-calif%C3%B3rnia"><i class="fa fa-check"></i><b>10.5.4</b> Demonstração com dados da Califórnia</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="11-Synth.html"><a href="#diagn%C3%B3sticos"><i class="fa fa-check"></i><b>10.6</b> Diagnósticos</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="11-Synth.html"><a href="#efeitos-din%C3%A2micos"><i class="fa fa-check"></i><b>10.6.1</b> Efeitos dinâmicos</a></li>
<li class="chapter" data-level="10.6.2" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html#placebo-test"><i class="fa fa-check"></i><b>10.6.2</b> Placebo test</a></li>
<li class="chapter" data-level="10.6.3" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html#teste-de-no-carryover"><i class="fa fa-check"></i><b>10.6.3</b> Teste de no-carryover</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html#synthetic-did"><i class="fa fa-check"></i><b>10.7</b> Synthetic DiD</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="11-Synth.html"><a href="#implementa%C3%A7%C3%A3o-no-r"><i class="fa fa-check"></i><b>10.7.1</b> Implementação no R</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html#trop-estimador-triplamente-robusto"><i class="fa fa-check"></i><b>10.8</b> TROP: estimador triplamente robusto</a></li>
<li class="chapter" data-level="10.9" data-path="11-Synth.html"><a href="#quando-usar-cada-m%C3%A9todo-guia-pr%C3%A1tico"><i class="fa fa-check"></i><b>10.9</b> Quando usar cada método: guia prático</a></li>
<li class="chapter" data-level="10.10" data-path="controle-sintético-e-estimação-contrafactual.html"><a href="controle-sintético-e-estimação-contrafactual.html#resumo-2"><i class="fa fa-check"></i><b>10.10</b> Resumo</a></li>
<li class="chapter" data-level="10.11" data-path="11-Synth.html"><a href="#refer%C3%AAncias-8"><i class="fa fa-check"></i><b>10.11</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="llms-e-outras.html"><a href="llms-e-outras.html"><i class="fa fa-check"></i><b>11</b> LLMs e outras</a>
<ul>
<li class="chapter" data-level="11.1" data-path="llms-e-outras.html"><a href="llms-e-outras.html#google-colab"><i class="fa fa-check"></i><b>11.1</b> Google Colab</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>12</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="12.1" data-path="11-Synth.html"><a href="#introdu%C3%A7%C3%A3o-6"><i class="fa fa-check"></i><b>12.1</b> Introdução</a></li>
<li class="chapter" data-level="12.2" data-path="machine-learning.html"><a href="machine-learning.html#terminologia"><i class="fa fa-check"></i><b>12.2</b> Terminologia</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="machine-learning.html"><a href="machine-learning.html#lasso"><i class="fa fa-check"></i><b>12.2.1</b> LASSO</a></li>
<li class="chapter" data-level="12.2.2" data-path="machine-learning.html"><a href="machine-learning.html#double-lasso"><i class="fa fa-check"></i><b>12.2.2</b> Double Lasso</a></li>
<li class="chapter" data-level="12.2.3" data-path="11-Synth.html"><a href="#outras-solu%C3%A7%C3%B5es-ineficazes"><i class="fa fa-check"></i><b>12.2.3</b> Outras soluções ineficazes</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="machine-learning.html"><a href="machine-learning.html#dl---algoritmo"><i class="fa fa-check"></i><b>12.3</b> DL - Algoritmo</a></li>
<li class="chapter" data-level="12.4" data-path="11-Synth.html"><a href="#termos-de-intera%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>12.4</b> Termos de Interação</a></li>
<li class="chapter" data-level="12.5" data-path="11-Synth.html"><a href="#aplica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>12.5</b> Aplicação</a></li>
<li class="chapter" data-level="12.6" data-path="machine-learning.html"><a href="machine-learning.html#dml"><i class="fa fa-check"></i><b>12.6</b> DML</a></li>
<li class="chapter" data-level="12.7" data-path="machine-learning.html"><a href="machine-learning.html#double-debiasing"><i class="fa fa-check"></i><b>12.7</b> Double Debiasing</a></li>
<li class="chapter" data-level="12.8" data-path="machine-learning.html"><a href="machine-learning.html#cross-fitting"><i class="fa fa-check"></i><b>12.8</b> Cross-fitting</a></li>
<li class="chapter" data-level="12.9" data-path="11-Synth.html"><a href="#quest%C3%B5es-pr%C3%A1ticas"><i class="fa fa-check"></i><b>12.9</b> Questões Práticas</a></li>
<li class="chapter" data-level="12.10" data-path="11-Synth.html"><a href="#resumo-e-pr%C3%B3ximos-passos-4"><i class="fa fa-check"></i><b>12.10</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="12.11" data-path="11-Synth.html"><a href="#refer%C3%AAncias-9"><i class="fa fa-check"></i><b>12.11</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="resumo-3.html"><a href="resumo-3.html"><i class="fa fa-check"></i><b>13</b> Resumo</a>
<ul>
<li class="chapter" data-level="13.1" data-path="resumo-3.html"><a href="resumo-3.html#matching-2"><i class="fa fa-check"></i><b>13.1</b> Matching</a></li>
<li class="chapter" data-level="13.2" data-path="resumo-3.html"><a href="resumo-3.html#iv"><i class="fa fa-check"></i><b>13.2</b> IV</a></li>
<li class="chapter" data-level="13.3" data-path="resumo-3.html"><a href="resumo-3.html#rdd"><i class="fa fa-check"></i><b>13.3</b> RDD</a></li>
<li class="chapter" data-level="13.4" data-path="resumo-3.html"><a href="resumo-3.html#did"><i class="fa fa-check"></i><b>13.4</b> DiD</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="resumo-3.html"><a href="resumo-3.html#tscs"><i class="fa fa-check"></i><b>13.4.1</b> TSCS</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="resumo-3.html"><a href="resumo-3.html#scm"><i class="fa fa-check"></i><b>13.5</b> SCM</a></li>
<li class="chapter" data-level="13.6" data-path="11-Synth.html"><a href="#did-sint%C3%A9tico"><i class="fa fa-check"></i><b>13.6</b> DiD Sintético</a></li>
<li class="chapter" data-level="13.7" data-path="resumo-3.html"><a href="resumo-3.html#double-lasso-1"><i class="fa fa-check"></i><b>13.7</b> Double LASSO</a></li>
<li class="chapter" data-level="13.8" data-path="resumo-3.html"><a href="resumo-3.html#dml-1"><i class="fa fa-check"></i><b>13.8</b> DML</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="shift-share.html"><a href="shift-share.html"><i class="fa fa-check"></i><b>14</b> Shift-share</a>
<ul>
<li class="chapter" data-level="14.1" data-path="11-Synth.html"><a href="#introdu%C3%A7%C3%A3o-7"><i class="fa fa-check"></i><b>14.1</b> Introdução</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="11-Synth.html"><a href="#aplica%C3%A7%C3%A3o-pib-por-estado-e-setor"><i class="fa fa-check"></i><b>14.1.1</b> Aplicação: PIB por estado e setor</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="11-Synth.html"><a href="#exemplos-da-pol%C3%ADtica"><i class="fa fa-check"></i><b>14.2</b> Exemplos da Política</a></li>
<li class="chapter" data-level="14.3" data-path="11-Synth.html"><a href="#varia%C3%A7%C3%A3o-temporal"><i class="fa fa-check"></i><b>14.3</b> Variação temporal</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="11-Synth.html"><a href="#aplica%C3%A7%C3%A3o-elei%C3%A7%C3%B5es-presidenciais-20142018"><i class="fa fa-check"></i><b>14.3.1</b> Aplicação: Eleições presidenciais 2014→2018</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="11-Synth.html"><a href="#o-instrumento-shift-share-como-vari%C3%A1vel-instrumental"><i class="fa fa-check"></i><b>14.4</b> O instrumento shift-share como variável instrumental</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="11-Synth.html"><a href="#constru%C3%A7%C3%A3o-formal"><i class="fa fa-check"></i><b>14.4.1</b> Construção formal</a></li>
<li class="chapter" data-level="14.4.2" data-path="shift-share.html"><a href="shift-share.html#voltando-ao-exemplo-construindo-w_ik-g_k-e-b_i-com-dados-eleitorais"><i class="fa fa-check"></i><b>14.4.2</b> Voltando ao exemplo: construindo <span class="math inline">\(w_{ik}\)</span>, <span class="math inline">\(g_k\)</span> e <span class="math inline">\(B_i\)</span> com dados eleitorais</a></li>
<li class="chapter" data-level="14.4.3" data-path="shift-share.html"><a href="shift-share.html#o-modelo-estrutural-e-o-iv"><i class="fa fa-check"></i><b>14.4.3</b> O modelo estrutural e o IV</a></li>
<li class="chapter" data-level="14.4.4" data-path="shift-share.html"><a href="shift-share.html#interpretando-o-modelo-com-o-exemplo-eleitoral"><i class="fa fa-check"></i><b>14.4.4</b> Interpretando o modelo com o exemplo eleitoral</a></li>
<li class="chapter" data-level="14.4.5" data-path="11-Synth.html"><a href="#por-que-o-instrumento-seria-v%C3%A1lido-uma-discuss%C3%A3o-intuitiva"><i class="fa fa-check"></i><b>14.4.5</b> Por que o instrumento seria válido? Uma discussão intuitiva</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="11-Synth.html"><a href="#duas-estrat%C3%A9gias-de-identifica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>14.5</b> Duas estratégias de identificação</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="11-Synth.html"><a href="#estrat%C3%A9gia-1-exogeneidade-das-shares-gpss-2020"><i class="fa fa-check"></i><b>14.5.1</b> Estratégia 1: Exogeneidade das shares (GPSS 2020)</a></li>
<li class="chapter" data-level="14.5.2" data-path="11-Synth.html"><a href="#estrat%C3%A9gia-2-exogeneidade-dos-shifts-bhj-2022"><i class="fa fa-check"></i><b>14.5.2</b> Estratégia 2: Exogeneidade dos shifts (BHJ 2022)</a></li>
<li class="chapter" data-level="14.5.3" data-path="11-Synth.html"><a href="#resumo-das-duas-estrat%C3%A9gias"><i class="fa fa-check"></i><b>14.5.3</b> Resumo das duas estratégias</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="11-Synth.html"><a href="#o-problema-de-infer%C3%AAncia"><i class="fa fa-check"></i><b>14.6</b> O problema de inferência</a></li>
<li class="chapter" data-level="14.7" data-path="11-Synth.html"><a href="#implementa%C3%A7%C3%A3o-em-r"><i class="fa fa-check"></i><b>14.7</b> Implementação em R</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="11-Synth.html"><a href="#constru%C3%A7%C3%A3o-do-instrumento"><i class="fa fa-check"></i><b>14.7.1</b> Construção do instrumento</a></li>
<li class="chapter" data-level="14.7.2" data-path="11-Synth.html"><a href="#estima%C3%A7%C3%A3o-iv"><i class="fa fa-check"></i><b>14.7.2</b> Estimação IV</a></li>
<li class="chapter" data-level="14.7.3" data-path="11-Synth.html"><a href="#erros-padr%C3%A3o-corrigidos-pacote-shiftsharese"><i class="fa fa-check"></i><b>14.7.3</b> Erros-padrão corrigidos: pacote <code>ShiftShareSE</code></a></li>
<li class="chapter" data-level="14.7.4" data-path="11-Synth.html"><a href="#agrega%C3%A7%C3%A3o-ao-n%C3%ADvel-do-choque-pacote-ssaggregate"><i class="fa fa-check"></i><b>14.7.4</b> Agregação ao nível do choque: pacote <code>ssaggregate</code></a></li>
<li class="chapter" data-level="14.7.5" data-path="shift-share.html"><a href="shift-share.html#ecossistema-r-vs.-stata"><i class="fa fa-check"></i><b>14.7.5</b> Ecossistema R vs. Stata</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="11-Synth.html"><a href="#aplica%C3%A7%C3%B5es-em-ci%C3%AAncia-pol%C3%ADtica"><i class="fa fa-check"></i><b>14.8</b> Aplicações em Ciência Política</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path="11-Synth.html"><a href="#com%C3%A9rcio-e-voto-nos-eua"><i class="fa fa-check"></i><b>14.8.1</b> Comércio e voto nos EUA</a></li>
<li class="chapter" data-level="14.8.2" data-path="11-Synth.html"><a href="#com%C3%A9rcio-e-nacionalismo-na-europa"><i class="fa fa-check"></i><b>14.8.2</b> Comércio e nacionalismo na Europa</a></li>
<li class="chapter" data-level="14.8.3" data-path="11-Synth.html"><a href="#valores-autorit%C3%A1rios"><i class="fa fa-check"></i><b>14.8.3</b> Valores autoritários</a></li>
<li class="chapter" data-level="14.8.4" data-path="11-Synth.html"><a href="#welfare-state-hist%C3%B3rico"><i class="fa fa-check"></i><b>14.8.4</b> Welfare state histórico</a></li>
<li class="chapter" data-level="14.8.5" data-path="11-Synth.html"><a href="#automa%C3%A7%C3%A3o-e-redistribui%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>14.8.5</b> Automação e redistribuição</a></li>
<li class="chapter" data-level="14.8.6" data-path="shift-share.html"><a href="shift-share.html#brasil"><i class="fa fa-check"></i><b>14.8.6</b> Brasil</a></li>
<li class="chapter" data-level="14.8.7" data-path="11-Synth.html"><a href="#competi%C3%A7%C3%A3o-pol%C3%ADtica-e-desmatamento"><i class="fa fa-check"></i><b>14.8.7</b> Competição política e desmatamento</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="11-Synth.html"><a href="#aplica%C3%A7%C3%B5es-em-rela%C3%A7%C3%B5es-internacionais"><i class="fa fa-check"></i><b>14.9</b> Aplicações em Relações Internacionais</a>
<ul>
<li class="chapter" data-level="14.9.1" data-path="11-Synth.html"><a href="#com%C3%A9rcio-e-pol%C3%ADtica-externa"><i class="fa fa-check"></i><b>14.9.1</b> Comércio e política externa</a></li>
<li class="chapter" data-level="14.9.2" data-path="11-Synth.html"><a href="#comportamento-legislativo-em-pol%C3%ADtica-comercial"><i class="fa fa-check"></i><b>14.9.2</b> Comportamento legislativo em política comercial</a></li>
<li class="chapter" data-level="14.9.3" data-path="shift-share.html"><a href="shift-share.html#temas-com-potencial-inexplorado-em-ri"><i class="fa fa-check"></i><b>14.9.3</b> Temas com potencial inexplorado em RI</a></li>
</ul></li>
<li class="chapter" data-level="14.10" data-path="11-Synth.html"><a href="#refer%C3%AAncias-10"><i class="fa fa-check"></i><b>14.10</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="11-Synth.html"><a href="#interfer%C3%AAncia-spillover-e-din%C3%A2mica"><i class="fa fa-check"></i><b>15</b> Interferência, spillover e dinâmica</a>
<ul>
<li class="chapter" data-level="15.1" data-path="11-Synth.html"><a href="#suposi%C3%A7%C3%B5es-simplificadoras"><i class="fa fa-check"></i><b>15.1</b> Suposições simplificadoras</a></li>
<li class="chapter" data-level="15.2" data-path="11-Synth.html"><a href="#po-com-tratamento-de-m%C3%BAltiplos-valores-multi-valued"><i class="fa fa-check"></i><b>15.2</b> PO com tratamento de múltiplos valores (multi-valued)</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="interferência-spillover-e-dinâmica.html"><a href="interferência-spillover-e-dinâmica.html"><i class="fa fa-check"></i><b>15.2.1</b> Multi-valued discreto</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="11-Synth.html"><a href="#din%C3%A2mica"><i class="fa fa-check"></i><b>15.3</b> Dinâmica</a></li>
<li class="chapter" data-level="15.4" data-path="11-Synth.html"><a href="#interfer%C3%AAncia"><i class="fa fa-check"></i><b>15.4</b> Interferência</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Curso de Inferência Causal</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="controle-sintético-e-estimação-contrafactual" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Capítulo 10</span> Controle Sintético e Estimação Contrafactual<a href="#controle-sint%C3%A9tico-e-estima%C3%A7%C3%A3o-contrafactual" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="motivação" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Motivação<a href="#motiva%C3%A7%C3%A3o" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>No capítulo 8, vimos que o DiD requer tendências paralelas: na ausência de tratamento, tratados e controles teriam evoluído de forma similar. Mas essa suposição é frequentemente violada — especialmente quando há poucas unidades tratadas (às vezes apenas uma) ou quando confundidores variam no tempo de forma heterogênea entre grupos.</p>
<p>Este capítulo apresenta uma família de métodos que compartilham a mesma lógica: <strong>imputar o contrafactual</strong> <span class="math inline">\(Y_{it}(0)\)</span> para as observações tratadas. A diferença entre eles está no <em>modelo</em> que usam para essa imputação e nas <em>restrições</em> que impõem:</p>
<ul>
<li>O <strong>Controle Sintético</strong> (SCM) constrói o contrafactual como combinação convexa de unidades não-tratadas.</li>
<li>O <strong>framework de estimação contrafactual</strong> (Liu, Wang &amp; Xu, 2024) generaliza a imputação para três estimadores — FEct, IFEct e MC — com diagnósticos formais.</li>
<li>O <strong>Synthetic DiD</strong> (Arkhangelsky et al., 2021) combina pesos de unidade (como SCM) com pesos temporais e efeitos fixos (como DiD).</li>
<li>O <strong>TROP</strong> (Athey et al., 2025) combina um modelo de fatores com pesos de unidade e pesos temporais, obtendo tripla robustez.</li>
</ul>
<p><strong>Mapa do capítulo.</strong> As seções 2–3 cobrem o SCM clássico e sua implementação no R. A seção 4 introduz o framework de estimação contrafactual. A seção 5 apresenta os três estimadores (FEct, IFEct, MC) com aplicação empírica. A seção 6 discute diagnósticos. A seção 7 apresenta o Synthetic DiD. A seção 8 introduz o TROP. A seção 9 oferece um guia prático de escolha entre métodos. A seção 10 resume o capítulo.</p>
</div>
<div id="controle-sintético-clássico" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Controle Sintético clássico<a href="#controle-sint%C3%A9tico-cl%C3%A1ssico" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O método de controle sintético foi originalmente proposto por Abadie e Gardeazabal (2003) para estimar os custos econômicos do conflito no País Basco, e posteriormente formalizado e popularizado por Abadie, Diamond e Hainmueller (2010, 2015). Vamos começar com o exemplo clássico de Abadie, Diamond e Hainmueller (2010). O estado da Califórnia implementou a Proposição 99, uma proibição parcial do uso de cigarros. Nosso estimando é o efeito dessa política sobre as vendas per capita de cigarros:</p>
<p><span class="math display">\[
\tau_t = Y_{CA,t}(1) - Y_{CA,t}(0), \quad \text{para } t &gt; 1988
\]</span></p>
<p>Como não observamos <span class="math inline">\(Y_{CA,t}(0)\)</span>, precisamos construir uma “Califórnia Sintética” — uma média ponderada dos demais estados que reproduza a trajetória da Califórnia no período pré-tratamento.</p>
<table>
<thead>
<tr class="header">
<th align="right">state</th>
<th align="right">year</th>
<th align="right">cigsale</th>
<th align="right">retprice</th>
<th align="left">california</th>
<th align="left">after_treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1970</td>
<td align="right">89.8</td>
<td align="right">39.6</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1971</td>
<td align="right">95.4</td>
<td align="right">42.7</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1972</td>
<td align="right">101.1</td>
<td align="right">42.3</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1973</td>
<td align="right">102.9</td>
<td align="right">42.1</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1974</td>
<td align="right">108.2</td>
<td align="right">43.1</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1975</td>
<td align="right">111.7</td>
<td align="right">46.6</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p><img src="bookdownproj_files/figure-html/cigarro-1.png" alt="" width="672" /></p>
<p>A média simples dos demais estados (linha tracejada) não é um bom contrafactual: os estados diferem em nível e tendência. A ideia do SCM é encontrar pesos que produzam uma combinação dos estados de controle que replique a trajetória pré-tratamento da Califórnia.</p>
<div id="formalização" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Formalização<a href="#formaliza%C3%A7%C3%A3o" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suponha que temos dados para <span class="math inline">\(J+1\)</span> unidades por <span class="math inline">\(T\)</span> períodos: <span class="math inline">\(1, 2, \ldots, T_0, T_0+1, \ldots, T\)</span>. A primeira unidade (<span class="math inline">\(j=1\)</span>) é tratada a partir de <span class="math inline">\(T_0+1\)</span>. As demais <span class="math inline">\(j = 2, \ldots, J+1\)</span> formam o <em>donor pool</em>. Para cada unidade, observamos um vetor de <span class="math inline">\(k\)</span> preditores <span class="math inline">\(\mathbf{X}_j\)</span>, que pode incluir valores pré-intervenção da variável resposta.</p>
<p>Os dados podem ser organizados em blocos, onde as linhas representam períodos (pré e pós-tratamento) e as colunas representam unidades (controle e tratada):</p>
<span class="math display">\[\begin{aligned}
D \;=\;
\underset{\text{linhas: períodos}}{\underbrace{
\begin{pmatrix}
\mathbf{0} &amp; \mathbf{0}  \\
\mathbf{0} &amp; \mathbf{1}
\end{pmatrix}
}}
\quad
\begin{matrix}
\leftarrow \text{pré} \\
\leftarrow \text{pós}
\end{matrix}
\qquad
Y \;=\;
\underset{\text{colunas: controle | tratada}}{\underbrace{
\begin{pmatrix}
Y_{co, pre}(0) &amp; Y_{tr, pre}(0)  \\
Y_{co, post}(0)  &amp; Y_{tr, post}(1)
\end{pmatrix}
}}
\end{aligned}\]</span>
<p>O estimando é o ATT para os períodos pós-tratamento:
<span class="math display">\[
\tau_t = \mathbb{E}[Y_{it}(1) \mid D_{it}=1] - \mathbb{E}[Y_{it}(0) \mid D_{it}=1]
\]</span></p>
<p>O contrafactual é estimado como média ponderada do donor pool:
<span class="math display">\[
\hat{Y}_{tr, t}(0) = \sum_{j \in co} w_j Y_{j,t}
\]</span></p>
<p>com as restrições:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(\sum_j w_j = 1\)</span> (combinação convexa)</li>
<li><span class="math inline">\(w_j \geq 0\)</span>, <span class="math inline">\(\forall j\)</span> (pesos não-negativos)</li>
</ol>
<p><strong>Nota:</strong> Generalizações posteriores (Doudchenko &amp; Imbens, 2016) permitem a inclusão de um intercepto <span class="math inline">\(\mu\)</span> na estimação, isto é, <span class="math inline">\(\hat{Y}_{tr, t}(0) = \mu + \sum_{j \in co} w_j Y_{j,t}\)</span>, e até a remoção da restrição de não-negatividade. Essa extensão conecta o SCM ao SDiD (seção 7), que inclui efeitos fixos de unidade explicitamente.</p>
<p>As restrições de convexidade <em>limitam</em> a extrapolação — o contrafactual é uma interpolação no espaço de pesos do donor pool — mas não a eliminam completamente. Se nenhuma combinação convexa dos controles reproduzir bem os preditores da unidade tratada, pode haver viés residual. A literatura subsequente (Doudchenko &amp; Imbens, 2016; Ben-Michael et al., 2021) argumenta que permitir alguma extrapolação (relaxando a convexidade) pode melhorar o desempenho, o que motiva o SCM aumentado (<em>augmented SCM</em>). Ainda assim, a convexidade oferece uma disciplina importante em relação à regressão linear, que pode extrapolar livremente.</p>
<p>Os pesos são obtidos minimizando a distância entre os preditores da unidade tratada e a combinação ponderada dos controles:
<span class="math display">\[
\hat{\mathbf{W}}(V) = \arg\min_{\mathbf{W}} (\mathbf{X}_{tr} - \mathbf{X}_{co}\mathbf{W})&#39; V (\mathbf{X}_{tr} - \mathbf{X}_{co}\mathbf{W})
\]</span>
onde <span class="math inline">\(\mathbf{X}\)</span> inclui a variável dependente defasada como preditor, e <span class="math inline">\(V\)</span> é uma matriz diagonal positiva semidefinida (<span class="math inline">\(k \times k\)</span>) que atribui importância relativa a cada preditor. A escolha de <span class="math inline">\(V\)</span> é feita por uma otimização aninhada (<em>nested optimization</em>): no loop externo, <span class="math inline">\(V\)</span> é escolhida para minimizar o RMSPE (<em>Root Mean Squared Prediction Error</em>) no período pré-tratamento; no loop interno, dado <span class="math inline">\(V\)</span>, os pesos <span class="math inline">\(\mathbf{W}\)</span> são otimizados. Isso significa que os resultados do SCM dependem da escolha dos preditores incluídos em <span class="math inline">\(\mathbf{X}\)</span> — tanto a seleção quanto a ponderação dos preditores afetam a solução final.</p>
<p><strong>Por que o SCM funciona?</strong> Sob um modelo linear de fatores <span class="math inline">\(Y_{it}(0) = \delta_t + \theta_t Z_i + \lambda_t \mu_i + \varepsilon_{it}\)</span>, onde <span class="math inline">\(Z_i\)</span> são covariáveis observadas, <span class="math inline">\(\mu_i\)</span> são fatores não-observados e <span class="math inline">\(\lambda_t\)</span> são cargas temporais, Abadie, Diamond e Hainmueller (2010, Proposição 1) mostram que, se existem pesos que reproduzem exatamente os preditores pré-tratamento da unidade tratada (isto é, <span class="math inline">\(\mathbf{X}_{tr} = \mathbf{X}_{co}\mathbf{W}\)</span>), então o viés do SCM desaparece quando <span class="math inline">\(T_0 \to \infty\)</span>. Intuitivamente, ao reproduzir as trajetórias pré-tratamento e as covariáveis observadas, o controle sintético também reproduz os fatores latentes não-observados — que são a fonte de viés na ausência de tendências paralelas.</p>
<p><strong>Risco de sobreajuste.</strong> Otimizar o ajuste pré-tratamento pode levar a <em>overfitting</em>, especialmente quando se incluem todos os valores defasados da variável resposta como preditores. Kaul et al. (2022) mostram que incluir todas as defasagens torna os demais preditores irrelevantes para a otimização. A recomendação prática é usar defasagens selecionadas (por exemplo, <span class="math inline">\(Y_{i,T_0}\)</span>, <span class="math inline">\(Y_{i,T_0/2}\)</span>) e médias de covariáveis, em vez de todos os resultados pré-tratamento. O pesquisador deve justificar a escolha de preditores com base em conhecimento substantivo e verificar a robustez dos resultados a especificações alternativas (Abadie, 2021).</p>
</div>
</div>
<div id="implementação-do-scm-no-r" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Implementação do SCM no R<a href="#implementa%C3%A7%C3%A3o-do-scm-no-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Usamos o pacote <code>tidysynth</code>, que oferece uma interface moderna para o SCM.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb150-1" tabindex="-1"></a><span class="fu">library</span>(tidysynth)</span>
<span id="cb150-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb150-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb150-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb150-3" tabindex="-1"></a><span class="fu">data</span>(smoking)</span>
<span id="cb150-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb150-4" tabindex="-1"></a></span>
<span id="cb150-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb150-5" tabindex="-1"></a>smoking <span class="sc">%&gt;%</span></span>
<span id="cb150-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb150-6" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb150-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb150-7" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">year</th>
<th align="right">cigsale</th>
<th align="right">lnincome</th>
<th align="right">beer</th>
<th align="right">age15to24</th>
<th align="right">retprice</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Rhode Island</td>
<td align="right">1970</td>
<td align="right">123.9</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.1831579</td>
<td align="right">39.3</td>
</tr>
<tr class="even">
<td align="left">Tennessee</td>
<td align="right">1970</td>
<td align="right">99.8</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.1780438</td>
<td align="right">39.9</td>
</tr>
<tr class="odd">
<td align="left">Indiana</td>
<td align="right">1970</td>
<td align="right">134.6</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.1765159</td>
<td align="right">30.6</td>
</tr>
<tr class="even">
<td align="left">Nevada</td>
<td align="right">1970</td>
<td align="right">189.5</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.1615542</td>
<td align="right">38.9</td>
</tr>
<tr class="odd">
<td align="left">Louisiana</td>
<td align="right">1970</td>
<td align="right">115.9</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.1851852</td>
<td align="right">34.3</td>
</tr>
<tr class="even">
<td align="left">Oklahoma</td>
<td align="right">1970</td>
<td align="right">108.4</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">0.1754592</td>
<td align="right">38.4</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-1" tabindex="-1"></a>smoking_out <span class="ot">&lt;-</span></span>
<span id="cb151-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-2" tabindex="-1"></a>  smoking <span class="sc">%&gt;%</span></span>
<span id="cb151-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-3" tabindex="-1"></a>  <span class="fu">synthetic_control</span>(<span class="at">outcome =</span> cigsale,</span>
<span id="cb151-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-4" tabindex="-1"></a>                    <span class="at">unit =</span> state,</span>
<span id="cb151-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-5" tabindex="-1"></a>                    <span class="at">time =</span> year,</span>
<span id="cb151-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-6" tabindex="-1"></a>                    <span class="at">i_unit =</span> <span class="st">&quot;California&quot;</span>,</span>
<span id="cb151-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-7" tabindex="-1"></a>                    <span class="at">i_time =</span> <span class="dv">1988</span>,</span>
<span id="cb151-8"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-8" tabindex="-1"></a>                    <span class="at">generate_placebos=</span>T</span>
<span id="cb151-9"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-9" tabindex="-1"></a>                    ) <span class="sc">%&gt;%</span></span>
<span id="cb151-10"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-10" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1980</span><span class="sc">:</span><span class="dv">1988</span>,</span>
<span id="cb151-11"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-11" tabindex="-1"></a>                     <span class="at">ln_income =</span> <span class="fu">mean</span>(lnincome, <span class="at">na.rm =</span> T),</span>
<span id="cb151-12"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-12" tabindex="-1"></a>                     <span class="at">ret_price =</span> <span class="fu">mean</span>(retprice, <span class="at">na.rm =</span> T),</span>
<span id="cb151-13"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-13" tabindex="-1"></a>                     <span class="at">youth =</span> <span class="fu">mean</span>(age15to24, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb151-14"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-14" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1984</span><span class="sc">:</span><span class="dv">1988</span>,</span>
<span id="cb151-15"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-15" tabindex="-1"></a>                     <span class="at">beer_sales =</span> <span class="fu">mean</span>(beer, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb151-16"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-16" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1975</span>,</span>
<span id="cb151-17"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-17" tabindex="-1"></a>                     <span class="at">cigsale_1975 =</span> cigsale) <span class="sc">%&gt;%</span></span>
<span id="cb151-18"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-18" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1980</span>,</span>
<span id="cb151-19"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-19" tabindex="-1"></a>                     <span class="at">cigsale_1980 =</span> cigsale) <span class="sc">%&gt;%</span></span>
<span id="cb151-20"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-20" tabindex="-1"></a>  <span class="fu">generate_predictor</span>(<span class="at">time_window =</span> <span class="dv">1988</span>,</span>
<span id="cb151-21"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-21" tabindex="-1"></a>                     <span class="at">cigsale_1988 =</span> cigsale) <span class="sc">%&gt;%</span></span>
<span id="cb151-22"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-22" tabindex="-1"></a>  <span class="fu">generate_weights</span>(<span class="at">optimization_window =</span> <span class="dv">1970</span><span class="sc">:</span><span class="dv">1988</span>,</span>
<span id="cb151-23"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-23" tabindex="-1"></a>                   <span class="at">margin_ipop =</span> .<span class="dv">02</span>,<span class="at">sigf_ipop =</span> <span class="dv">7</span>,<span class="at">bound_ipop =</span> <span class="dv">6</span></span>
<span id="cb151-24"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-24" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb151-25"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-25" tabindex="-1"></a>  <span class="fu">generate_control</span>()</span>
<span id="cb151-26"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-26" tabindex="-1"></a></span>
<span id="cb151-27"><a href="controle-sintético-e-estimação-contrafactual.html#cb151-27" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">plot_trends</span>(<span class="at">time_window =</span> <span class="dv">1970</span><span class="sc">:</span><span class="dv">2000</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/cigarro_tidysynth-1.png" alt="" width="672" /></p>
<p>O gráfico mostra que a Califórnia Sintética acompanha bem a trajetória real no período pré-1988, e diverge no período pós — essa divergência é a estimativa do efeito causal.</p>
<p>A quantidade causal de interesse — a diferença entre observado e sintético — pode ser visualizada diretamente:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb152-1" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">plot_differences</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/cigarro_tidysynth1-1.png" alt="" width="672" /></p>
<p>Os pesos atribuídos a cada estado e a cada variável preditora:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb153-1" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">plot_weights</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/cigarro_tidysynth2-1.png" alt="" width="672" /></p>
<p>O balanceamento entre a Califórnia real e a sintética nos preditores:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb154-1" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">grab_balance_table</span>()</span></code></pre></div>
<pre><code>## # A tibble: 7 × 4
##   variable     California synthetic_California donor_sample
##   &lt;chr&gt;             &lt;dbl&gt;                &lt;dbl&gt;        &lt;dbl&gt;
## 1 ln_income        10.1                  9.85         9.83 
## 2 ret_price        89.4                 89.4         87.3  
## 3 youth             0.174                0.174        0.173
## 4 beer_sales       24.3                 24.2         23.7  
## 5 cigsale_1975    127.                 127.         137.   
## 6 cigsale_1980    120.                 120.         138.   
## 7 cigsale_1988     90.1                 91.4        114.</code></pre>
<div id="inferência-por-placebo" class="section level3 hasAnchor" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Inferência por placebo<a href="#infer%C3%AAncia-por-placebo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A inferência no SCM é feita por testes placebo. A intuição é a de um teste de permutação: para cada estado do donor pool, fingimos que ele foi tratado e estimamos um SCM. Se o efeito da Califórnia for grande relativo aos placebos, concluímos que é estatisticamente significativo.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb156-1" tabindex="-1"></a>smoking_out <span class="sc">%&gt;%</span> <span class="fu">plot_placebos</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/cigarro_tidysynth3-1.png" alt="" width="672" /></p>
<p>O efeito estimado para a Califórnia (linha escura) é claramente maior do que os efeitos placebo (linhas cinzas), sugerindo que a Proposição 99 de fato reduziu o consumo de cigarros.</p>
<p>Para formalizar a inferência, Abadie, Diamond e Hainmueller (2010, seção 4) propõem construir p-valores a partir da distribuição de razões de RMSPE: para cada unidade placebo <span class="math inline">\(j\)</span>, calcula-se a razão entre o RMSPE pós-tratamento e o RMSPE pré-tratamento. Se a razão da unidade tratada for extrema em relação à distribuição dos placebos, o efeito é considerado significativo. Formalmente, o p-valor é a fração de unidades (incluindo a tratada) cuja razão RMSPE é pelo menos tão grande quanto a da unidade tratada. Chernozhukov, Wüthrich e Zhu (2021) desenvolvem um método de inferência conformal para o SCM que fornece p-valores com validade em amostra finita, sem depender de aproximações assintóticas.</p>
<p><strong>Sensibilidade ao donor pool.</strong> Os resultados do SCM podem ser sensíveis à composição do donor pool. O pesquisador deve justificar os critérios de inclusão e exclusão de unidades de controle com base em conhecimento substantivo — por exemplo, excluindo estados com políticas antitabaco similares ou com características estruturais muito diferentes (Abadie, 2021). Recomenda-se verificar a robustez das estimativas a variações na composição do donor pool.</p>
</div>
</div>
<div id="framework-de-estimação-contrafactual" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Framework de estimação contrafactual<a href="#framework-de-estima%C3%A7%C3%A3o-contrafactual" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O SCM clássico é uma ferramenta poderosa para estudos de caso com uma única unidade tratada. Mas e quando temos múltiplas unidades tratadas com tratamento escalonado no tempo? E quando queremos diagnósticos formais sobre a qualidade da estimação?</p>
<p>Liu, Wang e Xu (2024) propõem um framework unificado de <strong>estimação contrafactual</strong> que generaliza o SCM e o DiD por imputação. A ideia central é a mesma: estimar <span class="math inline">\(Y_{it}(0)\)</span> para as observações tratadas e calcular o efeito como a diferença entre observado e contrafactual.</p>
<div id="setup" class="section level3 hasAnchor" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Setup<a href="controle-sintético-e-estimação-contrafactual.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Considere um painel com <span class="math inline">\(N\)</span> unidades e <span class="math inline">\(T\)</span> períodos. O indicador de tratamento <span class="math inline">\(D_{it}\)</span> pode variar por unidade e tempo (tratamento escalonado, e inclusive pode “ligar e desligar”). Particione as observações em dois conjuntos:</p>
<ul>
<li><span class="math inline">\(\mathcal{C}_0\)</span>: observações não-tratadas (<span class="math inline">\(D_{it} = 0\)</span>), usadas para estimar o modelo</li>
<li><span class="math inline">\(\mathcal{M}\)</span>: observações tratadas (<span class="math inline">\(D_{it} = 1\)</span>), para as quais imputamos o contrafactual</li>
</ul>
<p>O efeito individual do tratamento é <span class="math inline">\(\delta_{it} = Y_{it}(1) - Y_{it}(0)\)</span>, e o estimando é:
<span class="math display">\[
ATT = \mathbb{E}[\delta_{it} \mid D_{it} = 1] = \frac{1}{|\mathcal{M}|} \sum_{(i,t) \in \mathcal{M}} \delta_{it}
\]</span></p>
<p>A segunda igualdade vale sob uma interpretação <em>design-based</em>, em que o painel observado é a população de interesse (não uma amostra de uma superpopulação). Nesse caso, a expectativa é sobre a atribuição de tratamento, e a média amostral coincide com o parâmetro populacional.</p>
</div>
<div id="estratégia-de-estimação-em-quatro-passos" class="section level3 hasAnchor" number="10.4.2">
<h3><span class="header-section-number">10.4.2</span> Estratégia de estimação em quatro passos<a href="#estrat%C3%A9gia-de-estima%C3%A7%C3%A3o-em-quatro-passos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><strong>Ajustar</strong> o modelo de <span class="math inline">\(Y_{it}(0)\)</span> usando apenas as observações em <span class="math inline">\(\mathcal{C}_0\)</span></li>
<li><strong>Prever</strong> o contrafactual <span class="math inline">\(\hat{Y}_{it}(0)\)</span> para cada <span class="math inline">\((i,t) \in \mathcal{M}\)</span></li>
<li><strong>Calcular</strong> <span class="math inline">\(\hat{\delta}_{it} = Y_{it} - \hat{Y}_{it}(0)\)</span> para cada observação tratada</li>
<li><strong>Agregar</strong> os efeitos: <span class="math inline">\(\widehat{ATT} = \frac{1}{|\mathcal{M}|} \sum_{(i,t) \in \mathcal{M}} \hat{\delta}_{it}\)</span></li>
</ol>
<p>Essa estratégia evita o problema de pesos negativos do TWFE (capítulo 8): cada observação tratada recebe peso uniforme <span class="math inline">\(1/|\mathcal{M}|\)</span> na agregação.</p>
</div>
<div id="suposições-de-identificação-1" class="section level3 hasAnchor" number="10.4.3">
<h3><span class="header-section-number">10.4.3</span> Suposições de identificação<a href="#suposi%C3%A7%C3%B5es-de-identifica%C3%A7%C3%A3o-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O framework requer três suposições (Liu et al., 2024, p. 163):</p>
<ul>
<li><strong>Suposição 1 (Forma funcional)</strong>: <span class="math inline">\(Y_{it}(0) = h(U_{it}) + \varepsilon_{it}\)</span>, onde <span class="math inline">\(h\)</span> é uma função desconhecida e <span class="math inline">\(U_{it}\)</span> são fatores latentes.</li>
<li><strong>Suposição 2 (Exogeneidade estrita)</strong>: <span class="math inline">\(\mathbb{E}[\varepsilon_{it} | U_{i1}, \ldots, U_{iT}, D_{i1}, \ldots, D_{iT}] = 0\)</span> — os erros são não-correlacionados com os fatores e o tratamento.</li>
<li><strong>Suposição 3 (Decomposição de baixo posto)</strong>: <span class="math inline">\(h(U_{it})\)</span> pode ser decomposta em componentes de baixa dimensionalidade.</li>
</ul>
<p>A Suposição 3 é o que diferencia os três estimadores: no caso mais simples, <span class="math inline">\(h(U_{it}) = \alpha_i + \xi_t\)</span> (efeitos fixos aditivos, como no DiD). No caso mais flexível, <span class="math inline">\(h(U_{it}) = \alpha_i + \xi_t + \lambda&#39;_i f_t\)</span> (fatores interativos).</p>
</div>
<div id="conexão-com-did" class="section level3 hasAnchor" number="10.4.4">
<h3><span class="header-section-number">10.4.4</span> Conexão com DiD<a href="#conex%C3%A3o-com-did" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O DiD é um caso especial deste framework. Quando <span class="math inline">\(h(U_{it}) = \alpha_i + \xi_t\)</span> e usamos os dados de controle para estimar esses efeitos fixos e depois imputamos, obtemos o estimador de DiD por imputação de Borusyak, Jaravel e Spiess (2024), que vimos no capítulo 8. O framework de Liu et al. vai além ao permitir modelos mais flexíveis.</p>
</div>
</div>
<div id="três-estimadores-contrafactuais" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Três estimadores contrafactuais<a href="#tr%C3%AAs-estimadores-contrafactuais" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O framework de Liu et al. (2024) oferece três estimadores, implementados no pacote <code>fect</code> (Fixed Effects Counterfactual Estimators).</p>
<div id="fect-efeitos-fixos" class="section level3 hasAnchor" number="10.5.1">
<h3><span class="header-section-number">10.5.1</span> FEct: efeitos fixos<a href="controle-sintético-e-estimação-contrafactual.html#fect-efeitos-fixos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O modelo mais simples assume:
<span class="math display">\[
Y_{it}(0) = X&#39;_{it}\beta + \alpha_i + \xi_t + \varepsilon_{it}
\]</span></p>
<p>Esse é o modelo TWFE — os mesmos efeitos fixos aditivos do DiD. A diferença em relação ao DiD tradicional é a <em>estratégia de estimação</em>: em vez de regredir <span class="math inline">\(Y\)</span> em <span class="math inline">\(D\)</span> com efeitos fixos (o que pode gerar pesos negativos com tratamento heterogêneo), o FEct estima <span class="math inline">\(\alpha_i\)</span>, <span class="math inline">\(\xi_t\)</span> e <span class="math inline">\(\beta\)</span> usando apenas as observações não-tratadas, e depois imputa o contrafactual para as tratadas.</p>
<p>Isso é equivalente ao estimador de imputação de Borusyak et al. (2024), que discutimos no capítulo 8.</p>
</div>
<div id="ifect-fatores-interativos" class="section level3 hasAnchor" number="10.5.2">
<h3><span class="header-section-number">10.5.2</span> IFEct: fatores interativos<a href="controle-sintético-e-estimação-contrafactual.html#ifect-fatores-interativos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O modelo de fatores interativos adiciona um componente multiplicativo:
<span class="math display">\[
Y_{it}(0) = X&#39;_{it}\beta + \alpha_i + \xi_t + \lambda&#39;_i f_t + \varepsilon_{it}
\]</span></p>
<p>O termo <span class="math inline">\(\lambda&#39;_i f_t\)</span> captura confundidores variantes no tempo de forma heterogênea: <span class="math inline">\(f_t\)</span> é um vetor de <span class="math inline">\(r\)</span> fatores comuns (que variam no tempo), e <span class="math inline">\(\lambda_i\)</span> é o vetor de cargas fatoriais (que variam por unidade). Quando <span class="math inline">\(f_t\)</span> é constante, o componente <span class="math inline">\(\lambda&#39;_i f_t\)</span> é absorvido pelo efeito fixo de unidade <span class="math inline">\(\alpha_i\)</span>, e o modelo reduz ao caso aditivo (FEct); quando <span class="math inline">\(\lambda_i\)</span> é constante, o componente é absorvido pelo efeito fixo de tempo <span class="math inline">\(\xi_t\)</span>.</p>
<p>A vantagem em relação ao FEct é que o IFEct <strong>relaxa a suposição de tendências paralelas</strong>: não exige que todas as unidades sigam a mesma tendência temporal. Basta que as trajetórias sejam explicáveis por um número pequeno de fatores latentes — uma suposição mais fraca e frequentemente mais realista.</p>
<p>O número de fatores <span class="math inline">\(r\)</span> é escolhido por validação cruzada. Na prática, o pacote <code>fect</code> testa <span class="math inline">\(r = 0, 1, 2, \ldots, r_{max}\)</span> e escolhe o valor que minimiza o erro de predição nos dados não-tratados.</p>
</div>
<div id="mc-matrix-completion" class="section level3 hasAnchor" number="10.5.3">
<h3><span class="header-section-number">10.5.3</span> MC: Matrix Completion<a href="controle-sintético-e-estimação-contrafactual.html#mc-matrix-completion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O estimador MC (Athey, Bayati, Doudchenko, Imbens e Khosravi, 2021) trata o problema como <em>completação de matriz</em>. A ideia é que a matriz <span class="math inline">\(\mathbf{Y}(0)\)</span> de resultados potenciais sem tratamento tem estrutura de baixo posto — pode ser bem aproximada por uma matriz de posto <span class="math inline">\(r\)</span> pequeno. O modelo é:
<span class="math display">\[
\mathbf{Y}(0) = \mathbf{X}\beta + \mathbf{L} + \varepsilon
\]</span>
onde <span class="math inline">\(\mathbf{L}\)</span> é uma matriz de baixo posto. Em vez de selecionar <span class="math inline">\(r\)</span> fatores diretamente (como no IFEct), o MC penaliza a norma nuclear <span class="math inline">\(\|\mathbf{L}\|_*\)</span>, que é uma relaxação convexa do posto. Isso faz um “soft impute”: os valores singulares são encolhidos continuamente, em vez de truncados.</p>
<p>A diferença prática entre IFEct e MC é:</p>
<ul>
<li><strong>IFEct</strong> faz “hard impute”: escolhe <span class="math inline">\(r\)</span> fatores e descarta o resto</li>
<li><strong>MC</strong> faz “soft impute”: penaliza a norma nuclear, encolhendo todos os valores singulares</li>
</ul>
<p>Quando a penalização <span class="math inline">\(\lambda_L \to \infty\)</span> (ou <span class="math inline">\(r = 0\)</span>), ambos reduzem ao FEct (efeitos fixos aditivos).</p>
</div>
<div id="demonstração-com-dados-da-califórnia" class="section level3 hasAnchor" number="10.5.4">
<h3><span class="header-section-number">10.5.4</span> Demonstração com dados da Califórnia<a href="#demonstra%C3%A7%C3%A3o-com-dados-da-calif%C3%B3rnia" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Aplicamos os três estimadores aos mesmos dados de cigarros usados no SCM.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-1" tabindex="-1"></a><span class="fu">library</span>(fect)</span>
<span id="cb157-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb157-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-3" tabindex="-1"></a></span>
<span id="cb157-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-4" tabindex="-1"></a><span class="fu">data</span>(smoking, <span class="at">package =</span> <span class="st">&quot;tidysynth&quot;</span>)</span>
<span id="cb157-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-5" tabindex="-1"></a></span>
<span id="cb157-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-6" tabindex="-1"></a><span class="co"># Preparar dados para fect</span></span>
<span id="cb157-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-7" tabindex="-1"></a>df_fect <span class="ot">&lt;-</span> smoking <span class="sc">%&gt;%</span></span>
<span id="cb157-8"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb157-9"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-9" tabindex="-1"></a>    <span class="at">D =</span> <span class="fu">ifelse</span>(state <span class="sc">==</span> <span class="st">&quot;California&quot;</span> <span class="sc">&amp;</span> year <span class="sc">&gt;=</span> <span class="dv">1989</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb157-10"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-10" tabindex="-1"></a>    <span class="at">unit_id =</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(state))</span>
<span id="cb157-11"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-11" tabindex="-1"></a>  )</span>
<span id="cb157-12"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-12" tabindex="-1"></a></span>
<span id="cb157-13"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-13" tabindex="-1"></a><span class="co"># FEct: efeitos fixos (equivalente a DiD por imputação)</span></span>
<span id="cb157-14"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-14" tabindex="-1"></a>out_fe <span class="ot">&lt;-</span> <span class="fu">fect</span>(cigsale <span class="sc">~</span> D, <span class="at">data =</span> df_fect,</span>
<span id="cb157-15"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-15" tabindex="-1"></a>               <span class="at">index =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb157-16"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-16" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;fe&quot;</span>,</span>
<span id="cb157-17"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-17" tabindex="-1"></a>               <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">nboots =</span> <span class="dv">200</span>,</span>
<span id="cb157-18"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-18" tabindex="-1"></a>               <span class="at">parallel =</span> <span class="cn">FALSE</span>)</span>
<span id="cb157-19"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-19" tabindex="-1"></a></span>
<span id="cb157-20"><a href="controle-sintético-e-estimação-contrafactual.html#cb157-20" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;FEct - ATT estimado:&quot;</span>, <span class="fu">round</span>(out_fe<span class="sc">$</span>att.avg, <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## FEct - ATT estimado: -27.35</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-1" tabindex="-1"></a><span class="co"># IFEct: fatores interativos (r escolhido por CV)</span></span>
<span id="cb159-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-2" tabindex="-1"></a>out_ife <span class="ot">&lt;-</span> <span class="fu">fect</span>(cigsale <span class="sc">~</span> D, <span class="at">data =</span> df_fect,</span>
<span id="cb159-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-3" tabindex="-1"></a>                <span class="at">index =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb159-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-4" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;ife&quot;</span>,</span>
<span id="cb159-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-5" tabindex="-1"></a>                <span class="at">r =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),</span>
<span id="cb159-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-6" tabindex="-1"></a>                <span class="at">CV =</span> <span class="cn">TRUE</span>,</span>
<span id="cb159-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-7" tabindex="-1"></a>                <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">nboots =</span> <span class="dv">200</span>,</span>
<span id="cb159-8"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-8" tabindex="-1"></a>                <span class="at">parallel =</span> <span class="cn">FALSE</span>)</span>
<span id="cb159-9"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-9" tabindex="-1"></a></span>
<span id="cb159-10"><a href="controle-sintético-e-estimação-contrafactual.html#cb159-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;IFEct - ATT estimado:&quot;</span>, <span class="fu">round</span>(out_ife<span class="sc">$</span>att.avg, <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## IFEct - ATT estimado: -24.62</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb161-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Número de fatores escolhido:&quot;</span>, out_ife<span class="sc">$</span>r.cv, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Número de fatores escolhido: 3</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb163-1" tabindex="-1"></a><span class="co"># MC: Matrix Completion</span></span>
<span id="cb163-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb163-2" tabindex="-1"></a>out_mc <span class="ot">&lt;-</span> <span class="fu">fect</span>(cigsale <span class="sc">~</span> D, <span class="at">data =</span> df_fect,</span>
<span id="cb163-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb163-3" tabindex="-1"></a>               <span class="at">index =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb163-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb163-4" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;mc&quot;</span>,</span>
<span id="cb163-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb163-5" tabindex="-1"></a>               <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">nboots =</span> <span class="dv">200</span>,</span>
<span id="cb163-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb163-6" tabindex="-1"></a>               <span class="at">parallel =</span> <span class="cn">FALSE</span>)</span>
<span id="cb163-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb163-7" tabindex="-1"></a></span>
<span id="cb163-8"><a href="controle-sintético-e-estimação-contrafactual.html#cb163-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;MC - ATT estimado:&quot;</span>, <span class="fu">round</span>(out_mc<span class="sc">$</span>att.avg, <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## MC - ATT estimado: -25.91</code></pre>
<p>O gráfico de efeitos dinâmicos (<em>dynamic treatment effects</em>) mostra a evolução do efeito estimado ao longo do tempo, incluindo o período pré-tratamento (que deve ser próximo de zero se o modelo estiver bem especificado):</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb165-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb165-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb165-2" tabindex="-1"></a><span class="fu">plot</span>(out_fe, <span class="at">main =</span> <span class="st">&quot;FEct (Efeitos Fixos)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Efeito estimado&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Períodos relativos ao tratamento&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/fect_plot-1.png" alt="" width="960" /></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb166-1" tabindex="-1"></a><span class="fu">plot</span>(out_ife, <span class="at">main =</span> <span class="st">&quot;IFEct (Fatores Interativos)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Efeito estimado&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Períodos relativos ao tratamento&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/fect_plot-2.png" alt="" width="960" /></p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb167-1" tabindex="-1"></a><span class="fu">plot</span>(out_mc, <span class="at">main =</span> <span class="st">&quot;MC (Matrix Completion)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Efeito estimado&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Períodos relativos ao tratamento&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/fect_plot-3.png" alt="" width="960" /></p>
<p>Os três estimadores devem concordar no sinal e magnitude aproximada do efeito (redução nas vendas de cigarros). Divergências no período pré-tratamento indicam diferenças na qualidade do ajuste — que é exatamente o que os diagnósticos formais da próxima seção avaliam.</p>
</div>
</div>
<div id="diagnósticos" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Diagnósticos<a href="#diagn%C3%B3sticos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Uma vantagem do framework de Liu et al. (2024) é oferecer diagnósticos formais para avaliar a qualidade da estimação contrafactual. Esses diagnósticos vão além da inspeção visual e fornecem testes estatísticos.</p>
<div id="efeitos-dinâmicos" class="section level3 hasAnchor" number="10.6.1">
<h3><span class="header-section-number">10.6.1</span> Efeitos dinâmicos<a href="#efeitos-din%C3%A2micos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O gráfico de efeitos dinâmicos (<em>gap plot</em>) mostra <span class="math inline">\(\hat{\delta}_{it}\)</span> para cada período relativo ao tratamento. No período pré-tratamento, esses efeitos devem ser próximos de zero — se não forem, o modelo está falhando em reproduzir os dados pré-tratamento e as estimativas pós-tratamento são suspeitas.</p>
<p>Diferentemente do event study tradicional do DiD (capítulo 8), o gráfico do <code>fect</code> não precisa de uma categoria de referência arbitrária: todos os períodos pré-tratamento são informativos.</p>
</div>
<div id="placebo-test" class="section level3 hasAnchor" number="10.6.2">
<h3><span class="header-section-number">10.6.2</span> Placebo test<a href="controle-sintético-e-estimação-contrafactual.html#placebo-test" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O teste placebo “esconde” parte dos períodos pré-tratamento e finge que o tratamento começou antes. Formalmente, remove os últimos <span class="math inline">\(L\)</span> períodos pré-tratamento de <span class="math inline">\(\mathcal{C}_0\)</span>, reestima o modelo, e calcula <span class="math inline">\(\hat{\delta}_{it}\)</span> para esses períodos “escondidos”. Se o modelo for bem especificado, esses efeitos placebo devem ser zero.</p>
<p>Liu et al. (2024) propõem dois critérios:</p>
<ol style="list-style-type: decimal">
<li><strong>Teste t</strong>: a média dos efeitos placebo é significativamente diferente de zero?</li>
<li><strong>Teste de equivalência (TOST)</strong>: os efeitos placebo estão dentro de um intervalo de equivalência <span class="math inline">\([-\Delta, \Delta]\)</span>?</li>
</ol>
<p>O teste de equivalência é preferível porque um teste t com baixo poder pode falhar em rejeitar (falso conforto), enquanto o TOST requer evidência <em>positiva</em> de que os efeitos são pequenos.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-1" tabindex="-1"></a><span class="co"># Placebo test com IFEct (r fixo, sem CV)</span></span>
<span id="cb168-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-2" tabindex="-1"></a>out_ife_placebo <span class="ot">&lt;-</span> <span class="fu">fect</span>(cigsale <span class="sc">~</span> D, <span class="at">data =</span> df_fect,</span>
<span id="cb168-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-3" tabindex="-1"></a>                        <span class="at">index =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb168-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-4" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">&quot;ife&quot;</span>,</span>
<span id="cb168-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-5" tabindex="-1"></a>                        <span class="at">r =</span> <span class="dv">2</span>,</span>
<span id="cb168-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-6" tabindex="-1"></a>                        <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">nboots =</span> <span class="dv">200</span>,</span>
<span id="cb168-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-7" tabindex="-1"></a>                        <span class="at">parallel =</span> <span class="cn">FALSE</span>,</span>
<span id="cb168-8"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-8" tabindex="-1"></a>                        <span class="at">placeboTest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb168-9"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-9" tabindex="-1"></a>                        <span class="at">placebo.period =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb168-10"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-10" tabindex="-1"></a></span>
<span id="cb168-11"><a href="controle-sintético-e-estimação-contrafactual.html#cb168-11" tabindex="-1"></a><span class="fu">plot</span>(out_ife_placebo, <span class="at">type =</span> <span class="st">&quot;equiv&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Teste de Equivalência (IFEct)&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/fect_placebo-1.png" alt="" width="768" /></p>
</div>
<div id="teste-de-no-carryover" class="section level3 hasAnchor" number="10.6.3">
<h3><span class="header-section-number">10.6.3</span> Teste de no-carryover<a href="controle-sintético-e-estimação-contrafactual.html#teste-de-no-carryover" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Em alguns contextos, o tratamento pode ter efeitos residuais: mesmo após o tratamento ser “desligado”, a unidade ainda é afetada. O teste de carryover esconde períodos imediatamente após o tratamento ser removido (se aplicável) e verifica se existem efeitos residuais. Em contextos como o nosso (tratamento absorvente), esse teste não se aplica diretamente, mas é relevante para designs em que o tratamento liga e desliga.</p>
</div>
</div>
<div id="synthetic-did" class="section level2 hasAnchor" number="10.7">
<h2><span class="header-section-number">10.7</span> Synthetic DiD<a href="controle-sintético-e-estimação-contrafactual.html#synthetic-did" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O Controle Sintético clássico e o framework de estimação contrafactual resolvem o problema de imputação de formas diferentes. Uma terceira abordagem, proposta por Arkhangelsky, Athey, Hirshberg, Imbens e Wager (2021), combina as ideias do SCM e do DiD em um único estimador: o <strong>Synthetic DiD</strong> (SDiD).</p>
<p>Para entender o SDiD, é útil ver os três estimadores — SC, DiD e SDiD — lado a lado.</p>
<p>O <strong>Controle Sintético</strong> pode ser reescrito como um problema de mínimos quadrados ponderados:
<span class="math display">\[
(\hat{\mu}, \hat{\gamma}, \hat{\tau}^{SC}) = \arg\min_{\mu, \gamma, \tau}\ \sum_i \sum_t (y_{it} - \mu - \gamma_t - D_{it}\tau)^2 \hat{w}_i
\]</span>
Note que não há efeitos fixos de unidade (<span class="math inline">\(\alpha_i\)</span>) — os pesos <span class="math inline">\(\hat{w}_i\)</span> “fazem o trabalho” de tornar os controles comparáveis.</p>
<p>O <strong>DiD</strong> (via TWFE) inclui efeitos fixos mas dá peso igual a todas as unidades:
<span class="math display">\[
(\hat{\mu}, \hat{\alpha}, \hat{\gamma}, \hat{\tau}^{DiD}) = \arg\min_{\mu, \alpha, \gamma, \tau}\ \sum_i \sum_t (y_{it} - \mu - \alpha_i - \gamma_t - D_{it}\tau)^2
\]</span></p>
<p>O <strong>SDiD</strong> combina ambos — efeitos fixos <em>e</em> pesos, tanto para unidades quanto para períodos:
<span class="math display">\[
(\hat{\mu}, \hat{\alpha}, \hat{\gamma}, \hat{\tau}^{SDiD}) = \arg\min_{\mu, \alpha, \gamma, \tau}\ \sum_i \sum_t (y_{it} - \mu - \alpha_i - \gamma_t - D_{it}\tau)^2 \hat{w}_i \hat{\lambda}_t
\]</span></p>
<p>Os pesos de unidade <span class="math inline">\(\hat{w}_i\)</span> balanceiam as tendências pré-tratamento: dão mais peso a unidades de controle cuja trajetória é similar à dos tratados. Os pesos temporais <span class="math inline">\(\hat{\lambda}_t\)</span> balanceiam os períodos: dão mais peso a períodos pré-tratamento cuja estrutura de cross-section é similar ao período pós. Em outras palavras, os pesos reponderam as observações de modo a reduzir o viés sob um modelo de fatores latentes, mesmo quando tendências paralelas globais não são válidas. Arkhangelsky et al. (2021) demonstram a consistência do SDiD sob um modelo de fatores quando as estimativas de pesos convergem adequadamente.</p>
<p>A vantagem do SDiD sobre o DiD é que não exige tendências paralelas globais. A vantagem sobre o SCM é que inclui efeitos fixos de unidade, o que permite lidar com diferenças de nível.</p>
<div id="implementação-no-r" class="section level3 hasAnchor" number="10.7.1">
<h3><span class="header-section-number">10.7.1</span> Implementação no R<a href="#implementa%C3%A7%C3%A3o-no-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Vamos aplicar DiD, SC e SDiD aos dados da Califórnia.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb169-1" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb169-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb169-2" tabindex="-1"></a></span>
<span id="cb169-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb169-3" tabindex="-1"></a>smoking_did <span class="ot">&lt;-</span> smoking <span class="sc">%&gt;%</span></span>
<span id="cb169-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb169-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">ifelse</span>(state <span class="sc">==</span> <span class="st">&quot;California&quot;</span> <span class="sc">&amp;</span> year <span class="sc">&gt;</span> <span class="dv">1988</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb169-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb169-5" tabindex="-1"></a>did <span class="ot">&lt;-</span> <span class="fu">feols</span>(cigsale <span class="sc">~</span> treatment <span class="sc">|</span> state <span class="sc">+</span> year, <span class="at">data =</span> smoking_did)</span>
<span id="cb169-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb169-6" tabindex="-1"></a></span>
<span id="cb169-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb169-7" tabindex="-1"></a><span class="fu">summary</span>(did)</span></code></pre></div>
<pre><code>## OLS estimation, Dep. Var.: cigsale
## Observations: 1,209
## Fixed-effects: state: 39,  year: 31
## Standard-errors: Clustered (state) 
##           Estimate Std. Error  t value   Pr(&gt;|t|)    
## treatment -27.3491    2.80238 -9.75925 6.6913e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## RMSE: 11.5     Adj. R2: 0.870229
##              Within R2: 0.032671</code></pre>
<p>O estimador de DiD assume tendências paralelas na média — suposição que pode não ser crível neste contexto, como mostra o event study:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-1" tabindex="-1"></a><span class="fu">library</span>(did2s)</span>
<span id="cb171-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-2" tabindex="-1"></a><span class="fu">library</span>(ggfixest)</span>
<span id="cb171-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-3" tabindex="-1"></a></span>
<span id="cb171-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-4" tabindex="-1"></a>df <span class="ot">&lt;-</span> smoking_did <span class="sc">%&gt;%</span></span>
<span id="cb171-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">event_time =</span> year <span class="sc">-</span> <span class="dv">1988</span>,</span>
<span id="cb171-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-6" tabindex="-1"></a>         <span class="at">id =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(state))) <span class="sc">%&gt;%</span></span>
<span id="cb171-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-7" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb171-8"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">g =</span> <span class="fu">ifelse</span>(state <span class="sc">==</span> <span class="st">&quot;California&quot;</span>, <span class="dv">1988</span>, <span class="dv">0</span>),</span>
<span id="cb171-9"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-9" tabindex="-1"></a>         <span class="at">cohort =</span> <span class="fu">ifelse</span>(state <span class="sc">==</span> <span class="st">&quot;California&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb171-10"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-10" tabindex="-1"></a>         <span class="at">g1 =</span> <span class="fu">ifelse</span>(state <span class="sc">==</span> <span class="st">&quot;California&quot;</span> <span class="sc">&amp;</span> year <span class="sc">&gt;=</span> <span class="dv">1980</span>, <span class="dv">1980</span>, <span class="dv">0</span>))</span>
<span id="cb171-11"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-11" tabindex="-1"></a></span>
<span id="cb171-12"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-12" tabindex="-1"></a>out_es <span class="ot">&lt;-</span> <span class="fu">event_study</span>(</span>
<span id="cb171-13"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-13" tabindex="-1"></a>  <span class="at">data =</span> df,</span>
<span id="cb171-14"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-14" tabindex="-1"></a>  <span class="at">idname =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb171-15"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-15" tabindex="-1"></a>  <span class="at">tname =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb171-16"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-16" tabindex="-1"></a>  <span class="at">gname =</span> <span class="st">&quot;g&quot;</span>,</span>
<span id="cb171-17"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-17" tabindex="-1"></a>  <span class="at">yname =</span> <span class="st">&quot;cigsale&quot;</span>,</span>
<span id="cb171-18"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-18" tabindex="-1"></a>  <span class="at">estimator =</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb171-19"><a href="controle-sintético-e-estimação-contrafactual.html#cb171-19" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Error in create_Atheta_list_for_event_study(eventTime = eventTime, g_list = g_list,  : 
##   There are no comparison cohorts for the given eventTime</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb173-1" tabindex="-1"></a><span class="fu">plot_event_study</span>(out_es)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/did1-1.png" alt="" width="672" /></p>
<p>Agora comparamos os três estimadores com o pacote <code>synthdid</code>:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-1" tabindex="-1"></a><span class="fu">library</span>(synthdid)</span>
<span id="cb174-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-2" tabindex="-1"></a></span>
<span id="cb174-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-3" tabindex="-1"></a>estimators <span class="ot">=</span> <span class="fu">list</span>(<span class="at">did=</span>did_estimate,</span>
<span id="cb174-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-4" tabindex="-1"></a>                  <span class="at">sc=</span>sc_estimate,</span>
<span id="cb174-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-5" tabindex="-1"></a>                  <span class="at">sdid=</span>synthdid_estimate)</span>
<span id="cb174-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-6" tabindex="-1"></a></span>
<span id="cb174-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-7" tabindex="-1"></a>df_sdid <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb174-8"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(state, year, cigsale, treatment) <span class="sc">%&gt;%</span></span>
<span id="cb174-9"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">as.integer</span>(treatment),</span>
<span id="cb174-10"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-10" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">as.integer</span>(year),</span>
<span id="cb174-11"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-11" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">as.factor</span>(state)) <span class="sc">%&gt;%</span></span>
<span id="cb174-12"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-12" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb174-13"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-13" tabindex="-1"></a></span>
<span id="cb174-14"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-14" tabindex="-1"></a>setup <span class="ot">&lt;-</span> <span class="fu">panel.matrices</span>(df_sdid)</span>
<span id="cb174-15"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-15" tabindex="-1"></a></span>
<span id="cb174-16"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-16" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">lapply</span>(estimators, <span class="cf">function</span>(estimator) { <span class="fu">estimator</span>(setup<span class="sc">$</span>Y,</span>
<span id="cb174-17"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-17" tabindex="-1"></a>                                                               setup<span class="sc">$</span>N0, setup<span class="sc">$</span>T0) } )</span>
<span id="cb174-18"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-18" tabindex="-1"></a></span>
<span id="cb174-19"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-19" tabindex="-1"></a>standard.errors <span class="ot">=</span> <span class="fu">mapply</span>(<span class="cf">function</span>(estimate, name) {</span>
<span id="cb174-20"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-20" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb174-21"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-21" tabindex="-1"></a>  <span class="cf">if</span>(name <span class="sc">==</span> <span class="st">&#39;mc&#39;</span>) { <span class="fu">mc_placebo_se</span>(setup<span class="sc">$</span>Y, setup<span class="sc">$</span>N0, setup<span class="sc">$</span>T0) }</span>
<span id="cb174-22"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-22" tabindex="-1"></a>  <span class="cf">else</span> {             <span class="fu">sqrt</span>(<span class="fu">vcov</span>(estimate, <span class="at">method=</span><span class="st">&#39;placebo&#39;</span>))     }</span>
<span id="cb174-23"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-23" tabindex="-1"></a>}, estimates, <span class="fu">names</span>(estimators))</span>
<span id="cb174-24"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-24" tabindex="-1"></a></span>
<span id="cb174-25"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-25" tabindex="-1"></a><span class="co"># Resultados</span></span>
<span id="cb174-26"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-26" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb174-27"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-27" tabindex="-1"></a>  <span class="at">Estimador =</span> <span class="fu">c</span>(<span class="st">&quot;DiD&quot;</span>, <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;SDiD&quot;</span>),</span>
<span id="cb174-28"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-28" tabindex="-1"></a>  <span class="at">ATT =</span> <span class="fu">round</span>(<span class="fu">sapply</span>(estimates, <span class="cf">function</span>(x) x[<span class="dv">1</span>]), <span class="dv">2</span>),</span>
<span id="cb174-29"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-29" tabindex="-1"></a>  <span class="at">SE =</span> <span class="fu">round</span>(standard.errors, <span class="dv">2</span>)</span>
<span id="cb174-30"><a href="controle-sintético-e-estimação-contrafactual.html#cb174-30" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Estimador</th>
<th align="right">ATT</th>
<th align="right">SE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">did</td>
<td align="left">DiD</td>
<td align="right">-27.35</td>
<td align="right">17.74</td>
</tr>
<tr class="even">
<td align="left">sc</td>
<td align="left">SC</td>
<td align="right">-19.62</td>
<td align="right">9.92</td>
</tr>
<tr class="odd">
<td align="left">sdid</td>
<td align="left">SDiD</td>
<td align="right">-15.60</td>
<td align="right">8.37</td>
</tr>
</tbody>
</table>
<p>O gráfico a seguir compara visualmente as trajetórias estimadas:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-1" tabindex="-1"></a><span class="fu">synthdid_plot</span>(estimates[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">facet.vertical=</span><span class="cn">FALSE</span>,</span>
<span id="cb175-2"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-2" tabindex="-1"></a>              <span class="at">control.name=</span><span class="st">&#39;control&#39;</span>, <span class="at">treated.name=</span><span class="st">&#39;california&#39;</span>,</span>
<span id="cb175-3"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-3" tabindex="-1"></a>              <span class="at">lambda.comparable=</span><span class="cn">TRUE</span>, <span class="at">se.method =</span> <span class="st">&#39;none&#39;</span>,</span>
<span id="cb175-4"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-4" tabindex="-1"></a>              <span class="at">trajectory.linetype =</span> <span class="dv">1</span>, <span class="at">line.width=</span>.<span class="dv">75</span>, <span class="at">effect.curvature=</span><span class="sc">-</span>.<span class="dv">4</span>,</span>
<span id="cb175-5"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-5" tabindex="-1"></a>              <span class="at">trajectory.alpha=</span>.<span class="dv">7</span>, <span class="at">effect.alpha=</span>.<span class="dv">7</span>,</span>
<span id="cb175-6"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-6" tabindex="-1"></a>              <span class="at">diagram.alpha=</span><span class="dv">1</span>, <span class="at">onset.alpha=</span>.<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb175-7"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(.<span class="dv">26</span>,.<span class="dv">07</span>), <span class="at">legend.direction=</span><span class="st">&#39;horizontal&#39;</span>,</span>
<span id="cb175-8"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-8" tabindex="-1"></a>        <span class="at">legend.key=</span><span class="fu">element_blank</span>(), <span class="at">legend.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb175-9"><a href="controle-sintético-e-estimação-contrafactual.html#cb175-9" tabindex="-1"></a>        <span class="at">strip.background=</span><span class="fu">element_blank</span>(), <span class="at">strip.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/sdid1-1.png" width="672" /></p>
<p>E os pesos de unidade atribuídos por cada estimador:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="controle-sintético-e-estimação-contrafactual.html#cb176-1" tabindex="-1"></a><span class="fu">synthdid_units_plot</span>(<span class="fu">rev</span>(estimates[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]), <span class="at">se.method=</span><span class="st">&#39;none&#39;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/sdid2-1.png" alt="" width="672" /></p>
<p>Note que o DiD atribui peso igual a todos os estados de controle, o SC concentra peso em poucos estados similares à Califórnia, e o SDiD faz algo intermediário.</p>
</div>
</div>
<div id="trop-estimador-triplamente-robusto" class="section level2 hasAnchor" number="10.8">
<h2><span class="header-section-number">10.8</span> TROP: estimador triplamente robusto<a href="controle-sintético-e-estimação-contrafactual.html#trop-estimador-triplamente-robusto" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Athey, Imbens, Qu e Viviano (2025) propõem o <strong>TROP</strong> (<em>Triply Robust Panel Estimator</em>), que combina três componentes:</p>
<ol style="list-style-type: decimal">
<li>Um <strong>modelo de fatores</strong> (outcome model): <span class="math inline">\(Y_{it}(0) = \mu_i + \lambda&#39;_i f_t + \varepsilon_{it}\)</span></li>
<li><strong>Pesos de unidade</strong> <span class="math inline">\(w_i\)</span> (análogo ao SCM)</li>
<li><strong>Pesos temporais</strong> <span class="math inline">\(\omega_t\)</span> (análogo ao SDiD)</li>
</ol>
<p>A propriedade central do TROP é a <strong>tripla robustez</strong>. Para entender essa propriedade, considere que o viés do estimador tem uma estrutura <em>multiplicativa</em>: é proporcional ao produto de três termos de erro de especificação:
<span class="math display">\[
\text{viés} \propto e_{\text{modelo}} \times e_{\text{pesos de unidade}} \times e_{\text{pesos temporais}}
\]</span></p>
<p>onde <span class="math inline">\(e_{\text{modelo}}\)</span> é o erro do modelo de fatores, <span class="math inline">\(e_{\text{pesos de unidade}}\)</span> é o erro dos pesos de unidade, e <span class="math inline">\(e_{\text{pesos temporais}}\)</span> é o erro dos pesos temporais. Como o viés é um <em>produto</em> desses três termos, basta que <em>qualquer um</em> deles seja zero para que o viés total desapareça. Em outras palavras, o estimador é consistente se qualquer um dos três componentes estiver corretamente especificado — não é necessário que todos estejam corretos simultaneamente.</p>
<p>Isso contrasta com o SDiD, que usa efeitos fixos aditivos + pesos, enquanto o TROP usa um modelo de fatores + pesos. Contudo, é importante notar que quando <em>todos os três</em> componentes estão mal especificados, o viés pode ser arbitrário — a tripla robustez não protege contra falha simultânea de todos os componentes.</p>
<p>Em simulações, Athey et al. (2025) mostram que o TROP supera substancialmente o TWFE e compete com o SDiD e o MC em uma variedade de cenários. A recomendação dos autores é usar simulações calibradas aos dados para escolher entre estimadores — não há estimador que domine em todos os cenários.</p>
<p><strong>Nota</strong>: o artigo de Athey et al. (2025) é um <em>preprint</em> que ainda não passou por revisão por pares. Até 2026, não existe pacote R público para o TROP. A menção aqui é teórica e serve para situar o leitor na fronteira da literatura.</p>
</div>
<div id="quando-usar-cada-método-guia-prático" class="section level2 hasAnchor" number="10.9">
<h2><span class="header-section-number">10.9</span> Quando usar cada método: guia prático<a href="#quando-usar-cada-m%C3%A9todo-guia-pr%C3%A1tico" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A escolha entre os métodos depende do contexto empírico. Eis um guia baseado nas recomendações de Liu et al. (2024, p. 175):</p>
<p><strong>Árvore de decisão:</strong></p>
<ol style="list-style-type: decimal">
<li><strong>Uma única unidade tratada</strong> → SCM (seção 2) ou SCM aumentado (Ben-Michael et al., 2021)</li>
<li><strong>Múltiplas unidades, tendências paralelas plausíveis</strong> → DiD/FEct (capítulo 8 e seção 5.1)</li>
<li><strong>Múltiplas unidades, tendências paralelas duvidosas</strong> → IFEct ou MC (seção 5.2–5.3)</li>
<li><strong>Poucas unidades de controle</strong> → SDiD (seção 7) — os pesos ajudam a criar comparabilidade</li>
</ol>
<p><strong>Checklist prático</strong> (adaptado de Liu et al., 2024):</p>
<ol style="list-style-type: decimal">
<li>Visualize o <em>treatment status</em>: quando cada unidade entra no tratamento?</li>
<li>Visualize a variável resposta: há tendências não-paralelas visíveis?</li>
<li>Comece com FEct + diagnósticos (placebo test, equivalência)</li>
<li>Se os diagnósticos falharem → tente IFEct ou MC + diagnósticos</li>
<li>Se houver carryover → remova os períodos afetados e reestime</li>
<li>Compare as estimativas entre métodos: se concordarem, há robustez; se divergirem, investigue por quê</li>
</ol>
<p>A tabela abaixo resume as suposições e características de cada método:</p>
<table>
<colgroup>
<col width="10%" />
<col width="27%" />
<col width="39%" />
<col width="9%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th>Método</th>
<th>Modelo para <span class="math inline">\(Y(0)\)</span></th>
<th>Relaxa tendências paralelas?</th>
<th>Pesos</th>
<th>Pacote R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DiD/TWFE</td>
<td><span class="math inline">\(\alpha_i + \lambda_t\)</span></td>
<td>Não</td>
<td>Iguais</td>
<td><code>fixest</code></td>
</tr>
<tr class="even">
<td>FEct</td>
<td><span class="math inline">\(X&#39;\beta + \alpha_i + \xi_t\)</span></td>
<td>Não (mesma suposição)</td>
<td>Uniformes</td>
<td><code>fect</code></td>
</tr>
<tr class="odd">
<td>IFEct</td>
<td><span class="math inline">\(X&#39;\beta + \alpha_i + \xi_t + \lambda&#39;_i f_t\)</span></td>
<td>Sim (fatores)</td>
<td>Uniformes</td>
<td><code>fect</code></td>
</tr>
<tr class="even">
<td>MC</td>
<td>Baixo posto (norma nuclear)</td>
<td>Sim (baixo posto)</td>
<td>Implícitos (norma nuclear)</td>
<td><code>fect</code></td>
</tr>
<tr class="odd">
<td>SCM</td>
<td>Combinação convexa</td>
<td>Indiretamente (via pesos)</td>
<td>Convexos</td>
<td><code>tidysynth</code></td>
</tr>
<tr class="even">
<td>SDiD</td>
<td><span class="math inline">\(\alpha_i + \lambda_t\)</span> + pesos</td>
<td>Sim (localmente)</td>
<td>Unid. + tempo</td>
<td><code>synthdid</code></td>
</tr>
<tr class="odd">
<td>TROP</td>
<td>Fatores + pesos</td>
<td>Sim (tripla robustez)</td>
<td>Unid. + tempo</td>
<td>—</td>
</tr>
</tbody>
</table>
<p>A relação entre esses métodos envolve duas dimensões distintas. A primeira é a <strong>flexibilidade do modelo</strong>: DiD/FEct assumem efeitos aditivos, enquanto IFEct e MC permitem estrutura de fatores (baixo posto), relaxando tendências paralelas. A segunda é a <strong>robustez à má especificação</strong>: o SDiD usa o mesmo modelo aditivo do FEct, mas adiciona pesos de unidade e temporais que o tornam mais robusto quando tendências paralelas globais falham — é mais robusto, não necessariamente mais flexível. Da mesma forma, o TROP não relaxa suposições além do modelo de fatores; sua contribuição é a tripla robustez via estrutura multiplicativa do viés, que o protege contra erros em qualquer um dos três componentes. MC e IFEct operam sob suposições de baixo posto similares, mas diferem computacionalmente (<em>soft</em> vs. <em>hard impute</em>). Em todos os casos, métodos com menos suposições ou mais robustez tendem a pagar um custo em variância: a escolha envolve o trade-off viés-variância usual.</p>
</div>
<div id="resumo-2" class="section level2 hasAnchor" number="10.10">
<h2><span class="header-section-number">10.10</span> Resumo<a href="controle-sintético-e-estimação-contrafactual.html#resumo-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Neste capítulo, apresentamos uma família de métodos para estimação de efeitos causais em dados de painel, unificados pela ideia de <strong>imputação do contrafactual</strong> <span class="math inline">\(Y_{it}(0)\)</span>:</p>
<ul>
<li>O <strong>SCM</strong> constrói o contrafactual como combinação convexa de unidades não-tratadas — ideal para estudos de caso com uma unidade tratada.</li>
<li>O <strong>framework de estimação contrafactual</strong> (Liu et al., 2024) generaliza a imputação para três estimadores (FEct, IFEct, MC) com diagnósticos formais.</li>
<li>O <strong>SDiD</strong> combina pesos de unidade e temporais com efeitos fixos, criando tendências paralelas localmente.</li>
<li>O <strong>TROP</strong> (Athey et al., 2025) oferece tripla robustez combinando modelo de fatores com pesos de unidade e pesos temporais.</li>
</ul>
<p>A conexão com o capítulo 8 (DiD) é direta: o FEct é equivalente ao DiD por imputação de Borusyak et al. (2024), e o DiD tradicional é um caso especial do framework quando <span class="math inline">\(h(U_{it}) = \alpha_i + \xi_t\)</span>. A conexão com o capítulo 9 (TSCS) também é clara: o IFEct estende os modelos de fatores interativos de Xu (2017) e Gobillon e Magnac (2016) para o contexto de inferência causal.</p>
<p>No próximo capítulo, veremos como Large Language Models (LLMs) podem ser usados como ferramentas para pesquisa em ciências sociais.</p>
</div>
<div id="referências-8" class="section level2 hasAnchor" number="10.11">
<h2><span class="header-section-number">10.11</span> Referências<a href="#refer%C3%AAncias-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Abadie, A. (2021). Using synthetic controls: Feasibility, data requirements, and methodological aspects. <em>Journal of Economic Literature</em>, 59(2), 391–425.</p>
<p>Abadie, A., &amp; Gardeazabal, J. (2003). The economic costs of conflict: A case study of the Basque Country. <em>American Economic Review</em>, 93(1), 113–132.</p>
<p>Abadie, A., Diamond, A., &amp; Hainmueller, J. (2010). Synthetic control methods for comparative case studies: Estimating the effect of California’s tobacco control program. <em>Journal of the American Statistical Association</em>, 105(490), 493–505.</p>
<p>Abadie, A., Diamond, A., &amp; Hainmueller, J. (2015). Comparative politics and the synthetic control method. <em>American Journal of Political Science</em>, 59(2), 495–510.</p>
<p>Arkhangelsky, D., Athey, S., Hirshberg, D. A., Imbens, G. W., &amp; Wager, S. (2021). Synthetic difference-in-differences. <em>American Economic Review</em>, 111(12), 4088–4118.</p>
<p>Arkhangelsky, D., &amp; Imbens, G. (2024). Causal models for longitudinal and panel data: A survey. <em>The Econometrics Journal</em>, 27(3), C1–C61.</p>
<p>Athey, S., Bayati, M., Doudchenko, N., Imbens, G., &amp; Khosravi, K. (2021). Matrix completion methods for causal panel data models. <em>Journal of the American Statistical Association</em>, 116(536), 1716–1730.</p>
<p>Athey, S., Imbens, G., Qu, Z., &amp; Viviano, D. (2025). Triply robust estimation of causal effects with missing data in panel studies. Preprint.</p>
<p>Ben-Michael, E., Feller, A., &amp; Rothstein, J. (2021). The augmented synthetic control method. <em>Journal of the American Statistical Association</em>, 116(536), 1789–1803.</p>
<p>Borusyak, K., Jaravel, X., &amp; Spiess, J. (2024). Revisiting event-study designs: Robust and efficient estimation. <em>Review of Economic Studies</em>, 91(6), 3253–3285.</p>
<p>Chernozhukov, V., Wüthrich, K., &amp; Zhu, Y. (2021). An exact and robust conformal inference method for counterfactual and synthetic controls. <em>Journal of the American Statistical Association</em>, 116(536), 1849–1864.</p>
<p>Doudchenko, N., &amp; Imbens, G. W. (2016). Balancing, regression, difference-in-differences and synthetic control methods: A synthesis. Working Paper 22791, National Bureau of Economic Research.</p>
<p>Gobillon, L., &amp; Magnac, T. (2016). Regional policy evaluation: Interactive fixed effects and synthetic controls. <em>Review of Economics and Statistics</em>, 98(3), 535–551.</p>
<p>Kaul, A., Klößner, S., Pfeifer, G., &amp; Schieler, M. (2022). Standard synthetic control methods: The case of using all preintervention outcomes together with covariates. <em>Journal of Business &amp; Economic Statistics</em>, 40(3), 1362–1376.</p>
<p>Liu, L., Wang, Y., &amp; Xu, Y. (2024). A practical guide to counterfactual estimators for causal inference with time-series cross-sectional data. <em>American Journal of Political Science</em>, 68(1), 160–176.</p>
<p>Xu, Y. (2017). Generalized synthetic control method: Causal inference with interactive fixed effects models. <em>Political Analysis</em>, 25(1), 57–76.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="time-series-cross-section-tscs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="llms-e-outras.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/mgaldino/Causalidade/edit/main/11-Synth.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/mgaldino/Causalidade/blob/main/11-Synth.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
