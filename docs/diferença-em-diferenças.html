<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 8 Diferença em Diferenças | Curso de Inferência Causal</title>
  <meta name="description" content="Capítulo 8 Diferença em Diferenças | Curso de Inferência Causal" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 8 Diferença em Diferenças | Curso de Inferência Causal" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 8 Diferença em Diferenças | Curso de Inferência Causal" />
  
  
  

<meta name="author" content="Manoel Galdino" />


<meta name="date" content="2026-02-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="desenho-de-regressão-descontínua.html"/>
<link rel="next" href="time-series-cross-section-tscs.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Causalidade</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="08-DiD.html"><a href="#introdu%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>1</b> Introdução</a>
<ul>
<li class="chapter" data-level="1.1" data-path="08-DiD.html"><a href="#revis%C3%A3o-de-regress%C3%A3o"><i class="fa fa-check"></i><b>1.1</b> Revisão de Regressão</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="08-DiD.html"><a href="#teorema-da-anatomia-da-regress%C3%A3o"><i class="fa fa-check"></i><b>1.1.1</b> Teorema da Anatomia da Regressão</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="08-DiD.html"><a href="#infer%C3%AAncia"><i class="fa fa-check"></i><b>1.2</b> Inferência</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="08-DiD.html"><a href="#generaliza%C3%A7%C3%A3o-amostral-vs.-generaliza%C3%A7%C3%A3o-causal"><i class="fa fa-check"></i><b>1.2.1</b> Generalização amostral vs. generalização causal</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1.2.2</b> Incerteza com o universo dos casos</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#validade-externa"><i class="fa fa-check"></i><b>1.2.3</b> Validade externa</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="08-DiD.html"><a href="#resumo-e-pr%C3%B3ximos-passos"><i class="fa fa-check"></i><b>1.3</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="1.4" data-path="08-DiD.html"><a href="#refer%C3%AAncias"><i class="fa fa-check"></i><b>1.4</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html"><i class="fa fa-check"></i><b>2</b> Resultados Potenciais</a>
<ul>
<li class="chapter" data-level="2.1" data-path="08-DiD.html"><a href="#da-intui%C3%A7%C3%A3o-comparativa-ao-modelo-formal"><i class="fa fa-check"></i><b>2.1</b> Da intuição comparativa ao modelo formal</a></li>
<li class="chapter" data-level="2.2" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#resultados-potenciais-potential-outcomes"><i class="fa fa-check"></i><b>2.2</b> Resultados Potenciais (<em>Potential Outcomes</em>)</a></li>
<li class="chapter" data-level="2.3" data-path="08-DiD.html"><a href="#nota%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>2.3</b> Notação</a></li>
<li class="chapter" data-level="2.4" data-path="08-DiD.html"><a href="#problema-fundamental-da-infer%C3%AAncia-causal"><i class="fa fa-check"></i><b>2.4</b> Problema Fundamental da Inferência Causal</a></li>
<li class="chapter" data-level="2.5" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#estimando"><i class="fa fa-check"></i><b>2.5</b> Estimando</a></li>
<li class="chapter" data-level="2.6" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#estimandos-mais-comuns"><i class="fa fa-check"></i><b>2.6</b> Estimandos Mais Comuns</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#ate"><i class="fa fa-check"></i><b>2.6.1</b> ATE</a></li>
<li class="chapter" data-level="2.6.2" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#att"><i class="fa fa-check"></i><b>2.6.2</b> ATT</a></li>
<li class="chapter" data-level="2.6.3" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#cate"><i class="fa fa-check"></i><b>2.6.3</b> CATE</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#nota-sobre-estimandos"><i class="fa fa-check"></i><b>2.7</b> Nota sobre estimandos</a></li>
<li class="chapter" data-level="2.8" data-path="08-DiD.html"><a href="#exerc%C3%ADcio---qual-o-estimando-e-o-estimador-se-poss%C3%ADvel"><i class="fa fa-check"></i><b>2.8</b> Exercício - Qual o estimando e o estimador (se possível)?</a></li>
<li class="chapter" data-level="2.9" data-path="08-DiD.html"><a href="#identifica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>2.9</b> Identificação</a></li>
<li class="chapter" data-level="2.10" data-path="08-DiD.html"><a href="#identifica%C3%A7%C3%A3o-do-ate"><i class="fa fa-check"></i><b>2.10</b> Identificação do ATE</a></li>
<li class="chapter" data-level="2.11" data-path="08-DiD.html"><a href="#equa%C3%A7%C3%B5es-estruturais"><i class="fa fa-check"></i><b>2.11</b> Equações estruturais</a></li>
<li class="chapter" data-level="2.12" data-path="resultados-potenciais.html"><a href="resultados-potenciais.html#modelo-versus-desenho"><i class="fa fa-check"></i><b>2.12</b> Modelo versus Desenho</a></li>
<li class="chapter" data-level="2.13" data-path="08-DiD.html"><a href="#exerc%C3%ADcio-em-sala"><i class="fa fa-check"></i><b>2.13</b> Exercício em sala</a></li>
<li class="chapter" data-level="2.14" data-path="08-DiD.html"><a href="#resumo-e-pr%C3%B3ximos-passos-1"><i class="fa fa-check"></i><b>2.14</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="2.15" data-path="08-DiD.html"><a href="#refer%C3%AAncias-1"><i class="fa fa-check"></i><b>2.15</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dags.html"><a href="dags.html"><i class="fa fa-check"></i><b>3</b> DAGs</a>
<ul>
<li class="chapter" data-level="3.1" data-path="dags.html"><a href="dags.html#causalidade"><i class="fa fa-check"></i><b>3.1</b> Causalidade</a></li>
<li class="chapter" data-level="3.2" data-path="08-DiD.html"><a href="#introdu%C3%A7%C3%A3o-1"><i class="fa fa-check"></i><b>3.2</b> Introdução</a></li>
<li class="chapter" data-level="3.3" data-path="08-DiD.html"><a href="#os-tipos-b%C3%A1sicos-de-dags"><i class="fa fa-check"></i><b>3.3</b> Os Tipos Básicos de DAGs</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="dags.html"><a href="dags.html#chains"><i class="fa fa-check"></i><b>3.3.1</b> 1. Chains</a></li>
<li class="chapter" data-level="3.3.2" data-path="dags.html"><a href="dags.html#forks"><i class="fa fa-check"></i><b>3.3.2</b> 2. Forks</a></li>
<li class="chapter" data-level="3.3.3" data-path="dags.html"><a href="dags.html#colliders"><i class="fa fa-check"></i><b>3.3.3</b> 3. Colliders</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="08-DiD.html"><a href="#simula%C3%A7%C3%A3o-no-r-ilustrando-o-collider-bias"><i class="fa fa-check"></i><b>3.4</b> Simulação no R: Ilustrando o Collider Bias</a></li>
<li class="chapter" data-level="3.5" data-path="08-DiD.html"><a href="#defini%C3%A7%C3%B5es"><i class="fa fa-check"></i><b>3.5</b> Definições</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="08-DiD.html"><a href="#rela%C3%A7%C3%B5es-entre-vari%C3%A1veis-n%C3%B3s"><i class="fa fa-check"></i><b>3.5.1</b> Relações entre Variáveis (nós):</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="dags.html"><a href="dags.html#controle-e-ajuste"><i class="fa fa-check"></i><b>3.6</b> Controle e Ajuste</a></li>
<li class="chapter" data-level="3.7" data-path="08-DiD.html"><a href="#fatoriza%C3%A7%C3%A3o-da-probabilidade-conjunta"><i class="fa fa-check"></i><b>3.7</b> Fatorização da Probabilidade Conjunta</a></li>
<li class="chapter" data-level="3.8" data-path="08-DiD.html"><a href="#fatoriza%C3%A7%C3%A3o-e-dags"><i class="fa fa-check"></i><b>3.8</b> Fatorização e DAGs</a></li>
<li class="chapter" data-level="3.9" data-path="08-DiD.html"><a href="#fatoriza%C3%A7%C3%A3o-dags-e-causalidade"><i class="fa fa-check"></i><b>3.9</b> Fatorização, DAGs e Causalidade</a></li>
<li class="chapter" data-level="3.10" data-path="08-DiD.html"><a href="#resumo-e-pr%C3%B3ximos-passos-2"><i class="fa fa-check"></i><b>3.10</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="3.11" data-path="08-DiD.html"><a href="#refer%C3%AAncias-2"><i class="fa fa-check"></i><b>3.11</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="experimentos.html"><a href="experimentos.html"><i class="fa fa-check"></i><b>4</b> Experimentos</a>
<ul>
<li class="chapter" data-level="4.1" data-path="08-DiD.html"><a href="#introdu%C3%A7%C3%A3o-2"><i class="fa fa-check"></i><b>4.1</b> Introdução</a></li>
<li class="chapter" data-level="4.2" data-path="08-DiD.html"><a href="#experimentos-aleat%C3%B3rios"><i class="fa fa-check"></i><b>4.2</b> Experimentos aleatórios</a></li>
<li class="chapter" data-level="4.3" data-path="08-DiD.html"><a href="#restri%C3%A7%C3%A3o-de-exclus%C3%A3o"><i class="fa fa-check"></i><b>4.3</b> Restrição de Exclusão</a></li>
<li class="chapter" data-level="4.4" data-path="experimentos.html"><a href="experimentos.html#tipos-de-experimentos"><i class="fa fa-check"></i><b>4.4</b> Tipos de experimentos</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="08-DiD.html"><a href="#aleatoriza%C3%A7%C3%A3o-de-bernoulli"><i class="fa fa-check"></i><b>4.4.1</b> Aleatorização de Bernoulli</a></li>
<li class="chapter" data-level="4.4.2" data-path="08-DiD.html"><a href="#aleatoriza%C3%A7%C3%A3o-completa"><i class="fa fa-check"></i><b>4.4.2</b> Aleatorização Completa</a></li>
<li class="chapter" data-level="4.4.3" data-path="08-DiD.html"><a href="#aleatoriza%C3%A7%C3%A3o-condicional-block-random-assignment"><i class="fa fa-check"></i><b>4.4.3</b> Aleatorização Condicional (Block Random Assignment)</a></li>
<li class="chapter" data-level="4.4.4" data-path="08-DiD.html"><a href="#pensando-aleatoriza%C3%A7%C3%A3o-em-bloco"><i class="fa fa-check"></i><b>4.4.4</b> Pensando aleatorização em bloco</a></li>
<li class="chapter" data-level="4.4.5" data-path="08-DiD.html"><a href="#ate-com-aleatoriza%C3%A7%C3%A3o-condicional-bloco"><i class="fa fa-check"></i><b>4.4.5</b> ATE com Aleatorização Condicional (Bloco)</a></li>
<li class="chapter" data-level="4.4.6" data-path="08-DiD.html"><a href="#aleatoriza%C3%A7%C3%A3o-em-bloco"><i class="fa fa-check"></i><b>4.4.6</b> Aleatorização em bloco</a></li>
<li class="chapter" data-level="4.4.7" data-path="08-DiD.html"><a href="#precis%C3%A3o-da-aleatoriza%C3%A7%C3%A3o-em-bloco"><i class="fa fa-check"></i><b>4.4.7</b> Precisão da aleatorização em bloco</a></li>
<li class="chapter" data-level="4.4.8" data-path="08-DiD.html"><a href="#compara%C3%A7%C3%A3o-de-ses"><i class="fa fa-check"></i><b>4.4.8</b> Comparação de SEs</a></li>
<li class="chapter" data-level="4.4.9" data-path="experimentos.html"><a href="experimentos.html#cluster-randomization"><i class="fa fa-check"></i><b>4.4.9</b> Cluster randomization</a></li>
<li class="chapter" data-level="4.4.10" data-path="experimentos.html"><a href="experimentos.html#tabelas-em-artigos"><i class="fa fa-check"></i><b>4.4.10</b> Tabelas em artigos</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="experimentos.html"><a href="experimentos.html#estimador-ate"><i class="fa fa-check"></i><b>4.5</b> Estimador ATE</a></li>
<li class="chapter" data-level="4.6" data-path="08-DiD.html"><a href="#resumo-do-cap%C3%ADtulo"><i class="fa fa-check"></i><b>4.6</b> Resumo do Capítulo</a></li>
<li class="chapter" data-level="4.7" data-path="experimentos.html"><a href="experimentos.html#declare-design"><i class="fa fa-check"></i><b>4.7</b> Declare Design</a></li>
<li class="chapter" data-level="4.8" data-path="08-DiD.html"><a href="#exerc%C3%ADcio"><i class="fa fa-check"></i><b>4.8</b> Exercício</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="08-DiD.html"><a href="#experimento-com-envio-de-cart%C3%B5es-postais-e-participa%C3%A7%C3%A3o-eleitoral"><i class="fa fa-check"></i><b>4.8.1</b> Experimento com envio de cartões-postais e participação eleitoral</a></li>
<li class="chapter" data-level="4.8.2" data-path="08-DiD.html"><a href="#experimento-com-an%C3%BAncios-de-tv-e-participa%C3%A7%C3%A3o-eleitoral"><i class="fa fa-check"></i><b>4.8.2</b> Experimento com anúncios de TV e participação eleitoral</a></li>
<li class="chapter" data-level="4.8.3" data-path="08-DiD.html"><a href="#exclus%C3%A3o-de-participantes-em-experimentos-de-survey"><i class="fa fa-check"></i><b>4.8.3</b> Exclusão de participantes em experimentos de survey</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html"><i class="fa fa-check"></i><b>5</b> Propensity Score e Matching</a>
<ul>
<li class="chapter" data-level="5.1" data-path="08-DiD.html"><a href="#introdu%C3%A7%C3%A3o-3"><i class="fa fa-check"></i><b>5.1</b> Introdução</a></li>
<li class="chapter" data-level="5.2" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#propensity-score"><i class="fa fa-check"></i><b>5.2</b> Propensity Score</a></li>
<li class="chapter" data-level="5.3" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching"><i class="fa fa-check"></i><b>5.3</b> Matching</a></li>
<li class="chapter" data-level="5.4" data-path="08-DiD.html"><a href="#suposi%C3%A7%C3%B5es-de-identifica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>5.4</b> Suposições de identificação</a></li>
<li class="chapter" data-level="5.5" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching-1"><i class="fa fa-check"></i><b>5.5</b> Matching</a></li>
<li class="chapter" data-level="5.6" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching-exato"><i class="fa fa-check"></i><b>5.6</b> Matching exato</a></li>
<li class="chapter" data-level="5.7" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching-aproximado"><i class="fa fa-check"></i><b>5.7</b> Matching aproximado</a></li>
<li class="chapter" data-level="5.8" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#estimando-1"><i class="fa fa-check"></i><b>5.8</b> Estimando</a></li>
<li class="chapter" data-level="5.9" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#declare-design-e-matching"><i class="fa fa-check"></i><b>5.9</b> Declare Design e Matching</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="propensity-score-e-matching.html"><a href="propensity-score-e-matching.html#matching-e-propensity-scores"><i class="fa fa-check"></i><b>5.9.1</b> Matching e Propensity scores</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="08-DiD.html"><a href="#recomenda%C3%A7%C3%B5es-pr%C3%A1ticas-sobre-matching"><i class="fa fa-check"></i><b>5.10</b> Recomendações Práticas sobre Matching</a></li>
<li class="chapter" data-level="5.11" data-path="08-DiD.html"><a href="#refer%C3%AAncias-3"><i class="fa fa-check"></i><b>5.11</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="08-DiD.html"><a href="#vari%C3%A1veis-instrumentais"><i class="fa fa-check"></i><b>6</b> Variáveis Instrumentais</a>
<ul>
<li class="chapter" data-level="6.1" data-path="08-DiD.html"><a href="#introdu%C3%A7%C3%A3o-4"><i class="fa fa-check"></i><b>6.1</b> Introdução</a></li>
<li class="chapter" data-level="6.2" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html"><i class="fa fa-check"></i><b>6.2</b> IV com modelo estrutural</a></li>
<li class="chapter" data-level="6.3" data-path="08-DiD.html"><a href="#mqo-em-2-est%C3%A1gios"><i class="fa fa-check"></i><b>6.3</b> MQO em 2 Estágios</a></li>
<li class="chapter" data-level="6.4" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#principais-usos-de-iv"><i class="fa fa-check"></i><b>6.4</b> Principais usos de IV</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#experimentos-1"><i class="fa fa-check"></i><b>6.4.1</b> Experimentos</a></li>
<li class="chapter" data-level="6.4.2" data-path="08-DiD.html"><a href="#regras-com-varia%C3%A7%C3%A3o-quasi-aleat%C3%B3ria"><i class="fa fa-check"></i><b>6.4.2</b> Regras com variação quasi-aleatória</a></li>
<li class="chapter" data-level="6.4.3" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#teoria"><i class="fa fa-check"></i><b>6.4.3</b> Teoria</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="08-DiD.html"><a href="#efeito-heterog%C3%AAneo"><i class="fa fa-check"></i><b>6.5</b> Efeito heterogêneo</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="08-DiD.html"><a href="#suposi%C3%A7%C3%B5es-para-estimar-o-late"><i class="fa fa-check"></i><b>6.5.1</b> Suposições para estimar o LATE</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="08-DiD.html"><a href="#restri%C3%A7%C3%A3o-de-exclus%C3%A3o-1"><i class="fa fa-check"></i><b>6.6</b> Restrição de Exclusão</a></li>
<li class="chapter" data-level="6.7" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#monotonicidade"><i class="fa fa-check"></i><b>6.7</b> Monotonicidade</a></li>
<li class="chapter" data-level="6.8" data-path="08-DiD.html"><a href="#estima%C3%A7%C3%A3o-aka-estat%C3%ADstica-f"><i class="fa fa-check"></i><b>6.8</b> Estimação (aka estatística F)</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="variáveis-instrumentais.html"><a href="variáveis-instrumentais.html#f-stat"><i class="fa fa-check"></i><b>6.8.1</b> F stat</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="08-DiD.html"><a href="#resumo-e-pr%C3%B3ximos-passos-3"><i class="fa fa-check"></i><b>6.9</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="6.10" data-path="08-DiD.html"><a href="#refer%C3%AAncias-4"><i class="fa fa-check"></i><b>6.10</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="08-DiD.html"><a href="#desenho-de-regress%C3%A3o-descont%C3%ADnua"><i class="fa fa-check"></i><b>7</b> Desenho de Regressão Descontínua</a>
<ul>
<li class="chapter" data-level="7.1" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html"><i class="fa fa-check"></i><b>7.1</b> Outline da aula</a></li>
<li class="chapter" data-level="7.2" data-path="08-DiD.html"><a href="#caracter%C3%ADsticas-chave-da-rdd"><i class="fa fa-check"></i><b>7.2</b> Características-chave da RDD</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="08-DiD.html"><a href="#determina%C3%A7%C3%A3o-do-tratamento"><i class="fa fa-check"></i><b>7.2.1</b> Determinação do Tratamento</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#fuzzy-rdd"><i class="fa fa-check"></i><b>7.3</b> Fuzzy RDD</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="08-DiD.html"><a href="#observa%C3%A7%C3%A3o-e-corte"><i class="fa fa-check"></i><b>7.3.1</b> Observação e Corte</a></li>
<li class="chapter" data-level="7.3.2" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#estimativa-dos-efeitos-do-tratamento"><i class="fa fa-check"></i><b>7.3.2</b> Estimativa dos Efeitos do Tratamento</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="08-DiD.html"><a href="#suposi%C3%A7%C3%A3o-de-continuidade"><i class="fa fa-check"></i><b>7.4</b> Suposição de continuidade</a></li>
<li class="chapter" data-level="7.5" data-path="08-DiD.html"><a href="#suposi%C3%A7%C3%B5es-na-rdd"><i class="fa fa-check"></i><b>7.5</b> Suposições na RDD</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="08-DiD.html"><a href="#suposi%C3%A7%C3%A3o-de-n%C3%A3o-manipula%C3%A7%C3%A3o-com-precis%C3%A3o"><i class="fa fa-check"></i><b>7.5.1</b> Suposição de Não-manipulação com Precisão</a></li>
<li class="chapter" data-level="7.5.2" data-path="08-DiD.html"><a href="#problemas-de-manipula%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.5.2</b> Problemas de Manipulação</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="08-DiD.html"><a href="#testabilidade-da-suposi%C3%A7%C3%A3o-de-n%C3%A3o-manipula%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.6</b> Testabilidade da Suposição de não-Manipulação</a></li>
<li class="chapter" data-level="7.7" data-path="08-DiD.html"><a href="#estima%C3%A7%C3%A3o-em-rdd"><i class="fa fa-check"></i><b>7.7</b> Estimação em RDD</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#problema-de-complete-overlapping"><i class="fa fa-check"></i><b>7.7.1</b> Problema de Complete Overlapping</a></li>
<li class="chapter" data-level="7.7.2" data-path="08-DiD.html"><a href="#depend%C3%AAncia-de-extrapola%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.7.2</b> Dependência de Extrapolação</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="08-DiD.html"><a href="#m%C3%A9todos-de-estima%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.8</b> Métodos de Estimação</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="08-DiD.html"><a href="#identifica%C3%A7%C3%A3o-no-limite"><i class="fa fa-check"></i><b>7.8.1</b> Identificação no Limite</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="08-DiD.html"><a href="#trade-off-de-vi%C3%A9s-vari%C3%A2ncia"><i class="fa fa-check"></i><b>7.9</b> Trade-off de Viés-Variância</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="08-DiD.html"><a href="#m%C3%A9todos-de-largura-de-banda-%C3%B3tima"><i class="fa fa-check"></i><b>7.9.1</b> Métodos de Largura de Banda Ótima</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="08-DiD.html"><a href="#regras-arbitr%C3%A1rias"><i class="fa fa-check"></i><b>7.10</b> Regras arbitrárias</a></li>
<li class="chapter" data-level="7.11" data-path="08-DiD.html"><a href="#simula%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>7.11</b> Simulação</a></li>
<li class="chapter" data-level="7.12" data-path="08-DiD.html"><a href="#simula%C3%A7%C3%A3o---potential-outcomes-y0"><i class="fa fa-check"></i><b>7.12</b> Simulação - Potential Outcomes Y0</a></li>
<li class="chapter" data-level="7.13" data-path="08-DiD.html"><a href="#simula%C3%A7%C3%A3o---potential-outcomes-y1"><i class="fa fa-check"></i><b>7.13</b> Simulação - Potential Outcomes Y1</a></li>
<li class="chapter" data-level="7.14" data-path="08-DiD.html"><a href="#simula%C3%A7%C3%A3o---potential-outcomes-y1-e-y0"><i class="fa fa-check"></i><b>7.14</b> Simulação - Potential Outcomes Y1 e Y0</a></li>
<li class="chapter" data-level="7.15" data-path="08-DiD.html"><a href="#simula%C3%A7%C3%A3o---y-observado"><i class="fa fa-check"></i><b>7.15</b> Simulação - Y observado</a></li>
<li class="chapter" data-level="7.16" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#quando-o-rdd-funciona"><i class="fa fa-check"></i><b>7.16</b> Quando o RDD funciona?</a></li>
<li class="chapter" data-level="7.17" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#raw-data-versus-bin"><i class="fa fa-check"></i><b>7.17</b> Raw Data versus Bin</a></li>
<li class="chapter" data-level="7.18" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#permutation-tests-balancing"><i class="fa fa-check"></i><b>7.18</b> Permutation tests (balancing)</a></li>
<li class="chapter" data-level="7.19" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#mccrary-test"><i class="fa fa-check"></i><b>7.19</b> McCrary test</a></li>
<li class="chapter" data-level="7.20" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#robustez"><i class="fa fa-check"></i><b>7.20</b> Robustez</a></li>
<li class="chapter" data-level="7.21" data-path="08-DiD.html"><a href="#densidade-descont%C3%ADnua---results"><i class="fa fa-check"></i><b>7.21</b> Densidade descontínua - results</a></li>
<li class="chapter" data-level="7.22" data-path="08-DiD.html"><a href="#regress%C3%A3o-rdd"><i class="fa fa-check"></i><b>7.22</b> Regressão RDD</a></li>
<li class="chapter" data-level="7.23" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#placebo-tests"><i class="fa fa-check"></i><b>7.23</b> Placebo Tests</a></li>
<li class="chapter" data-level="7.24" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#pcrd"><i class="fa fa-check"></i><b>7.24</b> PCRD</a></li>
<li class="chapter" data-level="7.25" data-path="desenho-de-regressão-descontínua.html"><a href="desenho-de-regressão-descontínua.html#checklist-para-um-paper-de-rdd"><i class="fa fa-check"></i><b>7.25</b> Checklist para um paper de RDD</a></li>
<li class="chapter" data-level="7.26" data-path="08-DiD.html"><a href="#refer%C3%AAncias-5"><i class="fa fa-check"></i><b>7.26</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="08-DiD.html"><a href="#diferen%C3%A7a-em-diferen%C3%A7as"><i class="fa fa-check"></i><b>8</b> Diferença em Diferenças</a>
<ul>
<li class="chapter" data-level="8.1" data-path="08-DiD.html"><a href="#motiva%C3%A7%C3%A3o-por-que-did"><i class="fa fa-check"></i><b>8.1</b> Motivação: por que DiD?</a></li>
<li class="chapter" data-level="8.2" data-path="08-DiD.html"><a href="#modelo-b%C3%A1sico-22"><i class="fa fa-check"></i><b>8.2</b> Modelo básico 2$$2</a></li>
<li class="chapter" data-level="8.3" data-path="08-DiD.html"><a href="#pressupostos-de-identifica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>8.3</b> Pressupostos de identificação</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="08-DiD.html"><a href="#tend%C3%AAncias-paralelas"><i class="fa fa-check"></i><b>8.3.1</b> Tendências paralelas</a></li>
<li class="chapter" data-level="8.3.2" data-path="08-DiD.html"><a href="#equival%C3%AAncia-entre-pt-e-twfe"><i class="fa fa-check"></i><b>8.3.2</b> Equivalência entre PT e TWFE</a></li>
<li class="chapter" data-level="8.3.3" data-path="08-DiD.html"><a href="#n%C3%A3o-antecipa%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>8.3.3</b> Não-antecipação</a></li>
<li class="chapter" data-level="8.3.4" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html"><i class="fa fa-check"></i><b>8.3.4</b> DAG para DiD</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="08-DiD.html"><a href="#estima%C3%A7%C3%A3o-por-twfe"><i class="fa fa-check"></i><b>8.4</b> Estimação por TWFE</a></li>
<li class="chapter" data-level="8.5" data-path="08-DiD.html"><a href="#aplica%C3%A7%C3%A3o-1-obra-transparente"><i class="fa fa-check"></i><b>8.5</b> Aplicação 1: Obra Transparente</a></li>
<li class="chapter" data-level="8.6" data-path="08-DiD.html"><a href="#did-din%C3%A2mico-e-event-study"><i class="fa fa-check"></i><b>8.6</b> DiD dinâmico e event study</a></li>
<li class="chapter" data-level="8.7" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#o-problema-do-twfe-com-tratamento-escalonado"><i class="fa fa-check"></i><b>8.7</b> O problema do TWFE com tratamento escalonado</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#o-que-pode-dar-errado"><i class="fa fa-check"></i><b>8.7.1</b> O que pode dar errado</a></li>
<li class="chapter" data-level="8.7.2" data-path="08-DiD.html"><a href="#decomposi%C3%A7%C3%A3o-de-goodman-bacon-simula%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>8.7.2</b> Decomposição de Goodman-Bacon — simulação</a></li>
<li class="chapter" data-level="8.7.3" data-path="08-DiD.html"><a href="#conex%C3%A3o-com-fwl-e-gardner"><i class="fa fa-check"></i><b>8.7.3</b> Conexão com FWL e Gardner</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#estimadores-modernos"><i class="fa fa-check"></i><b>8.8</b> Estimadores modernos</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#callaway-santanna-2021"><i class="fa fa-check"></i><b>8.8.1</b> Callaway &amp; Sant’Anna (2021)</a></li>
<li class="chapter" data-level="8.8.2" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#sun-abraham-2021"><i class="fa fa-check"></i><b>8.8.2</b> Sun &amp; Abraham (2021)</a></li>
<li class="chapter" data-level="8.8.3" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#gardner-2022-did2s"><i class="fa fa-check"></i><b>8.8.3</b> Gardner (2022) / did2s</a></li>
<li class="chapter" data-level="8.8.4" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#borusyak-jaravel-spiess-2024"><i class="fa fa-check"></i><b>8.8.4</b> Borusyak, Jaravel &amp; Spiess (2024)</a></li>
<li class="chapter" data-level="8.8.5" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#tabela-comparativa"><i class="fa fa-check"></i><b>8.8.5</b> Tabela comparativa</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="08-DiD.html"><a href="#testando-tend%C3%AAncias-paralelas-e-an%C3%A1lise-de-sensibilidade"><i class="fa fa-check"></i><b>8.9</b> Testando tendências paralelas e análise de sensibilidade</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#pre-trends-e-o-aviso-de-roth-2022"><i class="fa fa-check"></i><b>8.9.1</b> Pre-trends e o aviso de Roth (2022)</a></li>
<li class="chapter" data-level="8.9.2" data-path="08-DiD.html"><a href="#honestdid-an%C3%A1lise-de-sensibilidade"><i class="fa fa-check"></i><b>8.9.2</b> HonestDiD: análise de sensibilidade</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="08-DiD.html"><a href="#aplica%C3%A7%C3%A3o-2-enchente-do-elbe"><i class="fa fa-check"></i><b>8.10</b> Aplicação 2: Enchente do Elbe</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#contexto"><i class="fa fa-check"></i><b>8.10.1</b> Contexto</a></li>
<li class="chapter" data-level="8.10.2" data-path="08-DiD.html"><a href="#dados-e-did-b%C3%A1sico"><i class="fa fa-check"></i><b>8.10.2</b> Dados e DiD básico</a></li>
<li class="chapter" data-level="8.10.3" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#event-study"><i class="fa fa-check"></i><b>8.10.3</b> Event study</a></li>
<li class="chapter" data-level="8.10.4" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#robustez-1"><i class="fa fa-check"></i><b>8.10.4</b> Robustez</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="08-DiD.html"><a href="#did-condicional-e-extens%C3%B5es"><i class="fa fa-check"></i><b>8.11</b> DiD condicional e extensões</a></li>
<li class="chapter" data-level="8.12" data-path="diferença-em-diferenças.html"><a href="diferença-em-diferenças.html#resumo"><i class="fa fa-check"></i><b>8.12</b> Resumo</a></li>
<li class="chapter" data-level="8.13" data-path="08-DiD.html"><a href="#refer%C3%AAncias-6"><i class="fa fa-check"></i><b>8.13</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html"><i class="fa fa-check"></i><b>9</b> Time-Series Cross-Section (TSCS)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="08-DiD.html"><a href="#introdu%C3%A7%C3%A3o-5"><i class="fa fa-check"></i><b>9.1</b> Introdução</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#within-versus-between"><i class="fa fa-check"></i><b>9.1.1</b> Within versus Between</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#ovb"><i class="fa fa-check"></i><b>9.2</b> OVB</a></li>
<li class="chapter" data-level="9.3" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#estimandos"><i class="fa fa-check"></i><b>9.3</b> Estimandos</a></li>
<li class="chapter" data-level="9.4" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#resultados-potenciais-1"><i class="fa fa-check"></i><b>9.4</b> Resultados Potenciais</a></li>
<li class="chapter" data-level="9.5" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#modelo-ar1"><i class="fa fa-check"></i><b>9.5</b> Modelo AR(1)</a></li>
<li class="chapter" data-level="9.6" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#sequential-ignorability"><i class="fa fa-check"></i><b>9.6</b> Sequential ignorability</a></li>
<li class="chapter" data-level="9.7" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#resumo-1"><i class="fa fa-check"></i><b>9.7</b> Resumo</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#remark"><i class="fa fa-check"></i><b>9.7.1</b> Remark</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="08-DiD.html"><a href="#suposi%C3%A7%C3%B5es-para-infer%C3%AAncia"><i class="fa fa-check"></i><b>9.8</b> Suposições para Inferência</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="time-series-cross-section-tscs.html"><a href="time-series-cross-section-tscs.html#remark-1"><i class="fa fa-check"></i><b>9.8.1</b> Remark</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="08-DiD.html"><a href="#efeitos-aleat%C3%B3rios"><i class="fa fa-check"></i><b>9.9</b> Efeitos aleatórios</a></li>
<li class="chapter" data-level="9.10" data-path="08-DiD.html"><a href="#refer%C3%AAncias-7"><i class="fa fa-check"></i><b>9.10</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="synthetic-control.html"><a href="synthetic-control.html"><i class="fa fa-check"></i><b>10</b> Synthetic Control</a>
<ul>
<li class="chapter" data-level="10.0.1" data-path="synthetic-control.html"><a href="synthetic-control.html#tratamento"><i class="fa fa-check"></i><b>10.0.1</b> Tratamento</a></li>
<li class="chapter" data-level="10.1" data-path="08-DiD.html"><a href="#implementa%C3%A7%C3%A3o-no-r"><i class="fa fa-check"></i><b>10.1</b> Implementação no R</a></li>
<li class="chapter" data-level="10.2" data-path="synthetic-control.html"><a href="synthetic-control.html#synthetic-did"><i class="fa fa-check"></i><b>10.2</b> Synthetic DiD</a></li>
<li class="chapter" data-level="10.3" data-path="08-DiD.html"><a href="#resumo-e-pr%C3%B3ximos-passos-4"><i class="fa fa-check"></i><b>10.3</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="10.4" data-path="08-DiD.html"><a href="#refer%C3%AAncias-8"><i class="fa fa-check"></i><b>10.4</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="llms-e-outras.html"><a href="llms-e-outras.html"><i class="fa fa-check"></i><b>11</b> LLMs e outras</a>
<ul>
<li class="chapter" data-level="11.1" data-path="llms-e-outras.html"><a href="llms-e-outras.html#google-colab"><i class="fa fa-check"></i><b>11.1</b> Google Colab</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>12</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="12.1" data-path="08-DiD.html"><a href="#introdu%C3%A7%C3%A3o-6"><i class="fa fa-check"></i><b>12.1</b> Introdução</a></li>
<li class="chapter" data-level="12.2" data-path="machine-learning.html"><a href="machine-learning.html#terminologia"><i class="fa fa-check"></i><b>12.2</b> Terminologia</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="machine-learning.html"><a href="machine-learning.html#lasso"><i class="fa fa-check"></i><b>12.2.1</b> LASSO</a></li>
<li class="chapter" data-level="12.2.2" data-path="machine-learning.html"><a href="machine-learning.html#double-lasso"><i class="fa fa-check"></i><b>12.2.2</b> Double Lasso</a></li>
<li class="chapter" data-level="12.2.3" data-path="08-DiD.html"><a href="#outras-solu%C3%A7%C3%B5es-ineficazes"><i class="fa fa-check"></i><b>12.2.3</b> Outras soluções ineficazes</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="machine-learning.html"><a href="machine-learning.html#dl---algoritmo"><i class="fa fa-check"></i><b>12.3</b> DL - Algoritmo</a></li>
<li class="chapter" data-level="12.4" data-path="08-DiD.html"><a href="#termos-de-intera%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>12.4</b> Termos de Interação</a></li>
<li class="chapter" data-level="12.5" data-path="08-DiD.html"><a href="#aplica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>12.5</b> Aplicação</a></li>
<li class="chapter" data-level="12.6" data-path="machine-learning.html"><a href="machine-learning.html#dml"><i class="fa fa-check"></i><b>12.6</b> DML</a></li>
<li class="chapter" data-level="12.7" data-path="machine-learning.html"><a href="machine-learning.html#double-debiasing"><i class="fa fa-check"></i><b>12.7</b> Double Debiasing</a></li>
<li class="chapter" data-level="12.8" data-path="machine-learning.html"><a href="machine-learning.html#cross-fitting"><i class="fa fa-check"></i><b>12.8</b> Cross-fitting</a></li>
<li class="chapter" data-level="12.9" data-path="08-DiD.html"><a href="#quest%C3%B5es-pr%C3%A1ticas"><i class="fa fa-check"></i><b>12.9</b> Questões Práticas</a></li>
<li class="chapter" data-level="12.10" data-path="08-DiD.html"><a href="#resumo-e-pr%C3%B3ximos-passos-5"><i class="fa fa-check"></i><b>12.10</b> Resumo e próximos passos</a></li>
<li class="chapter" data-level="12.11" data-path="08-DiD.html"><a href="#refer%C3%AAncias-9"><i class="fa fa-check"></i><b>12.11</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="resumo-2.html"><a href="resumo-2.html"><i class="fa fa-check"></i><b>13</b> Resumo</a>
<ul>
<li class="chapter" data-level="13.1" data-path="resumo-2.html"><a href="resumo-2.html#matching-2"><i class="fa fa-check"></i><b>13.1</b> Matching</a></li>
<li class="chapter" data-level="13.2" data-path="resumo-2.html"><a href="resumo-2.html#iv"><i class="fa fa-check"></i><b>13.2</b> IV</a></li>
<li class="chapter" data-level="13.3" data-path="resumo-2.html"><a href="resumo-2.html#rdd"><i class="fa fa-check"></i><b>13.3</b> RDD</a></li>
<li class="chapter" data-level="13.4" data-path="resumo-2.html"><a href="resumo-2.html#did"><i class="fa fa-check"></i><b>13.4</b> DiD</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="resumo-2.html"><a href="resumo-2.html#tscs"><i class="fa fa-check"></i><b>13.4.1</b> TSCS</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="resumo-2.html"><a href="resumo-2.html#scm"><i class="fa fa-check"></i><b>13.5</b> SCM</a></li>
<li class="chapter" data-level="13.6" data-path="08-DiD.html"><a href="#did-sint%C3%A9tico"><i class="fa fa-check"></i><b>13.6</b> DiD Sintético</a></li>
<li class="chapter" data-level="13.7" data-path="resumo-2.html"><a href="resumo-2.html#double-lasso-1"><i class="fa fa-check"></i><b>13.7</b> Double LASSO</a></li>
<li class="chapter" data-level="13.8" data-path="resumo-2.html"><a href="resumo-2.html#dml-1"><i class="fa fa-check"></i><b>13.8</b> DML</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="shift-share.html"><a href="shift-share.html"><i class="fa fa-check"></i><b>14</b> Shift-share</a>
<ul>
<li class="chapter" data-level="14.1" data-path="08-DiD.html"><a href="#introdu%C3%A7%C3%A3o-7"><i class="fa fa-check"></i><b>14.1</b> Introdução</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="08-DiD.html"><a href="#aplica%C3%A7%C3%A3o-pib-por-estado-e-setor"><i class="fa fa-check"></i><b>14.1.1</b> Aplicação: PIB por estado e setor</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="08-DiD.html"><a href="#exemplos-da-pol%C3%ADtica"><i class="fa fa-check"></i><b>14.2</b> Exemplos da Política</a></li>
<li class="chapter" data-level="14.3" data-path="08-DiD.html"><a href="#varia%C3%A7%C3%A3o-temporal"><i class="fa fa-check"></i><b>14.3</b> Variação temporal</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="08-DiD.html"><a href="#aplica%C3%A7%C3%A3o-elei%C3%A7%C3%B5es-presidenciais-20142018"><i class="fa fa-check"></i><b>14.3.1</b> Aplicação: Eleições presidenciais 2014→2018</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="08-DiD.html"><a href="#o-instrumento-shift-share-como-vari%C3%A1vel-instrumental"><i class="fa fa-check"></i><b>14.4</b> O instrumento shift-share como variável instrumental</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="08-DiD.html"><a href="#constru%C3%A7%C3%A3o-formal"><i class="fa fa-check"></i><b>14.4.1</b> Construção formal</a></li>
<li class="chapter" data-level="14.4.2" data-path="shift-share.html"><a href="shift-share.html#voltando-ao-exemplo-construindo-w_ik-g_k-e-b_i-com-dados-eleitorais"><i class="fa fa-check"></i><b>14.4.2</b> Voltando ao exemplo: construindo <span class="math inline">\(w_{ik}\)</span>, <span class="math inline">\(g_k\)</span> e <span class="math inline">\(B_i\)</span> com dados eleitorais</a></li>
<li class="chapter" data-level="14.4.3" data-path="shift-share.html"><a href="shift-share.html#o-modelo-estrutural-e-o-iv"><i class="fa fa-check"></i><b>14.4.3</b> O modelo estrutural e o IV</a></li>
<li class="chapter" data-level="14.4.4" data-path="shift-share.html"><a href="shift-share.html#interpretando-o-modelo-com-o-exemplo-eleitoral"><i class="fa fa-check"></i><b>14.4.4</b> Interpretando o modelo com o exemplo eleitoral</a></li>
<li class="chapter" data-level="14.4.5" data-path="08-DiD.html"><a href="#por-que-o-instrumento-seria-v%C3%A1lido-uma-discuss%C3%A3o-intuitiva"><i class="fa fa-check"></i><b>14.4.5</b> Por que o instrumento seria válido? Uma discussão intuitiva</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="08-DiD.html"><a href="#duas-estrat%C3%A9gias-de-identifica%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>14.5</b> Duas estratégias de identificação</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="08-DiD.html"><a href="#estrat%C3%A9gia-1-exogeneidade-das-shares-gpss-2020"><i class="fa fa-check"></i><b>14.5.1</b> Estratégia 1: Exogeneidade das shares (GPSS 2020)</a></li>
<li class="chapter" data-level="14.5.2" data-path="08-DiD.html"><a href="#estrat%C3%A9gia-2-exogeneidade-dos-shifts-bhj-2022"><i class="fa fa-check"></i><b>14.5.2</b> Estratégia 2: Exogeneidade dos shifts (BHJ 2022)</a></li>
<li class="chapter" data-level="14.5.3" data-path="08-DiD.html"><a href="#resumo-das-duas-estrat%C3%A9gias"><i class="fa fa-check"></i><b>14.5.3</b> Resumo das duas estratégias</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="08-DiD.html"><a href="#o-problema-de-infer%C3%AAncia"><i class="fa fa-check"></i><b>14.6</b> O problema de inferência</a></li>
<li class="chapter" data-level="14.7" data-path="08-DiD.html"><a href="#implementa%C3%A7%C3%A3o-em-r"><i class="fa fa-check"></i><b>14.7</b> Implementação em R</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="08-DiD.html"><a href="#constru%C3%A7%C3%A3o-do-instrumento"><i class="fa fa-check"></i><b>14.7.1</b> Construção do instrumento</a></li>
<li class="chapter" data-level="14.7.2" data-path="08-DiD.html"><a href="#estima%C3%A7%C3%A3o-iv"><i class="fa fa-check"></i><b>14.7.2</b> Estimação IV</a></li>
<li class="chapter" data-level="14.7.3" data-path="08-DiD.html"><a href="#erros-padr%C3%A3o-corrigidos-pacote-shiftsharese"><i class="fa fa-check"></i><b>14.7.3</b> Erros-padrão corrigidos: pacote <code>ShiftShareSE</code></a></li>
<li class="chapter" data-level="14.7.4" data-path="08-DiD.html"><a href="#agrega%C3%A7%C3%A3o-ao-n%C3%ADvel-do-choque-pacote-ssaggregate"><i class="fa fa-check"></i><b>14.7.4</b> Agregação ao nível do choque: pacote <code>ssaggregate</code></a></li>
<li class="chapter" data-level="14.7.5" data-path="shift-share.html"><a href="shift-share.html#ecossistema-r-vs.-stata"><i class="fa fa-check"></i><b>14.7.5</b> Ecossistema R vs. Stata</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="08-DiD.html"><a href="#aplica%C3%A7%C3%B5es-em-ci%C3%AAncia-pol%C3%ADtica"><i class="fa fa-check"></i><b>14.8</b> Aplicações em Ciência Política</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path="08-DiD.html"><a href="#com%C3%A9rcio-e-voto-nos-eua"><i class="fa fa-check"></i><b>14.8.1</b> Comércio e voto nos EUA</a></li>
<li class="chapter" data-level="14.8.2" data-path="08-DiD.html"><a href="#com%C3%A9rcio-e-nacionalismo-na-europa"><i class="fa fa-check"></i><b>14.8.2</b> Comércio e nacionalismo na Europa</a></li>
<li class="chapter" data-level="14.8.3" data-path="08-DiD.html"><a href="#valores-autorit%C3%A1rios"><i class="fa fa-check"></i><b>14.8.3</b> Valores autoritários</a></li>
<li class="chapter" data-level="14.8.4" data-path="08-DiD.html"><a href="#welfare-state-hist%C3%B3rico"><i class="fa fa-check"></i><b>14.8.4</b> Welfare state histórico</a></li>
<li class="chapter" data-level="14.8.5" data-path="08-DiD.html"><a href="#automa%C3%A7%C3%A3o-e-redistribui%C3%A7%C3%A3o"><i class="fa fa-check"></i><b>14.8.5</b> Automação e redistribuição</a></li>
<li class="chapter" data-level="14.8.6" data-path="shift-share.html"><a href="shift-share.html#brasil"><i class="fa fa-check"></i><b>14.8.6</b> Brasil</a></li>
<li class="chapter" data-level="14.8.7" data-path="08-DiD.html"><a href="#competi%C3%A7%C3%A3o-pol%C3%ADtica-e-desmatamento"><i class="fa fa-check"></i><b>14.8.7</b> Competição política e desmatamento</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="08-DiD.html"><a href="#aplica%C3%A7%C3%B5es-em-rela%C3%A7%C3%B5es-internacionais"><i class="fa fa-check"></i><b>14.9</b> Aplicações em Relações Internacionais</a>
<ul>
<li class="chapter" data-level="14.9.1" data-path="08-DiD.html"><a href="#com%C3%A9rcio-e-pol%C3%ADtica-externa"><i class="fa fa-check"></i><b>14.9.1</b> Comércio e política externa</a></li>
<li class="chapter" data-level="14.9.2" data-path="08-DiD.html"><a href="#comportamento-legislativo-em-pol%C3%ADtica-comercial"><i class="fa fa-check"></i><b>14.9.2</b> Comportamento legislativo em política comercial</a></li>
<li class="chapter" data-level="14.9.3" data-path="shift-share.html"><a href="shift-share.html#temas-com-potencial-inexplorado-em-ri"><i class="fa fa-check"></i><b>14.9.3</b> Temas com potencial inexplorado em RI</a></li>
</ul></li>
<li class="chapter" data-level="14.10" data-path="08-DiD.html"><a href="#refer%C3%AAncias-10"><i class="fa fa-check"></i><b>14.10</b> Referências</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="08-DiD.html"><a href="#interfer%C3%AAncia-spillover-e-din%C3%A2mica"><i class="fa fa-check"></i><b>15</b> Interferência, spillover e dinâmica</a>
<ul>
<li class="chapter" data-level="15.1" data-path="08-DiD.html"><a href="#suposi%C3%A7%C3%B5es-simplificadoras"><i class="fa fa-check"></i><b>15.1</b> Suposições simplificadoras</a></li>
<li class="chapter" data-level="15.2" data-path="08-DiD.html"><a href="#po-com-tratamento-de-m%C3%BAltiplos-valores-multi-valued"><i class="fa fa-check"></i><b>15.2</b> PO com tratamento de múltiplos valores (multi-valued)</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="interferência-spillover-e-dinâmica.html"><a href="interferência-spillover-e-dinâmica.html"><i class="fa fa-check"></i><b>15.2.1</b> Multi-valued discreto</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="08-DiD.html"><a href="#din%C3%A2mica"><i class="fa fa-check"></i><b>15.3</b> Dinâmica</a></li>
<li class="chapter" data-level="15.4" data-path="08-DiD.html"><a href="#interfer%C3%AAncia"><i class="fa fa-check"></i><b>15.4</b> Interferência</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Curso de Inferência Causal</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="diferença-em-diferenças" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Capítulo 8</span> Diferença em Diferenças<a href="#diferen%C3%A7a-em-diferen%C3%A7as" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="motivação-por-que-did" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Motivação: por que DiD?<a href="#motiva%C3%A7%C3%A3o-por-que-did" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Diferença em Diferenças (DiD) é o método quasi-experimental mais utilizado em ciência política e economia aplicada. A ideia central é simples: se dois grupos seguem trajetórias paralelas antes de uma intervenção, a diferença nas suas trajetórias <em>após</em> a intervenção pode ser atribuída ao tratamento.</p>
<p>Considere um exemplo concreto. Suponha que duas cidades — Campinas e Ribeirão Preto — têm taxas de conclusão de obras públicas de 30% e 20%, respectivamente, em 2016. Em 2018, Campinas recebe um programa de monitoramento de obras, enquanto Ribeirão Preto não. Em 2018, Campinas tem taxa de 50% e Ribeirão Preto, 35%.</p>
<p>A variação temporal em Campinas é <span class="math inline">\(50\% - 30\% = 20\)</span> p.p. Mas parte disso pode ser tendência geral — afinal, Ribeirão Preto também cresceu <span class="math inline">\(35\% - 20\% = 15\)</span> p.p. sem tratamento. O DiD subtrai essa tendência: <span class="math inline">\(20 - 15 = 5\)</span> p.p. Esse é o efeito estimado do programa.</p>
<p><span class="math display">\[
\underbrace{(50 - 30)}_{\Delta \text{Campinas}} - \underbrace{(35 - 20)}_{\Delta \text{Ribeirão}} = 20 - 15 = 5 \text{ p.p.}
\]</span></p>
<p>Essa conta manual contém toda a lógica do DiD. O restante do capítulo formaliza essa intuição, discute quando ela é válida (tendências paralelas), mostra como estimar por regressão (TWFE), e apresenta os avanços metodológicos recentes para lidar com tratamento escalonado no tempo e efeitos heterogêneos.</p>
<p><strong>Mapa do capítulo.</strong> As seções 2–4 cobrem o modelo 2$$2, pressupostos e estimação por TWFE. A seção 5 aplica DiD a dados brasileiros de obras públicas. A seção 6 introduz o DiD dinâmico (event study). As seções 7–8 tratam do problema central da “revolução DiD”: o viés do TWFE com tratamento escalonado e os estimadores modernos que o corrigem. A seção 9 discute testes de tendências paralelas e análise de sensibilidade. A seção 10 apresenta uma segunda aplicação empírica (enchente do Elbe). As seções 11–12 cobrem extensões e resumo.</p>
</div>
<div id="modelo-básico-22" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Modelo básico 2$$2<a href="#modelo-b%C3%A1sico-22" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Considere dois grupos e dois períodos de tempo, <span class="math inline">\(t \in \{1, 2\}\)</span>. O grupo tratado recebe a intervenção no período 2; o grupo controle nunca é tratado. Seja <span class="math inline">\(D_i \in \{0, 1\}\)</span> o indicador de pertencer ao grupo tratado.</p>
<p>Definimos os resultados potenciais: <span class="math inline">\(Y_{it}(0)\)</span> é o resultado da unidade <span class="math inline">\(i\)</span> no período <span class="math inline">\(t\)</span> na ausência de tratamento, e <span class="math inline">\(Y_{it}(1)\)</span> é o resultado sob tratamento. O resultado observado é <span class="math inline">\(Y_{it} = D_i \cdot \mathbb{1}[t=2] \cdot Y_{it}(1) + (1 - D_i \cdot \mathbb{1}[t=2]) \cdot Y_{it}(0)\)</span>.</p>
<p>O <strong>estimando</strong> é o efeito médio do tratamento sobre os tratados (ATT) no período pós-tratamento:</p>
<p><span class="math display">\[
\tau^{ATT} = \mathbb{E}[Y_{i2}(1) - Y_{i2}(0) \mid D_i = 1]
\]</span></p>
<p>Suponha que os resultados potenciais seguem a estrutura:</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:tabela-did">Table 8.1: </span><span id="tab:tabela-did">Table 8.2: </span>Estrutura de resultados potenciais no DiD 2×2
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Pré (<span class="math inline">\(t = 1\)</span>)
</th>
<th style="text-align:center;">
Pós (<span class="math inline">\(t = 2\)</span>)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-right:1px solid;">
Controle (<span class="math inline">\(D_i = 0\)</span>)
</td>
<td style="text-align:center;">
<span class="math inline">\(\alpha_i + \lambda_1\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(\alpha_i + \lambda_2\)</span>
</td>
</tr>
<tr>
<td style="text-align:left;border-right:1px solid;">
Tratado (<span class="math inline">\(D_i = 1\)</span>)
</td>
<td style="text-align:center;">
<span class="math inline">\(\alpha_i + \lambda_1\)</span>
</td>
<td style="text-align:center;">
<span class="math inline">\(\alpha_i + \lambda_2 + \tau_i\)</span>
</td>
</tr>
</tbody>
</table>
<p>Nessa tabela, <span class="math inline">\(\alpha_i\)</span> é o efeito fixo de unidade (nível base), <span class="math inline">\(\lambda_t\)</span> é o efeito fixo de tempo (tendência comum), e <span class="math inline">\(\tau_i\)</span> é o efeito causal individual. No grupo controle, <span class="math inline">\(\tau_i = 0\)</span> por definição.</p>
<p>A diferença temporal para cada grupo é:</p>
<p>Para o grupo tratado: <span class="math inline">\(\mathbb{E}[Y_{i2} - Y_{i1} \mid D_i = 1] = (\lambda_2 - \lambda_1) + \mathbb{E}[\tau_i \mid D_i = 1]\)</span></p>
<p>Para o grupo controle: <span class="math inline">\(\mathbb{E}[Y_{i2} - Y_{i1} \mid D_i = 0] = (\lambda_2 - \lambda_1)\)</span></p>
<p>A diferença entre essas duas diferenças elimina a tendência comum:</p>
<p><span class="math display">\[
\underbrace{\mathbb{E}[Y_{i2} - Y_{i1} \mid D_i = 1]}_{\Delta \text{Tratado}} - \underbrace{\mathbb{E}[Y_{i2} - Y_{i1} \mid D_i = 0]}_{\Delta \text{Controle}} = \mathbb{E}[\tau_i \mid D_i = 1] = \tau^{ATT}
\]</span></p>
<p>O modelo básico 2$$2 nos dá a intuição do DiD. Na prática, estimamos esse efeito por regressão, como veremos a seguir.</p>
</div>
<div id="pressupostos-de-identificação" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Pressupostos de identificação<a href="#pressupostos-de-identifica%C3%A7%C3%A3o" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="tendências-paralelas" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Tendências paralelas<a href="#tend%C3%AAncias-paralelas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O pressuposto central do DiD é o de <strong>tendências paralelas</strong> (parallel trends, PT): na ausência de tratamento, a evolução média dos resultados teria sido a mesma nos dois grupos.</p>
<p><span class="math display">\[
\mathbb{E}[Y_{i2}(0) - Y_{i1}(0) \mid D_i = 1] = \mathbb{E}[Y_{i2}(0) - Y_{i1}(0) \mid D_i = 0]
\]</span></p>
<p>Note que o lado esquerdo envolve um contrafactual — o que <em>teria acontecido</em> com os tratados sem tratamento — e portanto não é diretamente testável. Podemos verificar se as tendências foram paralelas no período <em>pré</em>-tratamento (o que é necessário mas não suficiente), mas não podemos verificar se continuariam paralelas no período pós.</p>
</div>
<div id="equivalência-entre-pt-e-twfe" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Equivalência entre PT e TWFE<a href="#equival%C3%AAncia-entre-pt-e-twfe" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Uma forma paramétrica equivalente é supor que os resultados potenciais sem tratamento seguem um modelo de efeitos fixos duplos:</p>
<p><span class="math display">\[
Y_{it}(0) = \alpha_i + \lambda_t + \varepsilon_{it}, \quad \text{com } \mathbb{E}[\varepsilon_{it}] = 0
\]</span></p>
<p><strong>Proposição.</strong> O modelo TWFE implica tendências paralelas, e vice-versa.</p>
<p><em>Prova (TWFE <span class="math inline">\(\Rightarrow\)</span> PT).</em> Se <span class="math inline">\(Y_{it}(0) = \alpha_i + \lambda_t + \varepsilon_{it}\)</span>, então:</p>
<p><span class="math display">\[
\mathbb{E}[Y_{i2}(0) - Y_{i1}(0) \mid D_i = d] = (\alpha_i + \lambda_2) - (\alpha_i + \lambda_1) = \lambda_2 - \lambda_1
\]</span></p>
<p>para <span class="math inline">\(d \in \{0, 1\}\)</span>. Como a diferença <span class="math inline">\(\lambda_2 - \lambda_1\)</span> não depende de <span class="math inline">\(d\)</span>, PT é satisfeita. <span class="math inline">\(\square\)</span></p>
<p><em>Prova (PT <span class="math inline">\(\Rightarrow\)</span> TWFE).</em> Defina <span class="math inline">\(\lambda_1 \equiv 0\)</span> (normalização) e <span class="math inline">\(\alpha_i \equiv \mathbb{E}[Y_{i1}(0)]\)</span>. Para qualquer <span class="math inline">\(t\)</span>, defina:</p>
<p><span class="math display">\[
\lambda_t \equiv \mathbb{E}[Y_{i^*t}(0) - Y_{i^*1}(0)]
\]</span></p>
<p>onde <span class="math inline">\(i^*\)</span> é uma unidade de referência arbitrária (por exemplo, do grupo controle). Pela suposição de PT, <span class="math inline">\(\mathbb{E}[Y_{it}(0) - Y_{i1}(0)]\)</span> é igual para todas as unidades, então:</p>
<p><span class="math display">\[
\mathbb{E}[Y_{it}(0)] = \mathbb{E}[Y_{i1}(0)] + \lambda_t = \alpha_i + \lambda_t
\]</span></p>
<p>Definindo <span class="math inline">\(\varepsilon_{it} = Y_{it}(0) - \alpha_i - \lambda_t\)</span>, temos <span class="math inline">\(\mathbb{E}[\varepsilon_{it}] = 0\)</span> por construção. <span class="math inline">\(\square\)</span></p>
</div>
<div id="não-antecipação" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Não-antecipação<a href="#n%C3%A3o-antecipa%C3%A7%C3%A3o" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O segundo pressuposto é de <strong>não-antecipação</strong>: o tratamento não tem efeito antes de ser implementado.</p>
<p><span class="math display">\[
\mathbb{E}[Y_{i1}(0)] = \mathbb{E}[Y_{i1}(1)] \quad \forall i
\]</span></p>
<p>Isso exclui, por exemplo, que a mera expectativa de um programa futuro altere o comportamento das unidades tratadas antes do programa começar. Em muitas aplicações em ciência política, esse pressuposto é plausível quando a intervenção é inesperada ou quando não há incentivo para reagir antecipadamente.</p>
</div>
<div id="dag-para-did" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> DAG para DiD<a href="diferença-em-diferenças.html#dag-para-did" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Podemos representar a estrutura causal do DiD com um DAG. O tratamento <span class="math inline">\(D\)</span> é determinado pelo grupo, e o efeito causal é bloqueado se não controlarmos pela tendência temporal. O DiD “controla” pela tendência comum ao tomar a diferença dupla.</p>
<div class="figure"><span style="display:block;" id="fig:dag-did"></span>
<img src="bookdownproj_files/figure-html/dag-did-1.png" alt="DAG simplificado para DiD. O efeito causal de D sobre Y é confundido pela tendência temporal λ e pelas diferenças de nível α. O DiD elimina ambos ao tomar a diferença dupla." width="672" />
<p class="caption">
Figure 8.1: DAG simplificado para DiD. O efeito causal de D sobre Y é confundido pela tendência temporal λ e pelas diferenças de nível α. O DiD elimina ambos ao tomar a diferença dupla.
</p>
</div>
<p>O confundidor <span class="math inline">\(\alpha\)</span> (diferença de nível entre grupos) é eliminado pela diferença temporal; o confundidor <span class="math inline">\(\lambda\)</span> (tendência temporal comum) é eliminado pela diferença entre grupos. A dupla diferença remove ambos.</p>
</div>
</div>
<div id="estimação-por-twfe" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Estimação por TWFE<a href="#estima%C3%A7%C3%A3o-por-twfe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>No caso 2$$2, o DiD pode ser estimado por regressão de duas formas equivalentes.</p>
<p><strong>Parametrização por interação:</strong></p>
<p><span class="math display">\[
Y_{it} = \beta_0 + \beta_1 \text{Post}_t + \beta_2 \text{Treat}_i + \tau (\text{Post}_t \times \text{Treat}_i) + \varepsilon_{it}
\]</span></p>
<p>onde <span class="math inline">\(\text{Post}_t = \mathbb{1}[t = 2]\)</span> e <span class="math inline">\(\text{Treat}_i = D_i\)</span>.</p>
<p><strong>Parametrização por efeitos fixos (TWFE):</strong></p>
<p><span class="math display">\[
Y_{it} = \alpha_i + \lambda_t + \tau D_{it} + \varepsilon_{it}
\]</span></p>
<p>onde <span class="math inline">\(D_{it} = D_i \cdot \mathbb{1}[t = 2]\)</span> é o indicador de tratamento efetivo.</p>
<p>No caso 2$$2, as duas parametrizações produzem estimativas idênticas de <span class="math inline">\(\hat{\tau}\)</span>. A segunda é chamada <em>two-way fixed effects</em> (TWFE) porque inclui efeitos fixos de unidade (<span class="math inline">\(\alpha_i\)</span>) e de tempo (<span class="math inline">\(\lambda_t\)</span>).</p>
<p><strong>Importante:</strong> no caso 2$$2, o TWFE é inofensivo — ele recupera exatamente o ATT. Os problemas surgem quando o tratamento é adotado em momentos diferentes por diferentes unidades (<em>staggered treatment</em>), como veremos na seção 7.</p>
</div>
<div id="aplicação-1-obra-transparente" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Aplicação 1: Obra Transparente<a href="#aplica%C3%A7%C3%A3o-1-obra-transparente" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Vamos aplicar o DiD a dados reais brasileiros. Os dados são do projeto Obra Transparente, da Transparência Brasil. O projeto consistiu em uma intervenção em 20 cidades do Sudeste, na qual treinamento e informações foram fornecidos a ONGs locais para monitoramento de obras de creches e escolas financiadas pelo FNDE. O projeto começou em maio de 2017 e terminou em junho de 2019. O grupo controle inclui cidades com obras similares nos mesmos estados, mas sem a intervenção.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="diferença-em-diferenças.html#cb114-1" tabindex="-1"></a><span class="fu">library</span>(here, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb114-2"><a href="diferença-em-diferenças.html#cb114-2" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb114-3"><a href="diferença-em-diferenças.html#cb114-3" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb114-4"><a href="diferença-em-diferenças.html#cb114-4" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb114-5"><a href="diferença-em-diferenças.html#cb114-5" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb114-6"><a href="diferença-em-diferenças.html#cb114-6" tabindex="-1"></a><span class="fu">library</span>(estimatr)</span>
<span id="cb114-7"><a href="diferença-em-diferenças.html#cb114-7" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb114-8"><a href="diferença-em-diferenças.html#cb114-8" tabindex="-1"></a></span>
<span id="cb114-9"><a href="diferença-em-diferenças.html#cb114-9" tabindex="-1"></a>data_ot <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">&quot;Dados&quot;</span>, <span class="st">&quot;obra_transparente.RDS&quot;</span>))</span>
<span id="cb114-10"><a href="diferença-em-diferenças.html#cb114-10" tabindex="-1"></a><span class="fu">head</span>(data_ot) <span class="sc">%&gt;%</span></span>
<span id="cb114-11"><a href="diferença-em-diferenças.html#cb114-11" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;Primeiras linhas dos dados Obra Transparente&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:ot-import">Table 8.3: </span>Primeiras linhas dos dados Obra Transparente</caption>
<colgroup>
<col width="6%" />
<col width="15%" />
<col width="3%" />
<col width="12%" />
<col width="18%" />
<col width="10%" />
<col width="18%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="left">municipio</th>
<th align="left">uf</th>
<th align="right">concluida</th>
<th align="right">group_treated</th>
<th align="right">periodo</th>
<th align="right">time_treated1</th>
<th align="right">post_treat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1366</td>
<td align="left">Conchas</td>
<td align="left">SP</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1367</td>
<td align="left">Itararé</td>
<td align="left">SP</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1391</td>
<td align="left">Brotas</td>
<td align="left">SP</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1392</td>
<td align="left">Buritizal</td>
<td align="left">SP</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1393</td>
<td align="left">Caconde</td>
<td align="left">SP</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1400</td>
<td align="left">Porteirinha</td>
<td align="left">MG</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>O gráfico abaixo mostra a evolução da taxa de conclusão de obras por grupo. Apesar da diferença de nível (o controle tem taxa mais elevada), as tendências pré-tratamento são aproximadamente paralelas, o que sustenta a plausibilidade do pressuposto de PT.</p>
<div class="figure"><span style="display:block;" id="fig:ot-tendencias"></span>
<img src="bookdownproj_files/figure-html/ot-tendencias-1.png" alt="Evolução da taxa de conclusão de obras por grupo. Linha vertical indica o início do tratamento (período 4)." width="672" />
<p class="caption">
Figure 8.2: Evolução da taxa de conclusão de obras por grupo. Linha vertical indica o início do tratamento (período 4).
</p>
</div>
<p>A partir do período 4, o tratamento poderia começar a fazer efeito, mas a mudança é sutil. O efeito torna-se visível a partir do período 5, sugerindo efeitos dinâmicos. Estimemos inicialmente um modelo estático, comparando apenas os períodos 1 (pré) e 5 (pós).</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="diferença-em-diferenças.html#cb115-1" tabindex="-1"></a>data_ot_reg <span class="ot">&lt;-</span> data_ot <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="diferença-em-diferenças.html#cb115-2" tabindex="-1"></a>  <span class="fu">filter</span>(periodo <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="diferença-em-diferenças.html#cb115-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> <span class="fu">ifelse</span>(periodo <span class="sc">==</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb115-4"><a href="diferença-em-diferenças.html#cb115-4" tabindex="-1"></a></span>
<span id="cb115-5"><a href="diferença-em-diferenças.html#cb115-5" tabindex="-1"></a><span class="co"># Parametrização por interação</span></span>
<span id="cb115-6"><a href="diferença-em-diferenças.html#cb115-6" tabindex="-1"></a>did_interacao <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(concluida <span class="sc">~</span> post <span class="sc">+</span> group_treated <span class="sc">+</span> post<span class="sc">:</span>group_treated,</span>
<span id="cb115-7"><a href="diferença-em-diferenças.html#cb115-7" tabindex="-1"></a>                           <span class="at">data =</span> data_ot_reg, <span class="at">clusters =</span> municipio)</span>
<span id="cb115-8"><a href="diferença-em-diferenças.html#cb115-8" tabindex="-1"></a></span>
<span id="cb115-9"><a href="diferença-em-diferenças.html#cb115-9" tabindex="-1"></a><span class="co"># Parametrização TWFE</span></span>
<span id="cb115-10"><a href="diferença-em-diferenças.html#cb115-10" tabindex="-1"></a>did_twfe <span class="ot">&lt;-</span> <span class="fu">feols</span>(concluida <span class="sc">~</span> post_treat <span class="sc">|</span> municipio <span class="sc">+</span> periodo,</span>
<span id="cb115-11"><a href="diferença-em-diferenças.html#cb115-11" tabindex="-1"></a>                  <span class="at">cluster =</span> <span class="st">&quot;municipio&quot;</span>, <span class="at">data =</span> data_ot_reg)</span>
<span id="cb115-12"><a href="diferença-em-diferenças.html#cb115-12" tabindex="-1"></a></span>
<span id="cb115-13"><a href="diferença-em-diferenças.html#cb115-13" tabindex="-1"></a><span class="fu">msummary</span>(<span class="fu">list</span>(<span class="st">&quot;Interação&quot;</span> <span class="ot">=</span> did_interacao, <span class="st">&quot;TWFE&quot;</span> <span class="ot">=</span> did_twfe),</span>
<span id="cb115-14"><a href="diferença-em-diferenças.html#cb115-14" tabindex="-1"></a>         <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">&#39;*&#39;</span> <span class="ot">=</span> .<span class="dv">1</span>, <span class="st">&#39;**&#39;</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">&#39;***&#39;</span> <span class="ot">=</span> .<span class="dv">01</span>),</span>
<span id="cb115-15"><a href="diferença-em-diferenças.html#cb115-15" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;DiD estático — Obra Transparente (períodos 1 vs. 5)&quot;</span>)</span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_u54u0e0nvlmv3mcqnajp(i, j, css_id) {
          var table = document.getElementById("tinytable_u54u0e0nvlmv3mcqnajp");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_u54u0e0nvlmv3mcqnajp');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_u54u0e0nvlmv3mcqnajp(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_u54u0e0nvlmv3mcqnajp");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 21, j: 1 }, { i: 21, j: 2 },  ], css_id: 'tinytable_css_83y0azwaq1kosw772g9g',}, 
          { positions: [ { i: 10, j: 2 }, { i: 10, j: 1 },  ], css_id: 'tinytable_css_sn4wt5ll3o1wjtnt3dxi',}, 
          { positions: [ { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 1, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 5, j: 1 }, { i: 1, j: 2 }, { i: 11, j: 1 }, { i: 12, j: 1 }, { i: 13, j: 1 }, { i: 14, j: 1 }, { i: 15, j: 1 }, { i: 16, j: 1 }, { i: 17, j: 1 }, { i: 18, j: 1 }, { i: 19, j: 1 }, { i: 20, j: 1 }, { i: 12, j: 2 }, { i: 9, j: 1 }, { i: 14, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 18, j: 2 }, { i: 11, j: 2 }, { i: 16, j: 2 }, { i: 13, j: 2 }, { i: 15, j: 2 }, { i: 20, j: 2 }, { i: 17, j: 2 }, { i: 19, j: 2 },  ], css_id: 'tinytable_css_shsz39eaqgv3b76e8r8j',}, 
          { positions: [ { i: 0, j: 1 }, { i: 0, j: 2 },  ], css_id: 'tinytable_css_y7cl39wqj5ihl6uljuee',}, 
          { positions: [ { i: 21, j: 0 },  ], css_id: 'tinytable_css_sjztzirheanz7xcfycup',}, 
          { positions: [ { i: 10, j: 0 },  ], css_id: 'tinytable_css_6hbkq0v7927dzdnq8b9d',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 9, j: 0 }, { i: 14, j: 0 }, { i: 11, j: 0 }, { i: 12, j: 0 }, { i: 13, j: 0 }, { i: 18, j: 0 }, { i: 15, j: 0 }, { i: 16, j: 0 }, { i: 17, j: 0 }, { i: 19, j: 0 }, { i: 20, j: 0 },  ], css_id: 'tinytable_css_88tt0mwaj59p76ewsjxe',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_9yc4qux24a3bl91gv7ck',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_u54u0e0nvlmv3mcqnajp(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_83y0azwaq1kosw772g9g, .table th.tinytable_css_83y0azwaq1kosw772g9g { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_sn4wt5ll3o1wjtnt3dxi, .table th.tinytable_css_sn4wt5ll3o1wjtnt3dxi { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_shsz39eaqgv3b76e8r8j, .table th.tinytable_css_shsz39eaqgv3b76e8r8j { text-align: center; }
      .table td.tinytable_css_y7cl39wqj5ihl6uljuee, .table th.tinytable_css_y7cl39wqj5ihl6uljuee { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_sjztzirheanz7xcfycup, .table th.tinytable_css_sjztzirheanz7xcfycup { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_6hbkq0v7927dzdnq8b9d, .table th.tinytable_css_6hbkq0v7927dzdnq8b9d { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_88tt0mwaj59p76ewsjxe, .table th.tinytable_css_88tt0mwaj59p76ewsjxe { text-align: left; }
      .table td.tinytable_css_9yc4qux24a3bl91gv7ck, .table th.tinytable_css_9yc4qux24a3bl91gv7ck { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_u54u0e0nvlmv3mcqnajp" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing='true'>
        <thead>
        <caption>DiD estático — Obra Transparente (períodos 1 vs. 5)</caption>
              <tr>
                <th scope="col"> </th>
                <th scope="col">Interação</th>
                <th scope="col">TWFE</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan='3'>* p < 0.1, ** p < 0.05, *** p < 0.01</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>(Intercept)</td>
                  <td>0.382***</td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>(0.014)</td>
                  <td></td>
                </tr>
                <tr>
                  <td>post</td>
                  <td>0.481***</td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>(0.010)</td>
                  <td></td>
                </tr>
                <tr>
                  <td>group_treated</td>
                  <td>-0.224***</td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>(0.057)</td>
                  <td></td>
                </tr>
                <tr>
                  <td>post × group_treated</td>
                  <td>0.155**</td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>(0.062)</td>
                  <td></td>
                </tr>
                <tr>
                  <td>post_treat</td>
                  <td></td>
                  <td>0.154***</td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td>(0.059)</td>
                </tr>
                <tr>
                  <td>Num.Obs.</td>
                  <td>9020</td>
                  <td>9020</td>
                </tr>
                <tr>
                  <td>R2</td>
                  <td>0.258</td>
                  <td>0.517</td>
                </tr>
                <tr>
                  <td>R2 Adj.</td>
                  <td>0.258</td>
                  <td>0.377</td>
                </tr>
                <tr>
                  <td>R2 Within</td>
                  <td></td>
                  <td>0.002</td>
                </tr>
                <tr>
                  <td>R2 Within Adj.</td>
                  <td></td>
                  <td>0.002</td>
                </tr>
                <tr>
                  <td>AIC</td>
                  <td>9911.2</td>
                  <td>10082.1</td>
                </tr>
                <tr>
                  <td>BIC</td>
                  <td>9946.8</td>
                  <td>24452.8</td>
                </tr>
                <tr>
                  <td>RMSE</td>
                  <td>0.42</td>
                  <td>0.34</td>
                </tr>
                <tr>
                  <td>Std.Errors</td>
                  <td>by: municipio</td>
                  <td>by: municipio</td>
                </tr>
                <tr>
                  <td>FE: municipio</td>
                  <td></td>
                  <td>X</td>
                </tr>
                <tr>
                  <td>FE: periodo</td>
                  <td></td>
                  <td>X</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
<p>O coeficiente de interação (ou <code>post_treat</code> no TWFE) estima o ATT. Ambas as especificações produzem a mesma estimativa pontual, como esperado no caso 2$$2.</p>
</div>
<div id="did-dinâmico-e-event-study" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> DiD dinâmico e event study<a href="#did-din%C3%A2mico-e-event-study" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Na prática, raramente temos apenas dois períodos. Com múltiplos períodos, podemos estimar um <strong>event study</strong> (estudo de evento) que mostra a dinâmica do efeito ao longo do tempo. A especificação é:</p>
<p><span class="math display">\[
Y_{it} = \alpha_i + \lambda_t + \sum_{k \neq -1} \delta_k \cdot \mathbb{1}[t - G_i = k] + \varepsilon_{it}
\]</span></p>
<p>onde <span class="math inline">\(G_i\)</span> é o período em que a unidade <span class="math inline">\(i\)</span> é primeiro tratada (com <span class="math inline">\(G_i = \infty\)</span> para nunca-tratados), e <span class="math inline">\(k\)</span> mede a distância ao tratamento (tempo relativo). O período <span class="math inline">\(k = -1\)</span> (um antes do tratamento) é a categoria de referência.</p>
<p>Os coeficientes <span class="math inline">\(\delta_k\)</span> têm interpretação direta:</p>
<ul>
<li>Para <span class="math inline">\(k &lt; -1\)</span> (pré-tratamento): se as tendências são paralelas, devemos ter <span class="math inline">\(\delta_k \approx 0\)</span>. Esses coeficientes servem como <strong>diagnóstico</strong> (mas não teste definitivo) de PT.</li>
<li>Para <span class="math inline">\(k \geq 0\)</span> (pós-tratamento): <span class="math inline">\(\delta_k\)</span> estima o efeito do tratamento <span class="math inline">\(k\)</span> períodos após a adoção.</li>
</ul>
<p>Apliquemos aos dados Obra Transparente. O tratamento começa no período 4, então usamos o período 3 como referência:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="diferença-em-diferenças.html#cb116-1" tabindex="-1"></a>did_es <span class="ot">&lt;-</span> <span class="fu">feols</span>(concluida <span class="sc">~</span> <span class="fu">i</span>(periodo, group_treated, <span class="at">ref =</span> <span class="dv">3</span>) <span class="sc">|</span> id <span class="sc">+</span> periodo,</span>
<span id="cb116-2"><a href="diferença-em-diferenças.html#cb116-2" tabindex="-1"></a>                <span class="at">data =</span> data_ot)</span>
<span id="cb116-3"><a href="diferença-em-diferenças.html#cb116-3" tabindex="-1"></a></span>
<span id="cb116-4"><a href="diferença-em-diferenças.html#cb116-4" tabindex="-1"></a><span class="fu">summary</span>(did_es)</span></code></pre></div>
<pre><code>## OLS estimation, Dep. Var.: concluida
## Observations: 22,609
## Fixed-effects: id: 4,530,  periodo: 5
## Standard-errors: Clustered (id) 
##                           Estimate Std. Error   t value   Pr(&gt;|t|)    
## periodo::1:group_treated -0.009828   0.028085 -0.349923 7.2641e-01    
## periodo::2:group_treated -0.004025   0.018226 -0.220847 8.2522e-01    
## periodo::4:group_treated  0.022207   0.015355  1.446207 1.4819e-01    
## periodo::5:group_treated  0.143744   0.033830  4.249033 2.1901e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## RMSE: 0.247446     Adj. R2: 0.685451
##                  Within R2: 0.002541</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="diferença-em-diferenças.html#cb118-1" tabindex="-1"></a><span class="fu">iplot</span>(did_es,</span>
<span id="cb118-2"><a href="diferença-em-diferenças.html#cb118-2" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;Período (ref = 3)&quot;</span>,</span>
<span id="cb118-3"><a href="diferença-em-diferenças.html#cb118-3" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Efeito estimado&quot;</span>,</span>
<span id="cb118-4"><a href="diferença-em-diferenças.html#cb118-4" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Event study — Obra Transparente&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ot-event-study"></span>
<img src="bookdownproj_files/figure-html/ot-event-study-1.png" alt="Event study — Obra Transparente. Coeficientes pré-tratamento próximos de zero sustentam a hipótese de tendências paralelas." width="672" />
<p class="caption">
Figure 8.3: Event study — Obra Transparente. Coeficientes pré-tratamento próximos de zero sustentam a hipótese de tendências paralelas.
</p>
</div>
<p>Os coeficientes pré-tratamento (períodos 1 e 2) são próximos de zero e estatisticamente insignificantes, o que é consistente com tendências paralelas. Os coeficientes pós-tratamento mostram um efeito crescente, com o efeito se tornando significativo nos períodos finais.</p>
</div>
<div id="o-problema-do-twfe-com-tratamento-escalonado" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> O problema do TWFE com tratamento escalonado<a href="diferença-em-diferenças.html#o-problema-do-twfe-com-tratamento-escalonado" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Até aqui, trabalhamos com cenários em que todas as unidades tratadas recebem o tratamento ao mesmo tempo. Contudo, em muitas aplicações, o tratamento é adotado em momentos diferentes (<em>staggered adoption</em>). Exemplos em ciência política incluem a adoção escalonada de biometria eleitoral, leis de transparência pública, ou reformas educacionais por diferentes estados.</p>
<p>Nesta seção, mostramos que o estimador TWFE pode produzir resultados enviesados — e até com sinal trocado — quando o tratamento é escalonado e os efeitos são heterogêneos.</p>
<div id="o-que-pode-dar-errado" class="section level3 hasAnchor" number="8.7.1">
<h3><span class="header-section-number">8.7.1</span> O que pode dar errado<a href="diferença-em-diferenças.html#o-que-pode-dar-errado" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Considere três grupos de unidades: o grupo A (tratado no período 3), o grupo B (tratado no período 6), e o grupo C (nunca tratado). O TWFE com efeitos fixos de unidade e tempo estima um coeficiente único <span class="math inline">\(\hat{\tau}\)</span> como uma média ponderada de todas as comparações 2$$2 possíveis. Crucialmente, algumas dessas comparações usam unidades <strong>já tratadas</strong> como “controle” — por exemplo, ao estimar o efeito para o grupo B (tratado no período 6), o TWFE pode usar o grupo A (já tratado desde o período 3) como controle.</p>
<p>Se o efeito do tratamento varia ao longo do tempo ou entre grupos, essas comparações “proibidas” introduzem viés. Em casos extremos, os pesos de algumas comparações podem ser <strong>negativos</strong>, fazendo com que <span class="math inline">\(\hat{\tau}\)</span> tenha sinal oposto ao verdadeiro efeito causal.</p>
</div>
<div id="decomposição-de-goodman-bacon-simulação" class="section level3 hasAnchor" number="8.7.2">
<h3><span class="header-section-number">8.7.2</span> Decomposição de Goodman-Bacon — simulação<a href="#decomposi%C3%A7%C3%A3o-de-goodman-bacon-simula%C3%A7%C3%A3o" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Goodman-Bacon (2021) mostrou que o estimador TWFE com tratamento escalonado é uma média ponderada de todos os estimadores DiD 2$$2 possíveis, com pesos que dependem do tamanho dos grupos e da variância do tratamento. Vamos demonstrar isso com uma simulação.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="diferença-em-diferenças.html#cb119-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb119-2"><a href="diferença-em-diferenças.html#cb119-2" tabindex="-1"></a></span>
<span id="cb119-3"><a href="diferença-em-diferenças.html#cb119-3" tabindex="-1"></a><span class="co"># Parâmetros</span></span>
<span id="cb119-4"><a href="diferença-em-diferenças.html#cb119-4" tabindex="-1"></a>n_units <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb119-5"><a href="diferença-em-diferenças.html#cb119-5" tabindex="-1"></a>n_periods <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb119-6"><a href="diferença-em-diferenças.html#cb119-6" tabindex="-1"></a>n_per_group <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb119-7"><a href="diferença-em-diferenças.html#cb119-7" tabindex="-1"></a></span>
<span id="cb119-8"><a href="diferença-em-diferenças.html#cb119-8" tabindex="-1"></a><span class="co"># Criar dados</span></span>
<span id="cb119-9"><a href="diferença-em-diferenças.html#cb119-9" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>n_units, <span class="at">t =</span> <span class="dv">1</span><span class="sc">:</span>n_periods)</span>
<span id="cb119-10"><a href="diferença-em-diferenças.html#cb119-10" tabindex="-1"></a></span>
<span id="cb119-11"><a href="diferença-em-diferenças.html#cb119-11" tabindex="-1"></a><span class="co"># Atribuir grupos: A (tratado em t=3), B (tratado em t=6), C (nunca tratado)</span></span>
<span id="cb119-12"><a href="diferença-em-diferenças.html#cb119-12" tabindex="-1"></a>sim_data<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sim_data<span class="sc">$</span>i <span class="sc">&lt;=</span> n_per_group, <span class="st">&quot;A&quot;</span>,</span>
<span id="cb119-13"><a href="diferença-em-diferenças.html#cb119-13" tabindex="-1"></a>                  <span class="fu">ifelse</span>(sim_data<span class="sc">$</span>i <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">*</span> n_per_group, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>))</span>
<span id="cb119-14"><a href="diferença-em-diferenças.html#cb119-14" tabindex="-1"></a>sim_data<span class="sc">$</span>G_i <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sim_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="dv">3</span>,</span>
<span id="cb119-15"><a href="diferença-em-diferenças.html#cb119-15" tabindex="-1"></a>                <span class="fu">ifelse</span>(sim_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">&quot;B&quot;</span>, <span class="dv">6</span>, <span class="cn">Inf</span>))</span>
<span id="cb119-16"><a href="diferença-em-diferenças.html#cb119-16" tabindex="-1"></a></span>
<span id="cb119-17"><a href="diferença-em-diferenças.html#cb119-17" tabindex="-1"></a><span class="co"># Tratamento: D_it = 1 se t &gt;= G_i</span></span>
<span id="cb119-18"><a href="diferença-em-diferenças.html#cb119-18" tabindex="-1"></a>sim_data<span class="sc">$</span>D_it <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(sim_data<span class="sc">$</span>t <span class="sc">&gt;=</span> sim_data<span class="sc">$</span>G_i)</span>
<span id="cb119-19"><a href="diferença-em-diferenças.html#cb119-19" tabindex="-1"></a></span>
<span id="cb119-20"><a href="diferença-em-diferenças.html#cb119-20" tabindex="-1"></a><span class="co"># Efeito fixo de unidade</span></span>
<span id="cb119-21"><a href="diferença-em-diferenças.html#cb119-21" tabindex="-1"></a>alpha_i <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_units, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb119-22"><a href="diferença-em-diferenças.html#cb119-22" tabindex="-1"></a>sim_data<span class="sc">$</span>alpha <span class="ot">&lt;-</span> alpha_i[sim_data<span class="sc">$</span>i]</span>
<span id="cb119-23"><a href="diferença-em-diferenças.html#cb119-23" tabindex="-1"></a></span>
<span id="cb119-24"><a href="diferença-em-diferenças.html#cb119-24" tabindex="-1"></a><span class="co"># Efeito fixo de tempo</span></span>
<span id="cb119-25"><a href="diferença-em-diferenças.html#cb119-25" tabindex="-1"></a>lambda_t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">4.5</span>, <span class="at">length.out =</span> n_periods)</span>
<span id="cb119-26"><a href="diferença-em-diferenças.html#cb119-26" tabindex="-1"></a>sim_data<span class="sc">$</span>lambda <span class="ot">&lt;-</span> lambda_t[sim_data<span class="sc">$</span>t]</span>
<span id="cb119-27"><a href="diferença-em-diferenças.html#cb119-27" tabindex="-1"></a></span>
<span id="cb119-28"><a href="diferença-em-diferenças.html#cb119-28" tabindex="-1"></a><span class="co"># Efeito causal HETEROGÊNEO: cresce com a duração do tratamento</span></span>
<span id="cb119-29"><a href="diferença-em-diferenças.html#cb119-29" tabindex="-1"></a><span class="co"># Grupo A: efeito de 2 por período de exposição</span></span>
<span id="cb119-30"><a href="diferença-em-diferenças.html#cb119-30" tabindex="-1"></a><span class="co"># Grupo B: efeito de 5 por período de exposição</span></span>
<span id="cb119-31"><a href="diferença-em-diferenças.html#cb119-31" tabindex="-1"></a>sim_data<span class="sc">$</span>tau_true <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(sim_data<span class="sc">$</span>D_it <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb119-32"><a href="diferença-em-diferenças.html#cb119-32" tabindex="-1"></a>                     <span class="fu">ifelse</span>(sim_data<span class="sc">$</span>group <span class="sc">==</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb119-33"><a href="diferença-em-diferenças.html#cb119-33" tabindex="-1"></a>                            <span class="dv">2</span> <span class="sc">*</span> (sim_data<span class="sc">$</span>t <span class="sc">-</span> sim_data<span class="sc">$</span>G_i <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb119-34"><a href="diferença-em-diferenças.html#cb119-34" tabindex="-1"></a>                            <span class="dv">5</span> <span class="sc">*</span> (sim_data<span class="sc">$</span>t <span class="sc">-</span> sim_data<span class="sc">$</span>G_i <span class="sc">+</span> <span class="dv">1</span>)))</span>
<span id="cb119-35"><a href="diferença-em-diferenças.html#cb119-35" tabindex="-1"></a></span>
<span id="cb119-36"><a href="diferença-em-diferenças.html#cb119-36" tabindex="-1"></a><span class="co"># Resultado observado</span></span>
<span id="cb119-37"><a href="diferença-em-diferenças.html#cb119-37" tabindex="-1"></a>sim_data<span class="sc">$</span>Y <span class="ot">&lt;-</span> sim_data<span class="sc">$</span>alpha <span class="sc">+</span> sim_data<span class="sc">$</span>lambda <span class="sc">+</span> sim_data<span class="sc">$</span>tau_true <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(sim_data))</span>
<span id="cb119-38"><a href="diferença-em-diferenças.html#cb119-38" tabindex="-1"></a></span>
<span id="cb119-39"><a href="diferença-em-diferenças.html#cb119-39" tabindex="-1"></a><span class="co"># ATT verdadeiro (média dos efeitos causais entre os tratados)</span></span>
<span id="cb119-40"><a href="diferença-em-diferenças.html#cb119-40" tabindex="-1"></a>att_verdadeiro <span class="ot">&lt;-</span> <span class="fu">mean</span>(sim_data<span class="sc">$</span>tau_true[sim_data<span class="sc">$</span>D_it <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb119-41"><a href="diferença-em-diferenças.html#cb119-41" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ATT verdadeiro:&quot;</span>, <span class="fu">round</span>(att_verdadeiro, <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ATT verdadeiro: 11.31</code></pre>
<p>Agora estimamos o TWFE e comparamos com o ATT verdadeiro:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="diferença-em-diferenças.html#cb121-1" tabindex="-1"></a><span class="co"># TWFE padrão</span></span>
<span id="cb121-2"><a href="diferença-em-diferenças.html#cb121-2" tabindex="-1"></a>twfe_stag <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> D_it <span class="sc">|</span> i <span class="sc">+</span> t, <span class="at">data =</span> sim_data)</span>
<span id="cb121-3"><a href="diferença-em-diferenças.html#cb121-3" tabindex="-1"></a></span>
<span id="cb121-4"><a href="diferença-em-diferenças.html#cb121-4" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;TWFE estimado:&quot;</span>, <span class="fu">round</span>(<span class="fu">coef</span>(twfe_stag)[<span class="st">&quot;D_it&quot;</span>], <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## TWFE estimado: 10.48</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="diferença-em-diferenças.html#cb123-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;ATT verdadeiro:&quot;</span>, <span class="fu">round</span>(att_verdadeiro, <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ATT verdadeiro: 11.31</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="diferença-em-diferenças.html#cb125-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Viés:&quot;</span>, <span class="fu">round</span>(<span class="fu">coef</span>(twfe_stag)[<span class="st">&quot;D_it&quot;</span>] <span class="sc">-</span> att_verdadeiro, <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Viés: -0.82</code></pre>
<p>O TWFE subestima o ATT verdadeiro. Para entender por quê, vamos decompor manualmente as comparações 2$$2 que o TWFE combina.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="diferença-em-diferenças.html#cb127-1" tabindex="-1"></a><span class="co"># Função auxiliar para DiD 2x2</span></span>
<span id="cb127-2"><a href="diferença-em-diferenças.html#cb127-2" tabindex="-1"></a>did_2x2 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, treat_group, control_group, pre_periods, post_periods) {</span>
<span id="cb127-3"><a href="diferença-em-diferenças.html#cb127-3" tabindex="-1"></a>  d <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb127-4"><a href="diferença-em-diferenças.html#cb127-4" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(treat_group, control_group),</span>
<span id="cb127-5"><a href="diferença-em-diferenças.html#cb127-5" tabindex="-1"></a>           t <span class="sc">%in%</span> <span class="fu">c</span>(pre_periods, post_periods)) <span class="sc">%&gt;%</span></span>
<span id="cb127-6"><a href="diferença-em-diferenças.html#cb127-6" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">post =</span> <span class="fu">as.integer</span>(t <span class="sc">%in%</span> post_periods),</span>
<span id="cb127-7"><a href="diferença-em-diferenças.html#cb127-7" tabindex="-1"></a>           <span class="at">treated =</span> <span class="fu">as.integer</span>(group <span class="sc">==</span> treat_group))</span>
<span id="cb127-8"><a href="diferença-em-diferenças.html#cb127-8" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> post <span class="sc">*</span> treated, <span class="at">data =</span> d)</span>
<span id="cb127-9"><a href="diferença-em-diferenças.html#cb127-9" tabindex="-1"></a>  <span class="fu">coef</span>(fit)[<span class="st">&quot;post:treated&quot;</span>]</span>
<span id="cb127-10"><a href="diferença-em-diferenças.html#cb127-10" tabindex="-1"></a>}</span>
<span id="cb127-11"><a href="diferença-em-diferenças.html#cb127-11" tabindex="-1"></a></span>
<span id="cb127-12"><a href="diferença-em-diferenças.html#cb127-12" tabindex="-1"></a><span class="co"># Comparações possíveis:</span></span>
<span id="cb127-13"><a href="diferença-em-diferenças.html#cb127-13" tabindex="-1"></a><span class="co"># 1. Grupo A (tratado t=3) vs. Grupo C (nunca tratado)</span></span>
<span id="cb127-14"><a href="diferença-em-diferenças.html#cb127-14" tabindex="-1"></a>did_AC <span class="ot">&lt;-</span> <span class="fu">did_2x2</span>(sim_data, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="at">pre_periods =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">post_periods =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb127-15"><a href="diferença-em-diferenças.html#cb127-15" tabindex="-1"></a></span>
<span id="cb127-16"><a href="diferença-em-diferenças.html#cb127-16" tabindex="-1"></a><span class="co"># 2. Grupo B (tratado t=6) vs. Grupo C (nunca tratado)</span></span>
<span id="cb127-17"><a href="diferença-em-diferenças.html#cb127-17" tabindex="-1"></a>did_BC <span class="ot">&lt;-</span> <span class="fu">did_2x2</span>(sim_data, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="at">pre_periods =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">post_periods =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb127-18"><a href="diferença-em-diferenças.html#cb127-18" tabindex="-1"></a></span>
<span id="cb127-19"><a href="diferença-em-diferenças.html#cb127-19" tabindex="-1"></a><span class="co"># 3. Grupo A (early) vs. Grupo B (late) — B como controle, pré t&lt;3</span></span>
<span id="cb127-20"><a href="diferença-em-diferenças.html#cb127-20" tabindex="-1"></a>did_AB_early <span class="ot">&lt;-</span> <span class="fu">did_2x2</span>(sim_data, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="at">pre_periods =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">post_periods =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb127-21"><a href="diferença-em-diferenças.html#cb127-21" tabindex="-1"></a></span>
<span id="cb127-22"><a href="diferença-em-diferenças.html#cb127-22" tabindex="-1"></a><span class="co"># 4. Grupo B (late) vs. Grupo A (early, já tratado!) — A como &quot;controle&quot;</span></span>
<span id="cb127-23"><a href="diferença-em-diferenças.html#cb127-23" tabindex="-1"></a>did_BA_late <span class="ot">&lt;-</span> <span class="fu">did_2x2</span>(sim_data, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="at">pre_periods =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">post_periods =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb127-24"><a href="diferença-em-diferenças.html#cb127-24" tabindex="-1"></a></span>
<span id="cb127-25"><a href="diferença-em-diferenças.html#cb127-25" tabindex="-1"></a>comparacoes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb127-26"><a href="diferença-em-diferenças.html#cb127-26" tabindex="-1"></a>  <span class="at">Comparacao =</span> <span class="fu">c</span>(<span class="st">&quot;A vs. C (nunca tratado)&quot;</span>,</span>
<span id="cb127-27"><a href="diferença-em-diferenças.html#cb127-27" tabindex="-1"></a>                 <span class="st">&quot;B vs. C (nunca tratado)&quot;</span>,</span>
<span id="cb127-28"><a href="diferença-em-diferenças.html#cb127-28" tabindex="-1"></a>                 <span class="st">&quot;A vs. B (B ainda não tratado)&quot;</span>,</span>
<span id="cb127-29"><a href="diferença-em-diferenças.html#cb127-29" tabindex="-1"></a>                 <span class="st">&quot;B vs. A (A já tratado!)&quot;</span>),</span>
<span id="cb127-30"><a href="diferença-em-diferenças.html#cb127-30" tabindex="-1"></a>  <span class="at">DiD_2x2 =</span> <span class="fu">round</span>(<span class="fu">c</span>(did_AC, did_BC, did_AB_early, did_BA_late), <span class="dv">2</span>)</span>
<span id="cb127-31"><a href="diferença-em-diferenças.html#cb127-31" tabindex="-1"></a>)</span>
<span id="cb127-32"><a href="diferença-em-diferenças.html#cb127-32" tabindex="-1"></a></span>
<span id="cb127-33"><a href="diferença-em-diferenças.html#cb127-33" tabindex="-1"></a><span class="fu">kable</span>(comparacoes, <span class="at">caption =</span> <span class="st">&quot;Decomposição das comparações 2×2 no TWFE&quot;</span>,</span>
<span id="cb127-34"><a href="diferença-em-diferenças.html#cb127-34" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Comparação&quot;</span>, <span class="st">&quot;Estimativa DiD 2×2&quot;</span>))</span></code></pre></div>
<table>
<caption><span id="tab:bacon-decomp-manual">Table 8.4: </span>Decomposição das comparações 2×2 no TWFE</caption>
<thead>
<tr class="header">
<th align="left">Comparação</th>
<th align="right">Estimativa DiD 2×2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A vs. C (nunca tratado)</td>
<td align="right">9.12</td>
</tr>
<tr class="even">
<td align="left">B vs. C (nunca tratado)</td>
<td align="right">15.02</td>
</tr>
<tr class="odd">
<td align="left">A vs. B (B ainda não tratado)</td>
<td align="right">3.94</td>
</tr>
<tr class="even">
<td align="left">B vs. A (A já tratado!)</td>
<td align="right">7.00</td>
</tr>
</tbody>
</table>
<p>A última comparação (B vs. A, com A já tratado) é problemática: o grupo A continua acumulando efeitos do tratamento, então sua trajetória como “controle” viola a lógica do DiD. Se o efeito de A está crescendo, essa comparação subestima o efeito de B.</p>
<div class="figure"><span style="display:block;" id="fig:bacon-grafico"></span>
<img src="bookdownproj_files/figure-html/bacon-grafico-1.png" alt="Médias por grupo ao longo do tempo. As linhas verticais indicam o início do tratamento para cada grupo. Note como o grupo A (já tratado) continua mudando após o período 3 — usá-lo como controle para B é problemático." width="672" />
<p class="caption">
Figure 8.4: Médias por grupo ao longo do tempo. As linhas verticais indicam o início do tratamento para cada grupo. Note como o grupo A (já tratado) continua mudando após o período 3 — usá-lo como controle para B é problemático.
</p>
</div>
<p>Para aplicações reais, o pacote <code>bacondecomp</code> automatiza essa decomposição e produz gráficos de diagnóstico (Goodman-Bacon, 2021). Aqui usamos a simulação para fins pedagógicos.</p>
</div>
<div id="conexão-com-fwl-e-gardner" class="section level3 hasAnchor" number="8.7.3">
<h3><span class="header-section-number">8.7.3</span> Conexão com FWL e Gardner<a href="#conex%C3%A3o-com-fwl-e-gardner" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Há outra forma de entender o problema do TWFE, via o teorema de Frisch-Waugh-Lovell (FWL). O TWFE estima <span class="math inline">\(\hat{\tau}\)</span> como uma regressão de <span class="math inline">\(Y\)</span> sobre <span class="math inline">\(D_{it}\)</span> após remover os efeitos fixos. Pelo FWL, isso equivale a:</p>
<p><strong>Passo 1.</strong> Residualizar <span class="math inline">\(Y\)</span> e <span class="math inline">\(D\)</span> nos efeitos fixos:</p>
<p><span class="math display">\[
\tilde{Y}_{it} = Y_{it} - \hat{\alpha}_i - \hat{\lambda}_t, \qquad \tilde{D}_{it} = D_{it} - \hat{\alpha}^D_i - \hat{\lambda}^D_t
\]</span></p>
<p><strong>Passo 2.</strong> Regredir <span class="math inline">\(\tilde{Y}_{it}\)</span> em <span class="math inline">\(\tilde{D}_{it}\)</span>:</p>
<p><span class="math display">\[
\hat{\tau}^{TWFE} = \frac{\sum_{i,t} \tilde{D}_{it} \tilde{Y}_{it}}{\sum_{i,t} \tilde{D}_{it}^2} = \sum_{i,t} w_{it} \cdot \tau_{it}
\]</span></p>
<p>Os pesos <span class="math inline">\(w_{it}\)</span> dependem de <span class="math inline">\(\tilde{D}_{it}\)</span>. Para unidades tratadas cedo e observadas muito depois do tratamento, <span class="math inline">\(\tilde{D}_{it}\)</span> pode ser <strong>negativo</strong> (porque a média de <span class="math inline">\(D\)</span> para essas unidades é alta, e o resíduo fica negativo). Pesos negativos significam que o TWFE pode dar sinal oposto ao efeito verdadeiro.</p>
<p>A solução proposta por Gardner (2022) é o <strong>DiD em dois estágios</strong>:</p>
<ul>
<li><p><strong>Estágio 1:</strong> Estimar os efeitos fixos <span class="math inline">\(\hat{\alpha}_i\)</span> e <span class="math inline">\(\hat{\lambda}_t\)</span> usando <strong>apenas</strong> observações não tratadas (ou ainda não tratadas). Isso evita que o efeito do tratamento contamine as estimativas dos efeitos fixos.</p></li>
<li><p><strong>Estágio 2:</strong> Regredir <span class="math inline">\(Y_{it} - \hat{\alpha}_i - \hat{\lambda}_t\)</span> em <span class="math inline">\(D_{it}\)</span> para estimar o ATT.</p></li>
</ul>
<p>O pacote <code>did2s</code> implementa esse procedimento com erros-padrão corrigidos para o primeiro estágio.</p>
</div>
</div>
<div id="estimadores-modernos" class="section level2 hasAnchor" number="8.8">
<h2><span class="header-section-number">8.8</span> Estimadores modernos<a href="diferença-em-diferenças.html#estimadores-modernos" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Nesta seção, aplicamos os estimadores modernos ao <strong>mesmo dataset simulado</strong> da seção anterior. Isso permite comparar diretamente cada estimador com o TWFE enviesado e com o ATT verdadeiro.</p>
<div id="callaway-santanna-2021" class="section level3 hasAnchor" number="8.8.1">
<h3><span class="header-section-number">8.8.1</span> Callaway &amp; Sant’Anna (2021)<a href="diferença-em-diferenças.html#callaway-santanna-2021" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Callaway e Sant’Anna (2021) propõem estimar o efeito para cada <strong>grupo-tempo</strong> <span class="math inline">\(ATT(g, t)\)</span>, onde <span class="math inline">\(g\)</span> é o período de primeiro tratamento. A ideia é fazer comparações “limpas”: cada grupo tratado é comparado apenas com unidades nunca tratadas (ou ainda não tratadas).</p>
<p>O parâmetro <span class="math inline">\(ATT(g, t) = \mathbb{E}[Y_{it}(1) - Y_{it}(0) \mid G_i = g]\)</span> é estimado para cada combinação <span class="math inline">\((g, t)\)</span> com <span class="math inline">\(t \geq g\)</span>. Esses efeitos grupo-tempo podem então ser <strong>agregados</strong> de diversas formas: por grupo, por tempo relativo (event study), ou em uma média simples.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="diferença-em-diferenças.html#cb128-1" tabindex="-1"></a><span class="fu">library</span>(did)</span>
<span id="cb128-2"><a href="diferença-em-diferenças.html#cb128-2" tabindex="-1"></a></span>
<span id="cb128-3"><a href="diferença-em-diferenças.html#cb128-3" tabindex="-1"></a><span class="co"># Preparar dados: G_i numérico (Inf -&gt; 0 para nunca tratados no pacote did)</span></span>
<span id="cb128-4"><a href="diferença-em-diferenças.html#cb128-4" tabindex="-1"></a>sim_cs <span class="ot">&lt;-</span> sim_data <span class="sc">%&gt;%</span></span>
<span id="cb128-5"><a href="diferença-em-diferenças.html#cb128-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">G_did =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(G_i), <span class="dv">0</span>, G_i))</span>
<span id="cb128-6"><a href="diferença-em-diferenças.html#cb128-6" tabindex="-1"></a></span>
<span id="cb128-7"><a href="diferença-em-diferenças.html#cb128-7" tabindex="-1"></a><span class="co"># Estimar ATT(g,t)</span></span>
<span id="cb128-8"><a href="diferença-em-diferenças.html#cb128-8" tabindex="-1"></a>cs_out <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb128-9"><a href="diferença-em-diferenças.html#cb128-9" tabindex="-1"></a>                 <span class="at">tname =</span> <span class="st">&quot;t&quot;</span>,</span>
<span id="cb128-10"><a href="diferença-em-diferenças.html#cb128-10" tabindex="-1"></a>                 <span class="at">idname =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb128-11"><a href="diferença-em-diferenças.html#cb128-11" tabindex="-1"></a>                 <span class="at">gname =</span> <span class="st">&quot;G_did&quot;</span>,</span>
<span id="cb128-12"><a href="diferença-em-diferenças.html#cb128-12" tabindex="-1"></a>                 <span class="at">data =</span> sim_cs,</span>
<span id="cb128-13"><a href="diferença-em-diferenças.html#cb128-13" tabindex="-1"></a>                 <span class="at">control_group =</span> <span class="st">&quot;nevertreated&quot;</span>)</span>
<span id="cb128-14"><a href="diferença-em-diferenças.html#cb128-14" tabindex="-1"></a></span>
<span id="cb128-15"><a href="diferença-em-diferenças.html#cb128-15" tabindex="-1"></a><span class="co"># Agregar por tempo relativo (event study)</span></span>
<span id="cb128-16"><a href="diferença-em-diferenças.html#cb128-16" tabindex="-1"></a>cs_es <span class="ot">&lt;-</span> <span class="fu">aggte</span>(cs_out, <span class="at">type =</span> <span class="st">&quot;dynamic&quot;</span>)</span>
<span id="cb128-17"><a href="diferença-em-diferenças.html#cb128-17" tabindex="-1"></a><span class="fu">summary</span>(cs_es)</span></code></pre></div>
<pre><code>## 
## Call:
## aggte(MP = cs_out, type = &quot;dynamic&quot;)
## 
## Reference: Callaway, Brantly and Pedro H.C. Sant&#39;Anna.  &quot;Difference-in-Differences with Multiple Time Periods.&quot; Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; 
## 
## 
## Overall summary of ATT&#39;s based on event-study/dynamic aggregation:  
##    ATT    Std. Error     [ 95%  Conf. Int.]  
##  11.82        0.2191    11.3907     12.2493 *
## 
## 
## Dynamic Effects:
##  Event time Estimate Std. Error [95% Simult.  Conf. Band]  
##          -4  -0.1106     0.2023       -0.6570      0.4359  
##          -3   0.0616     0.1875       -0.4449      0.5681  
##          -2   0.0692     0.1763       -0.4073      0.5456  
##          -1   0.1543     0.1474       -0.2440      0.5525  
##           0   3.3379     0.1628        2.8979      3.7779 *
##           1   6.9332     0.2271        6.3195      7.5468 *
##           2  10.4648     0.3323        9.5668     11.3627 *
##           3  14.0950     0.4129       12.9794     15.2107 *
##           4  17.1856     0.5468       15.7082     18.6629 *
##           5  12.1179     0.1954       11.5899     12.6459 *
##           6  14.3349     0.1963       13.8046     14.8652 *
##           7  16.0907     0.1913       15.5738     16.6075 *
## ---
## Signif. codes: `*&#39; confidence band does not cover 0
## 
## Control Group:  Never Treated,  Anticipation Periods:  0
## Estimation Method:  Doubly Robust</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="diferença-em-diferenças.html#cb130-1" tabindex="-1"></a><span class="fu">ggdid</span>(cs_es, <span class="at">title =</span> <span class="st">&quot;Event study — Callaway &amp; Sant&#39;Anna&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:cs-estimator"></span>
<img src="bookdownproj_files/figure-html/cs-estimator-1.png" alt="Event study agregado — Callaway &amp; Sant'Anna. Comparar com o TWFE da seção anterior." width="672" />
<p class="caption">
Figure 8.5: Event study agregado — Callaway &amp; Sant’Anna. Comparar com o TWFE da seção anterior.
</p>
</div>
</div>
<div id="sun-abraham-2021" class="section level3 hasAnchor" number="8.8.2">
<h3><span class="header-section-number">8.8.2</span> Sun &amp; Abraham (2021)<a href="diferença-em-diferenças.html#sun-abraham-2021" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sun e Abraham (2021) propõem o <em>interaction-weighted estimator</em>. A ideia é estimar coeficientes separados para cada coorte de tratamento e depois agregar com pesos adequados. O pacote <code>fixest</code> implementa isso via <code>sunab()</code>.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="diferença-em-diferenças.html#cb131-1" tabindex="-1"></a><span class="co"># Preparar: nunca tratados precisam de G_i grande (não Inf)</span></span>
<span id="cb131-2"><a href="diferença-em-diferenças.html#cb131-2" tabindex="-1"></a>sim_sa <span class="ot">&lt;-</span> sim_data <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="diferença-em-diferenças.html#cb131-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">G_sunab =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(G_i), <span class="dv">10000</span>, G_i))</span>
<span id="cb131-4"><a href="diferença-em-diferenças.html#cb131-4" tabindex="-1"></a></span>
<span id="cb131-5"><a href="diferença-em-diferenças.html#cb131-5" tabindex="-1"></a>sa_out <span class="ot">&lt;-</span> <span class="fu">feols</span>(Y <span class="sc">~</span> <span class="fu">sunab</span>(G_sunab, t) <span class="sc">|</span> i <span class="sc">+</span> t, <span class="at">data =</span> sim_sa)</span>
<span id="cb131-6"><a href="diferença-em-diferenças.html#cb131-6" tabindex="-1"></a><span class="fu">summary</span>(sa_out)</span></code></pre></div>
<pre><code>## OLS estimation, Dep. Var.: Y
## Observations: 3,000
## Fixed-effects: i: 300,  t: 10
## Standard-errors: Clustered (i) 
##        Estimate Std. Error   t value  Pr(&gt;|t|)    
## t::-5 -0.507467   0.195736  -2.59260 0.0099934 ** 
## t::-4 -0.618021   0.191162  -3.23298 0.0013621 ** 
## t::-3 -0.556429   0.208351  -2.67063 0.0079853 ** 
## t::-2 -0.154251   0.148310  -1.04005 0.2991553    
## t::0   3.337901   0.141628  23.56811 &lt; 2.2e-16 ***
## t::1   6.933171   0.142400  48.68798 &lt; 2.2e-16 ***
## t::2  10.464763   0.125684  83.26220 &lt; 2.2e-16 ***
## t::3  14.095030   0.143729  98.06637 &lt; 2.2e-16 ***
## t::4  17.185587   0.141087 121.80829 &lt; 2.2e-16 ***
## t::5  12.117914   0.202001  59.98933 &lt; 2.2e-16 ***
## t::6  14.334862   0.205640  69.70864 &lt; 2.2e-16 ***
## t::7  16.090680   0.197595  81.43247 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## RMSE: 0.953834     Adj. R2: 0.985194
##                  Within R2: 0.940844</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="diferença-em-diferenças.html#cb133-1" tabindex="-1"></a><span class="fu">iplot</span>(sa_out,</span>
<span id="cb133-2"><a href="diferença-em-diferenças.html#cb133-2" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;Períodos relativos ao tratamento&quot;</span>,</span>
<span id="cb133-3"><a href="diferença-em-diferenças.html#cb133-3" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Efeito estimado&quot;</span>,</span>
<span id="cb133-4"><a href="diferença-em-diferenças.html#cb133-4" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Event study — Sun &amp; Abraham&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:sunab-estimator"></span>
<img src="bookdownproj_files/figure-html/sunab-estimator-1.png" alt="Event study — Sun &amp; Abraham (sunab)." width="672" />
<p class="caption">
Figure 8.6: Event study — Sun &amp; Abraham (sunab).
</p>
</div>
</div>
<div id="gardner-2022-did2s" class="section level3 hasAnchor" number="8.8.3">
<h3><span class="header-section-number">8.8.3</span> Gardner (2022) / did2s<a href="diferença-em-diferenças.html#gardner-2022-did2s" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O estimador de dois estágios de Gardner (2022), discutido na seção 7.3, é implementado pelo pacote <code>did2s</code>.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="diferença-em-diferenças.html#cb134-1" tabindex="-1"></a><span class="fu">library</span>(did2s)</span>
<span id="cb134-2"><a href="diferença-em-diferenças.html#cb134-2" tabindex="-1"></a></span>
<span id="cb134-3"><a href="diferença-em-diferenças.html#cb134-3" tabindex="-1"></a>sim_d2s <span class="ot">&lt;-</span> sim_data <span class="sc">%&gt;%</span></span>
<span id="cb134-4"><a href="diferença-em-diferenças.html#cb134-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">first_treat =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(G_i), <span class="cn">Inf</span>, G_i))</span>
<span id="cb134-5"><a href="diferença-em-diferenças.html#cb134-5" tabindex="-1"></a></span>
<span id="cb134-6"><a href="diferença-em-diferenças.html#cb134-6" tabindex="-1"></a>d2s_out <span class="ot">&lt;-</span> <span class="fu">did2s</span>(<span class="at">data =</span> sim_d2s,</span>
<span id="cb134-7"><a href="diferença-em-diferenças.html#cb134-7" tabindex="-1"></a>                 <span class="at">yname =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb134-8"><a href="diferença-em-diferenças.html#cb134-8" tabindex="-1"></a>                 <span class="at">first_stage =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> i <span class="sc">+</span> t,</span>
<span id="cb134-9"><a href="diferença-em-diferenças.html#cb134-9" tabindex="-1"></a>                 <span class="at">second_stage =</span> <span class="sc">~</span> D_it,</span>
<span id="cb134-10"><a href="diferença-em-diferenças.html#cb134-10" tabindex="-1"></a>                 <span class="at">treatment =</span> <span class="st">&quot;D_it&quot;</span>,</span>
<span id="cb134-11"><a href="diferença-em-diferenças.html#cb134-11" tabindex="-1"></a>                 <span class="at">cluster_var =</span> <span class="st">&quot;i&quot;</span>)</span>
<span id="cb134-12"><a href="diferença-em-diferenças.html#cb134-12" tabindex="-1"></a></span>
<span id="cb134-13"><a href="diferença-em-diferenças.html#cb134-13" tabindex="-1"></a><span class="fu">summary</span>(d2s_out)</span></code></pre></div>
<pre><code>## OLS estimation, Dep. Var.: Y
## Observations: 3,000
## Standard-errors: Custom 
##      Estimate Std. Error t value  Pr(&gt;|t|)    
## D_it  11.3374   0.212622 53.3218 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## RMSE: 4.31369   Adj. R2: 0.628984</code></pre>
</div>
<div id="borusyak-jaravel-spiess-2024" class="section level3 hasAnchor" number="8.8.4">
<h3><span class="header-section-number">8.8.4</span> Borusyak, Jaravel &amp; Spiess (2024)<a href="diferença-em-diferenças.html#borusyak-jaravel-spiess-2024" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Borusyak, Jaravel e Spiess (2024) propõem um estimador por <strong>imputação</strong>: estimam o modelo de efeitos fixos nos dados não tratados e usam as previsões para imputar os contrafactuais das unidades tratadas. O efeito é a diferença entre o observado e o imputado.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="diferença-em-diferenças.html#cb136-1" tabindex="-1"></a><span class="fu">library</span>(didimputation)</span>
<span id="cb136-2"><a href="diferença-em-diferenças.html#cb136-2" tabindex="-1"></a></span>
<span id="cb136-3"><a href="diferença-em-diferenças.html#cb136-3" tabindex="-1"></a>sim_imp <span class="ot">&lt;-</span> sim_data <span class="sc">%&gt;%</span></span>
<span id="cb136-4"><a href="diferença-em-diferenças.html#cb136-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ei =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(G_i), <span class="dv">0</span>, G_i))</span>
<span id="cb136-5"><a href="diferença-em-diferenças.html#cb136-5" tabindex="-1"></a></span>
<span id="cb136-6"><a href="diferença-em-diferenças.html#cb136-6" tabindex="-1"></a>imp_out <span class="ot">&lt;-</span> <span class="fu">did_imputation</span>(<span class="at">data =</span> sim_imp,</span>
<span id="cb136-7"><a href="diferença-em-diferenças.html#cb136-7" tabindex="-1"></a>                          <span class="at">yname =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb136-8"><a href="diferença-em-diferenças.html#cb136-8" tabindex="-1"></a>                          <span class="at">gname =</span> <span class="st">&quot;Ei&quot;</span>,</span>
<span id="cb136-9"><a href="diferença-em-diferenças.html#cb136-9" tabindex="-1"></a>                          <span class="at">tname =</span> <span class="st">&quot;t&quot;</span>,</span>
<span id="cb136-10"><a href="diferença-em-diferenças.html#cb136-10" tabindex="-1"></a>                          <span class="at">idname =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb136-11"><a href="diferença-em-diferenças.html#cb136-11" tabindex="-1"></a>                          <span class="at">first_stage =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> i <span class="sc">+</span> t)</span>
<span id="cb136-12"><a href="diferença-em-diferenças.html#cb136-12" tabindex="-1"></a></span>
<span id="cb136-13"><a href="diferença-em-diferenças.html#cb136-13" tabindex="-1"></a><span class="fu">summary</span>(imp_out)</span></code></pre></div>
<pre><code>##      lhs                term              estimate       std.error      
##  Length:1           Length:1           Min.   :11.34   Min.   :0.07615  
##  Class :character   Class :character   1st Qu.:11.34   1st Qu.:0.07615  
##  Mode  :character   Mode  :character   Median :11.34   Median :0.07615  
##                                        Mean   :11.34   Mean   :0.07615  
##                                        3rd Qu.:11.34   3rd Qu.:0.07615  
##                                        Max.   :11.34   Max.   :0.07615  
##     conf.low       conf.high    
##  Min.   :11.19   Min.   :11.49  
##  1st Qu.:11.19   1st Qu.:11.49  
##  Median :11.19   Median :11.49  
##  Mean   :11.19   Mean   :11.49  
##  3rd Qu.:11.19   3rd Qu.:11.49  
##  Max.   :11.19   Max.   :11.49</code></pre>
</div>
<div id="tabela-comparativa" class="section level3 hasAnchor" number="8.8.5">
<h3><span class="header-section-number">8.8.5</span> Tabela comparativa<a href="diferença-em-diferenças.html#tabela-comparativa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="diferença-em-diferenças.html#cb138-1" tabindex="-1"></a><span class="co"># Extrair ATT de cada estimador</span></span>
<span id="cb138-2"><a href="diferença-em-diferenças.html#cb138-2" tabindex="-1"></a>att_twfe <span class="ot">&lt;-</span> <span class="fu">coef</span>(twfe_stag)[<span class="st">&quot;D_it&quot;</span>]</span>
<span id="cb138-3"><a href="diferença-em-diferenças.html#cb138-3" tabindex="-1"></a>att_cs <span class="ot">&lt;-</span> <span class="fu">aggte</span>(cs_out, <span class="at">type =</span> <span class="st">&quot;simple&quot;</span>)<span class="sc">$</span>overall.att</span>
<span id="cb138-4"><a href="diferença-em-diferenças.html#cb138-4" tabindex="-1"></a>att_sa <span class="ot">&lt;-</span> <span class="fu">summary</span>(sa_out)<span class="sc">$</span>coeftable[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb138-5"><a href="diferença-em-diferenças.html#cb138-5" tabindex="-1"></a>att_d2s <span class="ot">&lt;-</span> <span class="fu">coef</span>(d2s_out)[<span class="st">&quot;D_it&quot;</span>]</span>
<span id="cb138-6"><a href="diferença-em-diferenças.html#cb138-6" tabindex="-1"></a>att_imp <span class="ot">&lt;-</span> imp_out<span class="sc">$</span>estimate[<span class="dv">1</span>]</span>
<span id="cb138-7"><a href="diferença-em-diferenças.html#cb138-7" tabindex="-1"></a></span>
<span id="cb138-8"><a href="diferença-em-diferenças.html#cb138-8" tabindex="-1"></a><span class="co"># Recuperar ATT de Sun &amp; Abraham corretamente: média dos coeficientes pós</span></span>
<span id="cb138-9"><a href="diferença-em-diferenças.html#cb138-9" tabindex="-1"></a>sa_coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(sa_out)</span>
<span id="cb138-10"><a href="diferença-em-diferenças.html#cb138-10" tabindex="-1"></a>sa_post <span class="ot">&lt;-</span> sa_coefs[<span class="fu">grep</span>(<span class="st">&quot;^t::&quot;</span>, <span class="fu">names</span>(sa_coefs))]</span>
<span id="cb138-11"><a href="diferença-em-diferenças.html#cb138-11" tabindex="-1"></a><span class="co"># Filtrar apenas coeficientes pós-tratamento (relativos &gt;= 0)</span></span>
<span id="cb138-12"><a href="diferença-em-diferenças.html#cb138-12" tabindex="-1"></a>sa_post_names <span class="ot">&lt;-</span> <span class="fu">names</span>(sa_post)</span>
<span id="cb138-13"><a href="diferença-em-diferenças.html#cb138-13" tabindex="-1"></a>sa_post_vals <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;.*::&quot;</span>, <span class="st">&quot;&quot;</span>, sa_post_names))</span>
<span id="cb138-14"><a href="diferença-em-diferenças.html#cb138-14" tabindex="-1"></a>att_sa_agg <span class="ot">&lt;-</span> <span class="fu">mean</span>(sa_post[sa_post_vals <span class="sc">&gt;=</span> <span class="dv">0</span>])</span>
<span id="cb138-15"><a href="diferença-em-diferenças.html#cb138-15" tabindex="-1"></a></span>
<span id="cb138-16"><a href="diferença-em-diferenças.html#cb138-16" tabindex="-1"></a>tab_comp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb138-17"><a href="diferença-em-diferenças.html#cb138-17" tabindex="-1"></a>  <span class="at">Estimador =</span> <span class="fu">c</span>(<span class="st">&quot;ATT verdadeiro&quot;</span>, <span class="st">&quot;TWFE (enviesado)&quot;</span>, <span class="st">&quot;Callaway &amp; Sant&#39;Anna&quot;</span>,</span>
<span id="cb138-18"><a href="diferença-em-diferenças.html#cb138-18" tabindex="-1"></a>                <span class="st">&quot;Sun &amp; Abraham&quot;</span>, <span class="st">&quot;Gardner (did2s)&quot;</span>, <span class="st">&quot;Imputação (BJS)&quot;</span>),</span>
<span id="cb138-19"><a href="diferença-em-diferenças.html#cb138-19" tabindex="-1"></a>  <span class="at">ATT =</span> <span class="fu">round</span>(<span class="fu">c</span>(att_verdadeiro, att_twfe, att_cs, att_sa_agg, att_d2s, att_imp), <span class="dv">2</span>)</span>
<span id="cb138-20"><a href="diferença-em-diferenças.html#cb138-20" tabindex="-1"></a>)</span>
<span id="cb138-21"><a href="diferença-em-diferenças.html#cb138-21" tabindex="-1"></a></span>
<span id="cb138-22"><a href="diferença-em-diferenças.html#cb138-22" tabindex="-1"></a><span class="fu">kable</span>(tab_comp, <span class="at">caption =</span> <span class="st">&quot;Comparação dos estimadores — dados simulados com tratamento escalonado e efeitos heterogêneos&quot;</span>,</span>
<span id="cb138-23"><a href="diferença-em-diferenças.html#cb138-23" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Estimador&quot;</span>, <span class="st">&quot;ATT estimado&quot;</span>))</span></code></pre></div>
<table>
<caption><span id="tab:tabela-comparativa">Table 8.5: </span>Comparação dos estimadores — dados simulados com tratamento escalonado e efeitos heterogêneos</caption>
<thead>
<tr class="header">
<th align="left">Estimador</th>
<th align="right">ATT estimado</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ATT verdadeiro</td>
<td align="right">11.31</td>
</tr>
<tr class="even">
<td align="left">TWFE (enviesado)</td>
<td align="right">10.48</td>
</tr>
<tr class="odd">
<td align="left">Callaway &amp; Sant’Anna</td>
<td align="right">11.28</td>
</tr>
<tr class="even">
<td align="left">Sun &amp; Abraham</td>
<td align="right">11.82</td>
</tr>
<tr class="odd">
<td align="left">Gardner (did2s)</td>
<td align="right">11.34</td>
</tr>
<tr class="even">
<td align="left">Imputação (BJS)</td>
<td align="right">11.34</td>
</tr>
</tbody>
</table>
<p>A tabela mostra que o TWFE diverge do ATT verdadeiro, enquanto os estimadores modernos convergem para valores mais próximos do efeito real. As pequenas diferenças entre os estimadores modernos decorrem de diferenças nos esquemas de ponderação e na definição exata do estimando.</p>
</div>
</div>
<div id="testando-tendências-paralelas-e-análise-de-sensibilidade" class="section level2 hasAnchor" number="8.9">
<h2><span class="header-section-number">8.9</span> Testando tendências paralelas e análise de sensibilidade<a href="#testando-tend%C3%AAncias-paralelas-e-an%C3%A1lise-de-sensibilidade" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="pre-trends-e-o-aviso-de-roth-2022" class="section level3 hasAnchor" number="8.9.1">
<h3><span class="header-section-number">8.9.1</span> Pre-trends e o aviso de Roth (2022)<a href="diferença-em-diferenças.html#pre-trends-e-o-aviso-de-roth-2022" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>O event study é a ferramenta padrão para avaliar a plausibilidade de tendências paralelas: se os coeficientes pré-tratamento (<span class="math inline">\(\delta_k\)</span> para <span class="math inline">\(k &lt; 0\)</span>) são próximos de zero, isso é consistente com PT. Porém, Roth (2022) alerta para o <strong>viés de pré-teste</strong> (<em>pre-testing bias</em>): se selecionamos especificações ou amostras com base em pré-tendências insignificantes, podemos estar condicionando em ruído favorável, o que infla os coeficientes pós-tratamento.</p>
<p>Em outras palavras, a ausência de pré-tendências significativas é necessária mas não suficiente. Roth (2022) mostra que testes de pré-tendências têm baixo poder em muitas aplicações típicas — não rejeitar PT não significa que PT é verdadeira.</p>
</div>
<div id="honestdid-análise-de-sensibilidade" class="section level3 hasAnchor" number="8.9.2">
<h3><span class="header-section-number">8.9.2</span> HonestDiD: análise de sensibilidade<a href="#honestdid-an%C3%A1lise-de-sensibilidade" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Rambachan e Roth (2023) propõem uma abordagem de <strong>identificação parcial</strong>: em vez de supor PT exata, impõem restrições sobre <em>quanto</em> as tendências pós-tratamento podem divergir das tendências pré-tratamento. O parâmetro <span class="math inline">\(\bar{M}\)</span> controla essa divergência:</p>
<ul>
<li><span class="math inline">\(\bar{M} = 0\)</span>: tendências paralelas exatas (identificação pontual).</li>
<li><span class="math inline">\(\bar{M} = 1\)</span>: o desvio pós-tratamento pode ser igual ao máximo desvio observado no pré-tratamento.</li>
<li><span class="math inline">\(\bar{M} = 2\)</span>: o desvio pode ser até duas vezes maior.</li>
</ul>
<p>Vamos aplicar o HonestDiD ao event study da Obra Transparente:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="diferença-em-diferenças.html#cb139-1" tabindex="-1"></a><span class="fu">library</span>(HonestDiD)</span>
<span id="cb139-2"><a href="diferença-em-diferenças.html#cb139-2" tabindex="-1"></a></span>
<span id="cb139-3"><a href="diferença-em-diferenças.html#cb139-3" tabindex="-1"></a><span class="co"># Event study para HonestDiD (usando os dados Obra Transparente)</span></span>
<span id="cb139-4"><a href="diferença-em-diferenças.html#cb139-4" tabindex="-1"></a>es_honest <span class="ot">&lt;-</span> <span class="fu">feols</span>(concluida <span class="sc">~</span> <span class="fu">i</span>(periodo, group_treated, <span class="at">ref =</span> <span class="dv">3</span>) <span class="sc">|</span> id <span class="sc">+</span> periodo,</span>
<span id="cb139-5"><a href="diferença-em-diferenças.html#cb139-5" tabindex="-1"></a>                   <span class="at">data =</span> data_ot)</span>
<span id="cb139-6"><a href="diferença-em-diferenças.html#cb139-6" tabindex="-1"></a></span>
<span id="cb139-7"><a href="diferença-em-diferenças.html#cb139-7" tabindex="-1"></a><span class="co"># Extrair coeficientes e matriz de covariância</span></span>
<span id="cb139-8"><a href="diferença-em-diferenças.html#cb139-8" tabindex="-1"></a>betahat <span class="ot">&lt;-</span> <span class="fu">coef</span>(es_honest)</span>
<span id="cb139-9"><a href="diferença-em-diferenças.html#cb139-9" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">vcov</span>(es_honest)</span>
<span id="cb139-10"><a href="diferença-em-diferenças.html#cb139-10" tabindex="-1"></a></span>
<span id="cb139-11"><a href="diferença-em-diferenças.html#cb139-11" tabindex="-1"></a><span class="co"># Número de períodos pré e pós tratamento (ref = 3, períodos 1-7)</span></span>
<span id="cb139-12"><a href="diferença-em-diferenças.html#cb139-12" tabindex="-1"></a><span class="co"># Pré: períodos 1, 2 (2 coeficientes)</span></span>
<span id="cb139-13"><a href="diferença-em-diferenças.html#cb139-13" tabindex="-1"></a><span class="co"># Pós: períodos 4, 5, 6, 7 (4 coeficientes)</span></span>
<span id="cb139-14"><a href="diferença-em-diferenças.html#cb139-14" tabindex="-1"></a>numPrePeriods <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb139-15"><a href="diferença-em-diferenças.html#cb139-15" tabindex="-1"></a>numPostPeriods <span class="ot">&lt;-</span> <span class="fu">length</span>(betahat) <span class="sc">-</span> numPrePeriods</span>
<span id="cb139-16"><a href="diferença-em-diferenças.html#cb139-16" tabindex="-1"></a></span>
<span id="cb139-17"><a href="diferença-em-diferenças.html#cb139-17" tabindex="-1"></a><span class="co"># Sensibilidade com magnitude relativa</span></span>
<span id="cb139-18"><a href="diferença-em-diferenças.html#cb139-18" tabindex="-1"></a>delta_rm_results <span class="ot">&lt;-</span> <span class="fu">createSensitivityResults_relativeMagnitudes</span>(</span>
<span id="cb139-19"><a href="diferença-em-diferenças.html#cb139-19" tabindex="-1"></a>  <span class="at">betahat =</span> betahat,</span>
<span id="cb139-20"><a href="diferença-em-diferenças.html#cb139-20" tabindex="-1"></a>  <span class="at">sigma =</span> sigma,</span>
<span id="cb139-21"><a href="diferença-em-diferenças.html#cb139-21" tabindex="-1"></a>  <span class="at">numPrePeriods =</span> numPrePeriods,</span>
<span id="cb139-22"><a href="diferença-em-diferenças.html#cb139-22" tabindex="-1"></a>  <span class="at">numPostPeriods =</span> numPostPeriods,</span>
<span id="cb139-23"><a href="diferença-em-diferenças.html#cb139-23" tabindex="-1"></a>  <span class="at">Mbarvec =</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb139-24"><a href="diferença-em-diferenças.html#cb139-24" tabindex="-1"></a>)</span>
<span id="cb139-25"><a href="diferença-em-diferenças.html#cb139-25" tabindex="-1"></a></span>
<span id="cb139-26"><a href="diferença-em-diferenças.html#cb139-26" tabindex="-1"></a>delta_rm_results <span class="sc">%&gt;%</span></span>
<span id="cb139-27"><a href="diferença-em-diferenças.html#cb139-27" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">&quot;Análise de sensibilidade HonestDiD — Obra Transparente&quot;</span>,</span>
<span id="cb139-28"><a href="diferença-em-diferenças.html#cb139-28" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<caption><span id="tab:honestdid">Table 8.6: </span>Análise de sensibilidade HonestDiD — Obra Transparente</caption>
<thead>
<tr class="header">
<th align="right">lb</th>
<th align="right">ub</th>
<th align="left">method</th>
<th align="left">Delta</th>
<th align="right">Mbar</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.017</td>
<td align="right">0.059</td>
<td align="left">C-LF</td>
<td align="left">DeltaRM</td>
<td align="right">0.5</td>
</tr>
<tr class="even">
<td align="right">-0.033</td>
<td align="right">0.073</td>
<td align="left">C-LF</td>
<td align="left">DeltaRM</td>
<td align="right">1.0</td>
</tr>
<tr class="odd">
<td align="right">-0.053</td>
<td align="right">0.093</td>
<td align="left">C-LF</td>
<td align="left">DeltaRM</td>
<td align="right">1.5</td>
</tr>
<tr class="even">
<td align="right">-0.074</td>
<td align="right">0.114</td>
<td align="left">C-LF</td>
<td align="left">DeltaRM</td>
<td align="right">2.0</td>
</tr>
</tbody>
</table>
<p>A tabela mostra intervalos de confiança para diferentes valores de <span class="math inline">\(\bar{M}\)</span>. Se o intervalo inclui zero para <span class="math inline">\(\bar{M}\)</span> pequeno, isso sugere que mesmo desvios modestos de PT podem eliminar a significância do resultado. Se o intervalo permanece longe de zero para <span class="math inline">\(\bar{M}\)</span> grande, o resultado é robusto.</p>
</div>
</div>
<div id="aplicação-2-enchente-do-elbe" class="section level2 hasAnchor" number="8.10">
<h2><span class="header-section-number">8.10</span> Aplicação 2: Enchente do Elbe<a href="#aplica%C3%A7%C3%A3o-2-enchente-do-elbe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="contexto" class="section level3 hasAnchor" number="8.10.1">
<h3><span class="header-section-number">8.10.1</span> Contexto<a href="diferença-em-diferenças.html#contexto" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Em agosto de 2002, uma enchente devastadora atingiu o rio Elbe, na Alemanha. O chanceler Gerhard Schröder (SPD) liderou pessoalmente a resposta à crise, visitando as áreas afetadas e coordenando a ajuda federal. A eleição federal ocorreu poucas semanas depois, em setembro de 2002. Bechtel e Hainmueller (2011, <em>AJPS</em>) usam um DiD para estimar o efeito da gestão da crise sobre o voto no SPD nos distritos atingidos pela enchente.</p>
<p>A pergunta de pesquisa é: a gratidão dos eleitores pela resposta à crise durou além da eleição imediata? Os dados cobrem quatro eleições: 1994, 1998, 2002 e 2005.</p>
</div>
<div id="dados-e-did-básico" class="section level3 hasAnchor" number="8.10.2">
<h3><span class="header-section-number">8.10.2</span> Dados e DiD básico<a href="#dados-e-did-b%C3%A1sico" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="diferença-em-diferenças.html#cb140-1" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb140-2"><a href="diferença-em-diferenças.html#cb140-2" tabindex="-1"></a></span>
<span id="cb140-3"><a href="diferença-em-diferenças.html#cb140-3" tabindex="-1"></a>elbe1994_98 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="fu">here</span>(<span class="st">&quot;Dados&quot;</span>, <span class="st">&quot;Elbe&quot;</span>, <span class="st">&quot;1994_1998.dta&quot;</span>))</span>
<span id="cb140-4"><a href="diferença-em-diferenças.html#cb140-4" tabindex="-1"></a>elbe0 <span class="ot">&lt;-</span> elbe1994_98 <span class="sc">%&gt;%</span></span>
<span id="cb140-5"><a href="diferença-em-diferenças.html#cb140-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(wkr, wkrname, year, spd_z_vs, Flooded)</span>
<span id="cb140-6"><a href="diferença-em-diferenças.html#cb140-6" tabindex="-1"></a></span>
<span id="cb140-7"><a href="diferença-em-diferenças.html#cb140-7" tabindex="-1"></a>elbe1998_02 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="fu">here</span>(<span class="st">&quot;Dados&quot;</span>, <span class="st">&quot;Elbe&quot;</span>, <span class="st">&quot;1998_2002.dta&quot;</span>))</span>
<span id="cb140-8"><a href="diferença-em-diferenças.html#cb140-8" tabindex="-1"></a>elbe1 <span class="ot">&lt;-</span> elbe1998_02 <span class="sc">%&gt;%</span></span>
<span id="cb140-9"><a href="diferença-em-diferenças.html#cb140-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(wkr, wkrname, year, spd_z_vs, Flooded) <span class="sc">%&gt;%</span></span>
<span id="cb140-10"><a href="diferença-em-diferenças.html#cb140-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2002</span>)</span>
<span id="cb140-11"><a href="diferença-em-diferenças.html#cb140-11" tabindex="-1"></a></span>
<span id="cb140-12"><a href="diferença-em-diferenças.html#cb140-12" tabindex="-1"></a>elbe1998_05 <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="fu">here</span>(<span class="st">&quot;Dados&quot;</span>, <span class="st">&quot;Elbe&quot;</span>, <span class="st">&quot;1998_2005.dta&quot;</span>))</span>
<span id="cb140-13"><a href="diferença-em-diferenças.html#cb140-13" tabindex="-1"></a>elbe2 <span class="ot">&lt;-</span> elbe1998_05 <span class="sc">%&gt;%</span></span>
<span id="cb140-14"><a href="diferença-em-diferenças.html#cb140-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2005</span>) <span class="sc">%&gt;%</span></span>
<span id="cb140-15"><a href="diferença-em-diferenças.html#cb140-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(wkr, wkrname, year, spd_z_vs, Flooded)</span>
<span id="cb140-16"><a href="diferença-em-diferenças.html#cb140-16" tabindex="-1"></a></span>
<span id="cb140-17"><a href="diferença-em-diferenças.html#cb140-17" tabindex="-1"></a>elbe <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(elbe0, elbe1, elbe2)</span></code></pre></div>
<p>Primeiro, verificamos visualmente as tendências pré-tratamento:</p>
<div class="figure"><span style="display:block;" id="fig:elbe-tendencias"></span>
<img src="bookdownproj_files/figure-html/elbe-tendencias-1.png" alt="Evolução do voto SPD (%) nos distritos atingidos e não atingidos pela enchente. Linha vertical em 2002 (enchente + eleição)." width="672" />
<p class="caption">
Figure 8.7: Evolução do voto SPD (%) nos distritos atingidos e não atingidos pela enchente. Linha vertical em 2002 (enchente + eleição).
</p>
</div>
<p>As tendências pré-tratamento (1994–1998) são aproximadamente paralelas. Estimemos o DiD básico para a eleição de 2002:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="diferença-em-diferenças.html#cb141-1" tabindex="-1"></a>did_elbe <span class="ot">&lt;-</span> <span class="fu">feols</span>(spd_z_vs <span class="sc">~</span> Flooded <span class="sc">|</span> wkr <span class="sc">+</span> year,</span>
<span id="cb141-2"><a href="diferença-em-diferenças.html#cb141-2" tabindex="-1"></a>                  <span class="at">cluster =</span> <span class="st">&quot;wkr&quot;</span>,</span>
<span id="cb141-3"><a href="diferença-em-diferenças.html#cb141-3" tabindex="-1"></a>                  <span class="at">data =</span> elbe1998_02)</span>
<span id="cb141-4"><a href="diferença-em-diferenças.html#cb141-4" tabindex="-1"></a><span class="fu">summary</span>(did_elbe)</span></code></pre></div>
<pre><code>## OLS estimation, Dep. Var.: spd_z_vs
## Observations: 598
## Fixed-effects: wkr: 299,  year: 2
## Standard-errors: Clustered (wkr) 
##         Estimate Std. Error t value  Pr(&gt;|t|)    
## Flooded  7.14401   0.468184  15.259 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## RMSE: 1.80615     Adj. R2: 0.905029
##                 Within R2: 0.255154</code></pre>
<p>O coeficiente de <code>Flooded</code> mede o ganho adicional do SPD nos distritos atingidos. Bechtel e Hainmueller encontram um efeito positivo e significativo: a gestão da crise rendeu votos ao SPD.</p>
</div>
<div id="event-study" class="section level3 hasAnchor" number="8.10.3">
<h3><span class="header-section-number">8.10.3</span> Event study<a href="diferença-em-diferenças.html#event-study" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Para avaliar a dinâmica temporal — incluindo se o efeito persiste em 2005 — estimamos um event study usando todos os anos disponíveis:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="diferença-em-diferenças.html#cb143-1" tabindex="-1"></a>did_elbe_es <span class="ot">&lt;-</span> <span class="fu">feols</span>(spd_z_vs <span class="sc">~</span> <span class="fu">i</span>(year, Flooded, <span class="at">ref =</span> <span class="dv">1998</span>) <span class="sc">|</span> wkr <span class="sc">+</span> year,</span>
<span id="cb143-2"><a href="diferença-em-diferenças.html#cb143-2" tabindex="-1"></a>                     <span class="at">data =</span> elbe)</span>
<span id="cb143-3"><a href="diferença-em-diferenças.html#cb143-3" tabindex="-1"></a><span class="fu">summary</span>(did_elbe_es)</span></code></pre></div>
<pre><code>## OLS estimation, Dep. Var.: spd_z_vs
## Observations: 1,254
## Fixed-effects: wkr: 328,  year: 4
## Standard-errors: Clustered (wkr) 
##                     Estimate Std. Error   t value  Pr(&gt;|t|)    
## year::2002:Flooded  0.458643    1.52364  0.301018 0.7635917    
## year::2005:Flooded -4.806790    1.34447 -3.575220 0.0004027 ***
## ... 1 variable was removed because of collinearity (year::1994:Flooded)
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## RMSE: 4.71647     Adj. R2: 0.591674
##                 Within R2: 0.017113</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="diferença-em-diferenças.html#cb145-1" tabindex="-1"></a><span class="fu">iplot</span>(did_elbe_es,</span>
<span id="cb145-2"><a href="diferença-em-diferenças.html#cb145-2" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&quot;Ano (ref = 1998)&quot;</span>,</span>
<span id="cb145-3"><a href="diferença-em-diferenças.html#cb145-3" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">&quot;Efeito sobre voto SPD (p.p.)&quot;</span>,</span>
<span id="cb145-4"><a href="diferença-em-diferenças.html#cb145-4" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Event study — Enchente do Elbe&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:elbe-event-study"></span>
<img src="bookdownproj_files/figure-html/elbe-event-study-1.png" alt="Event study — Enchente do Elbe. O efeito sobre o voto SPD é forte em 2002 e persiste parcialmente em 2005." width="672" />
<p class="caption">
Figure 8.8: Event study — Enchente do Elbe. O efeito sobre o voto SPD é forte em 2002 e persiste parcialmente em 2005.
</p>
</div>
<p>O coeficiente de 1994 (pré-tratamento) é próximo de zero, sustentando a hipótese de PT. O efeito em 2002 é forte e positivo. Em 2005, o efeito diminui mas permanece — evidência de que a gratidão dos eleitores é parcialmente persistente, como argumentam Bechtel e Hainmueller (2011).</p>
</div>
<div id="robustez-1" class="section level3 hasAnchor" number="8.10.4">
<h3><span class="header-section-number">8.10.4</span> Robustez<a href="diferença-em-diferenças.html#robustez-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Como o tratamento (enchente) é simultâneo para todos os distritos atingidos, não há o problema de tratamento escalonado. Portanto, o TWFE padrão é adequado. Ainda assim, podemos verificar a robustez usando Sun &amp; Abraham (que, neste caso, deve convergir para o TWFE):</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="diferença-em-diferenças.html#cb146-1" tabindex="-1"></a>elbe_rob <span class="ot">&lt;-</span> elbe <span class="sc">%&gt;%</span></span>
<span id="cb146-2"><a href="diferença-em-diferenças.html#cb146-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">G_elbe =</span> <span class="fu">ifelse</span>(Flooded <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">2002</span>, <span class="dv">10000</span>))</span>
<span id="cb146-3"><a href="diferença-em-diferenças.html#cb146-3" tabindex="-1"></a></span>
<span id="cb146-4"><a href="diferença-em-diferenças.html#cb146-4" tabindex="-1"></a>sa_elbe <span class="ot">&lt;-</span> <span class="fu">feols</span>(spd_z_vs <span class="sc">~</span> <span class="fu">sunab</span>(G_elbe, year) <span class="sc">|</span> wkr <span class="sc">+</span> year, <span class="at">data =</span> elbe_rob)</span>
<span id="cb146-5"><a href="diferença-em-diferenças.html#cb146-5" tabindex="-1"></a></span>
<span id="cb146-6"><a href="diferença-em-diferenças.html#cb146-6" tabindex="-1"></a><span class="fu">msummary</span>(<span class="fu">list</span>(<span class="st">&quot;TWFE&quot;</span> <span class="ot">=</span> did_elbe_es, <span class="st">&quot;Sun-Abraham&quot;</span> <span class="ot">=</span> sa_elbe),</span>
<span id="cb146-7"><a href="diferença-em-diferenças.html#cb146-7" tabindex="-1"></a>         <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">&#39;*&#39;</span> <span class="ot">=</span> .<span class="dv">1</span>, <span class="st">&#39;**&#39;</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">&#39;***&#39;</span> <span class="ot">=</span> .<span class="dv">01</span>),</span>
<span id="cb146-8"><a href="diferença-em-diferenças.html#cb146-8" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;Robustez — Elbe: TWFE vs. Sun &amp; Abraham&quot;</span>)</span></code></pre></div>
<!-- preamble start -->

    <script>

      function styleCell_i2gx9gl3uy0dow1ue6on(i, j, css_id) {
          var table = document.getElementById("tinytable_i2gx9gl3uy0dow1ue6on");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_i2gx9gl3uy0dow1ue6on');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_i2gx9gl3uy0dow1ue6on(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_i2gx9gl3uy0dow1ue6on");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 21, j: 1 }, { i: 21, j: 2 },  ], css_id: 'tinytable_css_56z2amdlqkwzi1a73rn6',}, 
          { positions: [ { i: 10, j: 2 }, { i: 10, j: 1 },  ], css_id: 'tinytable_css_retxtthmxtoeeug8dsti',}, 
          { positions: [ { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 4, j: 1 }, { i: 1, j: 1 }, { i: 6, j: 1 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 5, j: 1 }, { i: 1, j: 2 }, { i: 11, j: 1 }, { i: 12, j: 1 }, { i: 13, j: 1 }, { i: 14, j: 1 }, { i: 15, j: 1 }, { i: 16, j: 1 }, { i: 17, j: 1 }, { i: 18, j: 1 }, { i: 19, j: 1 }, { i: 20, j: 1 }, { i: 12, j: 2 }, { i: 9, j: 1 }, { i: 14, j: 2 }, { i: 2, j: 2 }, { i: 3, j: 2 }, { i: 4, j: 2 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 9, j: 2 }, { i: 18, j: 2 }, { i: 11, j: 2 }, { i: 16, j: 2 }, { i: 13, j: 2 }, { i: 15, j: 2 }, { i: 20, j: 2 }, { i: 17, j: 2 }, { i: 19, j: 2 },  ], css_id: 'tinytable_css_nbh48t9fg51116uk2cb5',}, 
          { positions: [ { i: 0, j: 1 }, { i: 0, j: 2 },  ], css_id: 'tinytable_css_d8orkymr3vn3yf8zpqfi',}, 
          { positions: [ { i: 21, j: 0 },  ], css_id: 'tinytable_css_4dkgf3wicqs8oo8hd2vm',}, 
          { positions: [ { i: 10, j: 0 },  ], css_id: 'tinytable_css_kqg4fojpewvs106kiyoe',}, 
          { positions: [ { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 3, j: 0 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 6, j: 0 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 9, j: 0 }, { i: 14, j: 0 }, { i: 11, j: 0 }, { i: 12, j: 0 }, { i: 13, j: 0 }, { i: 18, j: 0 }, { i: 15, j: 0 }, { i: 16, j: 0 }, { i: 17, j: 0 }, { i: 19, j: 0 }, { i: 20, j: 0 },  ], css_id: 'tinytable_css_5f17jjofpr1j6lhy0utr',}, 
          { positions: [ { i: 0, j: 0 },  ], css_id: 'tinytable_css_e3dmmxr3je9w81dri4hi',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_i2gx9gl3uy0dow1ue6on(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_56z2amdlqkwzi1a73rn6, .table th.tinytable_css_56z2amdlqkwzi1a73rn6 { text-align: center; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_retxtthmxtoeeug8dsti, .table th.tinytable_css_retxtthmxtoeeug8dsti { text-align: center; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_nbh48t9fg51116uk2cb5, .table th.tinytable_css_nbh48t9fg51116uk2cb5 { text-align: center; }
      .table td.tinytable_css_d8orkymr3vn3yf8zpqfi, .table th.tinytable_css_d8orkymr3vn3yf8zpqfi { text-align: center; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
      .table td.tinytable_css_4dkgf3wicqs8oo8hd2vm, .table th.tinytable_css_4dkgf3wicqs8oo8hd2vm { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_kqg4fojpewvs106kiyoe, .table th.tinytable_css_kqg4fojpewvs106kiyoe { text-align: left; border-bottom: solid black 0.05em; }
      .table td.tinytable_css_5f17jjofpr1j6lhy0utr, .table th.tinytable_css_5f17jjofpr1j6lhy0utr { text-align: left; }
      .table td.tinytable_css_e3dmmxr3je9w81dri4hi, .table th.tinytable_css_e3dmmxr3je9w81dri4hi { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_i2gx9gl3uy0dow1ue6on" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing='true'>
        <thead>
        <caption>Robustez — Elbe: TWFE vs. Sun & Abraham</caption>
              <tr>
                <th scope="col"> </th>
                <th scope="col">TWFE</th>
                <th scope="col">Sun-Abraham</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan='3'>* p < 0.1, ** p < 0.05, *** p < 0.01</td></tr></tfoot>
        <tbody>
                <tr>
                  <td>year = 2002 × Flooded</td>
                  <td>0.459</td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>(1.524)</td>
                  <td></td>
                </tr>
                <tr>
                  <td>year = 2005 × Flooded</td>
                  <td>-4.807***</td>
                  <td></td>
                </tr>
                <tr>
                  <td></td>
                  <td>(1.344)</td>
                  <td></td>
                </tr>
                <tr>
                  <td>year = -4</td>
                  <td></td>
                  <td>0.289</td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td>(0.341)</td>
                </tr>
                <tr>
                  <td>year = 0</td>
                  <td></td>
                  <td>0.458</td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td>(1.525)</td>
                </tr>
                <tr>
                  <td>year = 3</td>
                  <td></td>
                  <td>-4.808***</td>
                </tr>
                <tr>
                  <td></td>
                  <td></td>
                  <td>(1.346)</td>
                </tr>
                <tr>
                  <td>Num.Obs.</td>
                  <td>1254</td>
                  <td>1254</td>
                </tr>
                <tr>
                  <td>R2</td>
                  <td>0.700</td>
                  <td>0.700</td>
                </tr>
                <tr>
                  <td>R2 Adj.</td>
                  <td>0.592</td>
                  <td>0.591</td>
                </tr>
                <tr>
                  <td>R2 Within</td>
                  <td>0.017</td>
                  <td>0.017</td>
                </tr>
                <tr>
                  <td>R2 Within Adj.</td>
                  <td>0.015</td>
                  <td>0.014</td>
                </tr>
                <tr>
                  <td>AIC</td>
                  <td>8114.8</td>
                  <td>8116.7</td>
                </tr>
                <tr>
                  <td>BIC</td>
                  <td>9824.4</td>
                  <td>9831.5</td>
                </tr>
                <tr>
                  <td>RMSE</td>
                  <td>4.72</td>
                  <td>4.72</td>
                </tr>
                <tr>
                  <td>Std.Errors</td>
                  <td>by: wkr</td>
                  <td>by: wkr</td>
                </tr>
                <tr>
                  <td>FE: wkr</td>
                  <td>X</td>
                  <td>X</td>
                </tr>
                <tr>
                  <td>FE: year</td>
                  <td>X</td>
                  <td>X</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
<p>Como esperado, os resultados são praticamente idênticos, confirmando que, quando o tratamento é simultâneo, o TWFE não sofre do viés discutido na seção 7.</p>
</div>
</div>
<div id="did-condicional-e-extensões" class="section level2 hasAnchor" number="8.11">
<h2><span class="header-section-number">8.11</span> DiD condicional e extensões<a href="#did-condicional-e-extens%C3%B5es" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O pressuposto de tendências paralelas pode ser forte demais quando os grupos diferem em características observáveis que afetam a trajetória do resultado. Nesses casos, podemos relaxar PT para uma versão <strong>condicional a covariáveis</strong>:</p>
<p><span class="math display">\[
\mathbb{E}[Y_{it}(0) - Y_{it-1}(0) \mid D_i = 1, X_i] = \mathbb{E}[Y_{it}(0) - Y_{it-1}(0) \mid D_i = 0, X_i]
\]</span></p>
<p>Ou seja, as tendências são paralelas <em>dentro de estratos</em> definidos por <span class="math inline">\(X_i\)</span>. Há três abordagens principais para estimar o DiD condicional:</p>
<ol style="list-style-type: decimal">
<li><strong>Ponderação por propensity score inverso (IPW):</strong> ponderar as unidades de controle para que a distribuição de <span class="math inline">\(X\)</span> replique a do grupo tratado.</li>
<li><strong>Regressão de resultado (<em>outcome regression</em>):</strong> modelar <span class="math inline">\(\mathbb{E}[Y_{it}(0) \mid X_i]\)</span> parametricamente.</li>
<li><strong>Doubly-robust:</strong> combinar IPW e regressão. Consistente se <em>qualquer uma</em> das duas especificações estiver correta. O pacote <code>did</code> implementa essa abordagem (Sant’Anna &amp; Zhao, 2020).</li>
</ol>
<p>Wooldridge (2021) propõe uma extensão do TWFE (<em>extended TWFE</em>) que inclui interações entre os efeitos fixos de tempo e as covariáveis, obtendo resultados robustos a efeitos heterogêneos sob certas condições.</p>
</div>
<div id="resumo" class="section level2 hasAnchor" number="8.12">
<h2><span class="header-section-number">8.12</span> Resumo<a href="diferença-em-diferenças.html#resumo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Neste capítulo, introduzimos o estimador de Diferença em Diferenças e o pressuposto central de tendências paralelas. Os pontos-chave são:</p>
<ol style="list-style-type: decimal">
<li><strong>DiD 2$$2</strong> é intuitivo e pode ser estimado por TWFE sem problemas.</li>
<li><strong>Tendências paralelas</strong> é o pressuposto de identificação central; é não-testável diretamente, mas pode ser avaliado com event studies (com cautela) e análise de sensibilidade (HonestDiD).</li>
<li><strong>Com tratamento escalonado e efeitos heterogêneos</strong>, o TWFE pode ser enviesado. A decomposição de Goodman-Bacon revela por quê.</li>
<li><strong>Estimadores modernos</strong> — Callaway &amp; Sant’Anna, Sun &amp; Abraham, Gardner/did2s, Borusyak et al. — corrigem o problema e convergem para estimativas consistentes.</li>
<li><strong>Em aplicações com tratamento simultâneo</strong> (como a enchente do Elbe), o TWFE permanece válido.</li>
</ol>
<p>No capítulo 9, discutiremos dados de painel (TSCS) de forma mais geral, incluindo as suposições de exogeneidade estrita e sequencial — das quais as tendências paralelas são um caso especial. No capítulo 11, veremos o controle sintético como alternativa quando PT é duvidosa ou quando há poucas unidades tratadas.</p>
</div>
<div id="referências-6" class="section level2 hasAnchor" number="8.13">
<h2><span class="header-section-number">8.13</span> Referências<a href="#refer%C3%AAncias-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Angrist, J. D., &amp; Pischke, J.-S. (2009). <em>Mostly Harmless Econometrics</em>. Princeton University Press.</p>
<p>Bechtel, M. M., &amp; Hainmueller, J. (2011). How Lasting Is Voter Gratitude? An Analysis of the Short- and Long-Term Electoral Returns to Beneficial Policy. <em>American Journal of Political Science</em>, 55(4), 852–868.</p>
<p>Borusyak, K., Jaravel, X., &amp; Spiess, J. (2024). Revisiting Event Study Designs: Robust and Efficient Estimation. <em>Review of Economic Studies</em>, 91(6), 3253–3285.</p>
<p>Callaway, B., &amp; Sant’Anna, P. H. C. (2021). Difference-in-Differences with Multiple Time Periods. <em>Journal of Econometrics</em>, 225(2), 200–230.</p>
<p>Card, D., &amp; Krueger, A. B. (1994). Minimum Wages and Employment: A Case Study of the Fast-Food Industry in New Jersey and Pennsylvania. <em>American Economic Review</em>, 84(4), 772–793.</p>
<p>Cunningham, S. (2021). <em>Causal Inference: The Mixtape</em>. Yale University Press.</p>
<p>de Chaisemartin, C., &amp; D’Haultfœuille, X. (2020). Two-Way Fixed Effects Estimators with Heterogeneous Treatment Effects. <em>American Economic Review</em>, 110(9), 2964–2996.</p>
<p>de Chaisemartin, C., &amp; D’Haultfœuille, X. (2023). Two-Way Fixed Effects and Differences-in-Differences with Heterogeneous Treatment Effects: A Survey. <em>Econometrics Journal</em>, 26(3), C1–C30.</p>
<p>Gardner, J. (2022). Two-Stage Differences in Differences. Working Paper.</p>
<p>Goodman-Bacon, A. (2021). Difference-in-Differences with Variation in Treatment Timing. <em>Journal of Econometrics</em>, 225(2), 254–277.</p>
<p>Huntington-Klein, N. (2022). <em>The Effect: An Introduction to Research Design and Causality</em>. Chapman &amp; Hall/CRC.</p>
<p>Rambachan, A., &amp; Roth, J. (2023). A More Credible Approach to Parallel Trends. <em>Review of Economic Studies</em>, 90(5), 2555–2591.</p>
<p>Roth, J. (2022). Pretest with Caution: Event-Study Estimates after Testing for Parallel Trends. <em>American Economic Review: Insights</em>, 4(3), 305–322.</p>
<p>Roth, J., Sant’Anna, P. H. C., Bilinski, A., &amp; Poe, J. (2023). What’s Trending in Difference-in-Differences? A Synthesis of the Recent Econometrics Literature. <em>Journal of Econometrics</em>, 235(2), 2218–2244.</p>
<p>Sun, L., &amp; Abraham, S. (2021). Estimating Dynamic Treatment Effects in Event Studies with Heterogeneous Treatment Effects. <em>Journal of Econometrics</em>, 225(2), 175–199.</p>
<p>Wooldridge, J. M. (2021). Two-Way Fixed Effects, the Two-Way Mundlak Regression, and Difference-in-Differences Estimators. Working Paper.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="desenho-de-regressão-descontínua.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="time-series-cross-section-tscs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/mgaldino/Causalidade/edit/main/08-DiD.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": "https://github.com/mgaldino/Causalidade/blob/main/08-DiD.Rmd",
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
